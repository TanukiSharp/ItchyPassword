!function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);const r="#D0FFD0",a="#FFD0D0";function o(t){const e=document.getElementById(t);if(null===t)throw new Error(`DOM element '${t}' not found.`);return e}function i(t,e){const n=function(t,e){let n=void 0;return{start:()=>{void 0!==n&&(clearTimeout(n),n=void 0),t()},end:()=>{void 0!==n&&clearTimeout(n),n=setTimeout(t,e)}}}(()=>{t.classList.remove("good-flash"),t.classList.remove("bad-flash")},1e3),r=async()=>{t.disabled=!0,n.start();try{const r=e();let a;a=r instanceof Promise?await r:r,void 0===a||!0===a?t.classList.add("good-flash"):t.classList.add("bad-flash")}catch(e){t.classList.add("bad-flash"),console.error(e.message||e)}finally{n.end(),t.disabled=!1}};return t.addEventListener("click",r),r}function s(t,e){return i(e,()=>(async function(t){try{return await navigator.clipboard.writeText(t),!0}catch(t){return console.error(t.stack||t),!1}})(t.value))}function u(t,e){e?t.style.removeProperty("display"):t.style.setProperty("display","none")}function c(t,e){for(const n of t)u(n,e)}const l="Stores the string in memory and removes it from the UI component. Prevents a physical intruder from copy/pasting the value.",h="Removes the string form memory and re-enables the UI component.",d=o("txtPrivatePart"),p=o("txtPrivatePartConfirmation"),y=o("btnProtect"),f=o("spnProtectedConfirmation"),g=o("spnPrivatePartSize"),w=o("spnPrivatePartSizeConfirmation");let b;const v=[];function m(){return void 0!==b?b:d.value}function T(){0!==d.value.length&&(b=d.value,f.innerHTML="Protected",d.value="",p.value="",g.innerHTML="0",w.innerHTML="0",d.disabled=!0,p.disabled=!0,y.innerHTML="Clear and unlock",y.title=h,L())}function A(){void 0===b?T():(b=void 0,f.innerHTML="",d.disabled=!1,p.disabled=!1,y.innerHTML="Protect and lock",y.title=l,y.disabled=!0)}function E(){A()}const S=new class{constructor(t,e){this.action=t,this.delay=e}reset(t){void 0!==this.timeout&&clearTimeout(this.timeout);const e=void 0!==t?t:this.delay;this.timeout=setTimeout(()=>{this.action(),this.timeout=void 0},e)}}(T,6e4);function P(){let t;for(t of(y.disabled=0===d.value.length,g.innerHTML=d.value.length.toString(),L(),v))t();S.reset()}function L(){p.value===d.value?p.style.setProperty("background",r):p.style.setProperty("background",a)}function _(){w.innerHTML=p.value.length.toString(),S.reset(),L()}function O(t){const e=(t=function(t){if(t.byteLength>65535)throw new Error(`Buffer too large: ${t.byteLength} bytes`);let e=t.byteLength;const n=new Uint8Array(2+t.byteLength);for(let t=0;t<2;t+=1)n[t]=e%256,e/=256;return n.set(new Uint8Array(t),2),n.buffer}(t)).byteLength,n=new DataView(t,0);let r=0n,a=1n;for(let t=0;t<e;t+=1)r+=BigInt(n.getUint8(t))*a,a*=256n;return r}function C(t,e){const n=BigInt(e.length);let r="",a=function(t){const e=t.byteLength,n=new DataView(t,0);let r=0n,a=1n;for(let t=0;t<e;t+=1)r+=BigInt(n.getUint8(t))*a,a*=256n;return r}(t);for(;a>0n;){const t=a%n;a/=n,r+=e[BigInt.asUintN(8,t)]}return r}function k(t,e){const n=BigInt(e.length);let r=0n,a=1n;for(let o=0;o<t.length;o+=1){r+=BigInt(e.indexOf(t[o]))*a,a*=n}return function(t){const e=[];for(;t>0n;){const n=t%256n;t/=256n;const r=Number(BigInt.asUintN(8,n));e.push(r)}let n=e[0];e.length>1&&(n+=256*e[1]);const r=n-(e.length-2);for(let t=0;t<r;t+=1)e.push(0);return new Uint8Array(e.slice(2)).buffer}(r)}class R extends Error{constructor(t){super(t),this._name=R.ERROR_NAME,Object.setPrototypeOf(this,new.target.prototype)}get name(){return this._name}static isMatching(t){return t&&t.name===R.ERROR_NAME}}R.ERROR_NAME="TaskCancelledError";class I{constructor(){this._isCancelled=!1,this._token=new M(this)}get isCancelled(){return this._isCancelled}get token(){return this._token}cancel(){this._isCancelled=!0}}class M{constructor(t){this.source=t}static get none(){return M._none}get isCancelled(){return this.source.isCancelled}}function N(t){if(t.isCancelled)throw new R}M._none=new M(new I);const H="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";async function V(t,e,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveKey"]);N(n);const a={name:"PBKDF2",hash:"SHA-512",iterations:1e5,salt:e},o=await window.crypto.subtle.deriveKey(a,r,{name:"AES-CBC",length:256},!0,["encrypt"]);N(n);const i=await window.crypto.subtle.exportKey("raw",o);return N(n),i}function U(t=64,e=H){return C(function(t=64){const e=new Uint8Array(t);return crypto.getRandomValues(e).buffer}(t),e)}function G(t){return(new TextEncoder).encode(t).buffer}const B=o("divStorageOutput"),K=o("txtPath"),x=o("txtParameters"),F=o("txtCustomKeys");function z(t){return null!=t&&!1===t.hasOwnProperty("constructor")&&"Object"===t.constructor.name}function D(){j()}function $(){j()}function j(){if(void 0===q||void 0===W||void 0===J)return;const t=function t(e,n){const r=e.indexOf("/"),a={},o=r>=0?e.substr(0,r):e,i=r>=0?e.substr(r+1):void 0;if(void 0===n){const t={};t[o]=a,n={head:t,tailParent:t,tail:a}}else n.tail[o]=a,n.tailParent=n.tail,n.tail=a;return i?t(i,n):n}(`${K.value}/${W}`),e=t.tail;for(const[t,n]of Object.entries(q))e[t]=n;const n=function(){if(""===F.value)return{};try{const t=JSON.parse(F.value);return null===t||"Object"!==t.constructor.name?null:t}catch{return null}}();null!==n?F.style.removeProperty("background"):F.style.setProperty("background",a);const r=function(t,e,n){const r={};if(null!==t)for(const[e,a]of Object.entries(t))!1===n.includes(e)&&(r[e]=a);if(null!==e)for(const[t,n]of Object.entries(e))r[t]=n;return r}(n,e,J);0===Object.keys(r).length?t.tailParent[Object.keys(t.tailParent)[0]]=null:t.tailParent[Object.keys(t.tailParent)[0]]=r,x.value=JSON.stringify(function t(e){const n={};for(const[r,a]of Object.entries(e).sort((t,e)=>t[0].localeCompare(e[0])))n[r]=z(a)?t(a):a;return n}(t.head),void 0,4)}function Y(){q=void 0,W=void 0,J=void 0,x.value=""}let q,W,J;function Z(t,e,n){q=t,W=e,J=n,j()}function X(){B.style.setProperty("display","initial")}function Q(){B.style.setProperty("display","none")}const tt=o("btnTabPasswords"),et=o("divTabPasswords"),nt=new class{constructor(t){this.hkdfPurpose=G(t),this._description=`HKDF(PBKDF2, HMAC512) [purpose: ${t}]`}get version(){return 1}get description(){return this._description}async generatePassword(t,e,n){const r=await V(t,e,n);N(n);const a=await window.crypto.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-512"}},!1,["sign"]);N(n);const o=await window.crypto.subtle.sign("HMAC",a,this.hkdfPurpose);return N(n),o}}("Password"),rt=o("txtPublicPart"),at=o("spnPublicPartSize"),ot=o("btnGeneratePublicPart"),it=o("btnClearPublicPart"),st=o("btnCopyPublicPart"),ut=o("btnShowHidePasswordOptionalFeatures"),ct=o("lblAlphabetLength"),lt=o("numOutputSizeRange"),ht=o("numOutputSizeNum"),dt=o("lblAlphabet"),pt=o("txtAlphabet"),yt=o("spnAlphabetSize"),ft=o("divPasswordAlphabetActions"),gt=o("btnResetAlphabet"),wt=o("txtResultPassword"),bt=o("spnResultPasswordLength"),vt=o("btnViewResultPassword"),mt=o("btnCopyResultPassword"),Tt=o("lblGeneratingPassword"),At=64,Et="!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~",St=["alphabet","length","public","datetime"];let Pt,Lt;function _t(){return!(rt.value.length>0&&"y"!==prompt("Are you sure you want to clear the public part ?\nType 'y' to accept",""))&&(rt.value="",Vt(),Ct(),It(),!0)}function Ot(){if(rt.value.length>0&&"y"!==prompt("Are you sure you want to generate a new public part ?\nType 'y' to accept",""))return!1;const t=U();return rt.value=t,Vt(),Ct(),$t(M.none),!0}function Ct(){Pt=rt.value.length>0?(new Date).toISOString():void 0}function kt(){bt.innerHTML=wt.value.length.toString()}function Rt(t){const e=t.split("");e.sort();for(let t=1;t<e.length;t+=1)if(e[t-1]===e[t])return!1;return!0}function It(){if(!1===Ft())return void xt();const t={public:rt.value,datetime:Pt},e=wt.value.length;e!==At&&(t.length=e);const n=pt.value;n!==Et&&(t.alphabet=n),Z(t,"password",St)}function Mt(){ht.value=lt.value}async function Nt(){Mt(),await $t(M.none)}async function Ht(){(function(){const t=parseInt(lt.min,10),e=parseInt(ht.value,10),n=parseInt(lt.max,10);return!1===isNaN(e)&&(lt.value=Math.max(t,Math.min(e,n)).toString(),!0)})()&&Mt(),await $t(M.none)}function Vt(){at.innerHTML=rt.value.length.toString()}function Ut(){yt.innerHTML=pt.value.length.toString()}function Gt(t){t?pt.style.removeProperty("background"):pt.style.setProperty("background",a)}async function Bt(){const t=Rt(pt.value);Gt(t),!1!==t&&(Ut(),await $t(M.none))}async function Kt(){return!1!==Yt()&&(await $t(M.none),!0)}function xt(){wt.value="",Y(),kt()}function Ft(t){const e=pt.value;return!1!==Rt(e)&&(t=t||rt.value,!(m().length<=0||t.length<8||e.length<2))}async function zt(t,e){if(!1===Ft(t))return null;const n=G(m()),r=G(t);return C(await nt.generatePassword(n,r,e),pt.value)}const Dt=new class{constructor(){this.currentTokenSource=null,this.currentTask=null,this.microThreadId=0}get isRunning(){return null!==this.currentTask}async cancelInternal(t){this.microThreadId===Number.MAX_SAFE_INTEGER?this.microThreadId=0:this.microThreadId=this.microThreadId+1;const e=this.microThreadId;if(null===this.currentTask)return!0;if(null!==this.currentTokenSource&&(this.currentTokenSource.cancel(),null!==this.currentTask))try{await this.currentTask}catch(e){if(!R.isMatching(e))throw e;if(t)throw e}return e===this.microThreadId}async cancel(t=!1){await this.cancelInternal(t)}async cancelAndExecute(t,e=!1){if(!1===await this.cancelInternal(e)){if(!1===e)return;throw new R}var n=new I;this.currentTokenSource=n;try{return this.currentTask=t(this.currentTokenSource.token),await this.currentTask}catch(t){if(R.isMatching(t)&&!1===e)return;throw t}finally{this.currentTask=null}}};async function $t(t){if(!1!==Ft()){u(Tt,!0);try{await Dt.cancelAndExecute(jt)}finally{u(Tt,!1)}}else xt()}async function jt(t){const e=await zt(rt.value,t);var n,r;null!==e&&(wt.value=(n=e,r=Math.max(4,parseInt(lt.value,10)),n.length<=r?n:n.substr(0,r)),kt(),It(),Lt())}function Yt(){pt.value=Et,Ut();const t=Rt(pt.value);return Gt(t),t}async function qt(){Vt(),Ct(),await $t(M.none)}class Wt{get version(){return 2}get description(){return"PBKDF2 + AES-GCM"}async encrypt(t,e,n){const r=new ArrayBuffer(44+t.byteLength),a=crypto.getRandomValues(new Uint8Array(r,0,12)),o=crypto.getRandomValues(new Uint8Array(r,12,16)),i={name:"AES-GCM",iv:a},s=await window.crypto.subtle.importKey("raw",await V(e,o,n),{name:"AES-GCM",length:256},!1,["encrypt"]);N(n);const u=await window.crypto.subtle.encrypt(i,s,t);return N(n),new Uint8Array(r).set(new Uint8Array(u),28),r}async decrypt(t,e,n){const r=new Uint8Array(t,0,12),a=new Uint8Array(t,12,16),o=new Uint8Array(t,28),i={name:"AES-GCM",iv:r},s=await V(e,a,n);N(n);const u=await window.crypto.subtle.importKey("raw",s,{name:"AES-GCM",length:256},!1,["decrypt"]);N(n);const c=await window.crypto.subtle.decrypt(i,u,o);return N(n),c}}const Jt=["version","value"],Zt=o("btnTabCiphers"),Xt=o("divTabCiphers"),Qt=new Wt,te=o("txtCipherName"),ee=o("txtCipherSource"),ne=o("txtCipherTarget"),re=o("btnEncrypt"),ae=o("btnDecrypt"),oe=o("btnClearCipherSource"),ie=o("btnCopyCipherTarget"),se=o("btnClearCipherTarget");function ue(){ee.style.removeProperty("background-color")}function ce(){ee.style.setProperty("background-color",a)}function le(){ue(),ne.style.removeProperty("background-color")}function he(t){ne.value=t,de()}function de(){if(""===ne.value||""===te.value)return void Y();Z({version:Qt.version,value:ne.value},`ciphers/${te.value}`,Jt)}async function pe(t,e){const n=m();if(0===n.length)return console.warn("Private part is empty"),null;const r=G(t),a=G(n),o=await Qt.encrypt(r,a,e);return N(e),function(t,e){const n=BigInt(e.length);let r="",a=O(t);for(;a>0n;){const t=a%n;a/=n,r+=e[BigInt.asUintN(8,t)]}return r}(o,H)}async function ye(t,e){const n=m();if(0===n.length)return console.warn("Private part is empty"),null;try{const a=k(t,H),o=G(n),i=await Qt.decrypt(a,o,e);return N(e),r=i,(new TextDecoder).decode(r)}catch(t){return function(t){if(R.isMatching(t))throw t}(t),console.warn(`Failed to decrypt${t.message?`, error: ${t.message}`:", no error message"}`),null}var r}async function fe(){if(ee.focus(),he(""),le(),0===ee.value.length)return ce(),!1;const t=await pe(ee.value,M.none);return null!==t&&(he(t),!0)}async function ge(){if(ee.focus(),he(""),le(),0===ee.value.length)return ce(),!1;const t=await ye(ee.value,M.none);return null===t?(ne.style.setProperty("background-color",a),!1):(he(t),!0)}const we=new Uint8Array([242,207,239,142,19,64,70,73,146,42,222,92,188,136,56,168]).buffer;const be=[new class{get version(){return 1}get description(){return"PBKDF2 + AES-GCM"}async encrypt(t,e,n){const r=new ArrayBuffer(28+t.byteLength),a=new DataView(r,0,12);crypto.getRandomValues(new Uint8Array(r,0,12));const o={name:"AES-GCM",iv:a},i=await window.crypto.subtle.importKey("raw",await V(e,we,n),{name:"AES-GCM",length:256},!1,["encrypt"]);N(n);const s=await window.crypto.subtle.encrypt(o,i,t);return N(n),new Uint8Array(r).set(new Uint8Array(s),12),r}async decrypt(t,e,n){const r=new DataView(t,0,12),a=new DataView(t,12),o={name:"AES-GCM",iv:r},i=await V(e,we,n);N(n);const s=await window.crypto.subtle.importKey("raw",i,{name:"AES-GCM",length:256},!1,["decrypt"]);N(n);const u=await window.crypto.subtle.decrypt(o,s,a);return N(n),u}},new Wt],ve=o("btnTabReEncrypt"),me=o("divTabReEncrypt"),Te=o("txtReEncryptSource"),Ae=o("txtReEncryptTarget"),Ee=o("cboReEncryptFrom"),Se=o("cboReEncryptTo"),Pe=o("btnReEncrypt"),Le=o("btnClearReEncryptSource"),_e=o("btnCopyReEncryptTarget"),Oe=o("btnClearReEncryptTarget");function Ce(t,e){let n;for(n of be){const e=document.createElement("option");e.value=t.childNodes.length.toString(),e.text=`${n.description} (v${n.version})`,t.add(e)}t.value=e.toString()}function ke(){Te.style.removeProperty("background-color")}function Re(){ke(),Ae.style.removeProperty("background-color")}async function Ie(){if(Ae.value="",Re(),0===Te.value.length)return Te.style.setProperty("background-color",a),!1;if(Ee.value===Se.value)return Ae.style.setProperty("background-color",a),!1;const t=m();if(0===t.length)return console.warn("Private part is empty"),!1;const e=parseInt(Ee.value,10),n=parseInt(Se.value,10),r=G(t),o=function(t){t.length%2!=0&&(t="0"+t);const e=new Uint8Array(t.length/2);for(let n=0;n<e.byteLength;n+=1)e[n]=parseInt(t.substr(2*n,2),16);return e.buffer}(Te.value),i=await be[e].decrypt(o,r,M.none),s=await be[n].encrypt(i,r,M.none);var u;return Ae.value=(u=s,Array.prototype.map.call(new Uint8Array(u),t=>("00"+t.toString(16)).slice(-2)).join("")),!0}class Me{constructor(t){this.secureLocalStorage=t,this.token=null,this.oneTimePassword=null,this.currentVaultContentHash=null,this.username=null,this.repositoryName=null,this.vaultFilename=null}getUsername(){return this.username}getRepositoryName(){return this.repositoryName}getVaultFilename(){return this.vaultFilename}clear(){this.secureLocalStorage.removeItem(Ne.LOCAL_STORAGE_KEY_USERNAME),this.secureLocalStorage.removeItem(Ne.LOCAL_STORAGE_KEY_REPO),this.secureLocalStorage.removeItem(Ne.LOCAL_STORAGE_KEY_FILENAME),this.secureLocalStorage.removeItem(Me.AUTH_TOKEN_KEY_NAME)}constructTokenAuthString(){return`token ${this.token}`}constructFetchRequest(t,e,n){const r={Accept:"application/vnd.github.v3+json","Content-Type":"application/json",Authorization:e};return this.oneTimePassword&&(r["x-github-otp"]=this.oneTimePassword),{method:t,headers:r,body:n?JSON.stringify(n):void 0}}constructUrl(t){return`${Me.BASE_URL}${t}`}async request(t,e,n,r,a){const o=this.constructUrl(n),i=this.constructFetchRequest(e,r,a);let s=await fetch(o,i);return 401===s.status&&t?(this.oneTimePassword=prompt("Input your 2FA code:"),this.oneTimePassword?await this.request(t,e,n,r,a):null):s}getSetVaultParameter(t,e){let n=window.localStorage.getItem(t);return n||(n=prompt(e),n?(window.localStorage.setItem(t,n),n):null)}ensureVaultParameters(){const t=this.getSetVaultParameter(Me.LOCAL_STORAGE_KEY_USERNAME,"GitHub account username:");if(!t)return Promise.resolve(!1);this.username=t;const e=this.getSetVaultParameter(Me.LOCAL_STORAGE_KEY_REPO,"Vault GitHub repository name:");if(!e)return Promise.resolve(!1);this.repositoryName=e;const n=this.getSetVaultParameter(Me.LOCAL_STORAGE_KEY_FILENAME,"Vault filename:");return n?(this.vaultFilename=n,Promise.resolve(!0)):Promise.resolve(!1)}async ensureToken(){let t=await this.secureLocalStorage.getItem(Me.AUTH_TOKEN_KEY_NAME);return null===t&&(t=await this.getToken()),!!t&&(await this.secureLocalStorage.setItem(Me.AUTH_TOKEN_KEY_NAME,t),this.token=t,!0)}constructVaultFileUrl(){return`/repos/${this.username}/${this.repositoryName}/contents/${this.vaultFilename}`}async getVaultContent(){if(!1===await this.ensureVaultParameters())return null;if(!1===await this.ensureToken())return null;const t=this.constructVaultFileUrl(),e=await this.request(!1,"GET",t,this.constructTokenAuthString());if(null===e)return console.warn("Fetching vault content aborted."),null;if(!1===e.ok)return 401===e.status?(this.secureLocalStorage.removeItem(Me.AUTH_TOKEN_KEY_NAME),this.token=null,this.oneTimePassword=null,await this.getVaultContent()):(console.error(`Failed to fetch vault file '${this.vaultFilename}'.`,e),null);const n=await e.json();return this.currentVaultContentHash=n.sha,atob(n.content)}async setVaultContent(t,e){if(!1===await this.ensureVaultParameters())return!1;if(!1===await this.ensureToken())return!1;const n={message:e,content:btoa(t),sha:this.currentVaultContentHash},r=this.constructVaultFileUrl(),a=await this.request(!1,"PUT",r,this.constructTokenAuthString(),n);if(null===a)return console.warn("Push new vault content aborted."),!1;const o=await a.json();return!1===a.ok?(console.error(`Failed to create/update vault file '${this.vaultFilename}'.`,a,o),!1):(this.currentVaultContentHash=o.content.sha,!0)}}Me.BASE_URL="https://api.github.com",Me.AUTH_TOKEN_KEY_NAME="GitHubVaultStorageBase.AuthToken",Me.LOCAL_STORAGE_KEY_USERNAME="GitHubVaultStorageBase.Username",Me.LOCAL_STORAGE_KEY_REPO="GitHubVaultStorageBase.Repository",Me.LOCAL_STORAGE_KEY_FILENAME="GitHubVaultStorageBase.Filename";class Ne extends Me{constructor(t){super(t),this.basicAuthHeader=null,this.authorizationName=null}clear(){super.clear(),this.secureLocalStorage.removeItem(Ne.LOCAL_STORAGE_KEY_PASSWORD_PUBLIC),this.secureLocalStorage.removeItem(Ne.LOCAL_STORAGE_KEY_PASSWORD_LENGTH),this.secureLocalStorage.removeItem(Ne.LOCAL_STORAGE_KEY_BROWSER_NAME)}constructBasicAuthString(t,e){return console.log("username:",t),console.log("password:",e),`Basic ${btoa(`${t}:${e}`)}`}async listAuthorizations(){if(!this.basicAuthHeader)return null;const t=await this.request(!0,"GET","/authorizations",this.basicAuthHeader);return null===t?(console.warn("List authorizations aborted."),null):!1===t.ok?(console.error("Failed to list authorizations.",t),null):await t.json()}async deleteAuthorization(t){if(!this.basicAuthHeader)return!1;const e=await this.request(!0,"DELETE",`/authorizations/${t.id}`,this.basicAuthHeader);return null===e?(console.warn("Delete authorization aborted."),!1):(!1===e.ok&&console.error(`Failed to delete authorization '${t.id}'.`,e),e.ok)}async createAuthorization(){if(!this.authorizationName)return null;if(!this.basicAuthHeader)return null;const t={scopes:["repo"],note:this.authorizationName},e=await this.request(!0,"POST","/authorizations",this.basicAuthHeader,t);return null===e?(console.warn("Create new authorization aborted."),null):!1===e.ok?(console.error("Failed to create new authorization.",e),null):(await e.json()).token}findAuthorization(t){if(!this.authorizationName)return null;for(const e of t)if(e.app&&e.app.name===this.authorizationName)return e;return null}async ensureVaultParameters(){if(!1===await super.ensureVaultParameters())return!1;const t=this.getUsername();if(!t)return!1;const e=this.getSetVaultParameter(Ne.LOCAL_STORAGE_KEY_PASSWORD_PUBLIC,"GitHub account password public part:");if(!e)return!1;const n=this.getSetVaultParameter(Ne.LOCAL_STORAGE_KEY_PASSWORD_LENGTH,"GitHub account password length:");if(!n)return!1;const r=parseInt(n,10);if(!1===Number.isSafeInteger(r)||r<=0)return!1;let a=await zt(e,M.none);if(!a)return!1;this.basicAuthHeader=this.constructBasicAuthString(t,a.substr(0,r));const o=this.getSetVaultParameter(Ne.LOCAL_STORAGE_KEY_BROWSER_NAME,"Current device/browser name:");return!!o&&(this.authorizationName=`${Ne.AUTHORIZATION_NAME} (${o})`,!0)}async getToken(){const t=await this.listAuthorizations();if(null===t)return null;const e=this.findAuthorization(t);return null!==e&&!1===await this.deleteAuthorization(e)?null:await this.createAuthorization()}}Ne.AUTHORIZATION_NAME="github.com/TanukiSharp/ItchyPassword",Ne.LOCAL_STORAGE_KEY_PASSWORD_PUBLIC="GitHubApiVaultStorage.PasswordPublicPart",Ne.LOCAL_STORAGE_KEY_PASSWORD_LENGTH="GitHubApiVaultStorage.PasswordLength",Ne.LOCAL_STORAGE_KEY_BROWSER_NAME="GitHubApiVaultStorage.BrowserName";const He=o("divTabVault"),Ve=o("btnTabVault"),Ue=o("txtVault"),Ge=o("btnRefreshVault"),Be=o("btnClearVaultSettings");let Ke=new class extends Me{getToken(){const t=prompt("Personal access token:");return Promise.resolve(t)}}(new class{get length(){return window.localStorage.length}clear(){window.localStorage.clear()}key(t){return window.localStorage.key(t)}removeItem(t){window.localStorage.removeItem(t)}async getItem(t){const e=window.localStorage.getItem(t);return null===e?null:await ye(e,M.none)}async setItem(t,e){const n=await pe(e,M.none);null!==n?window.localStorage.setItem(t,n):console.error("Failed to encrypt value. (nothing stored)")}});async function xe(){return m().length>0==!1?(alert("You must enter a master key first."),!1):await async function(){const t=await Ke.getVaultContent();return Ue.value=t||"<error>",null!==t}()}function Fe(){"y"===prompt("Are you sure you want to clear the vault settings ?\nType 'y' to accept","")&&Ke.clear()}const ze=[{getTabButton:()=>o("btnTabNothing"),getTabContent:()=>o("divTabNothing"),onTabSelected(){Q()}},new class{init(){y.addEventListener("click",E),d.addEventListener("input",P),p.addEventListener("input",_),L(),y.title=l}},new class{getTabButton(){return tt}getTabContent(){return et}onTabSelected(){X(),It()}init(){var t,e,n;t=async()=>await $t(M.none),v.push(t),lt.max=At.toString(),lt.value=At.toString(),i(it,_t),i(ot,Ot),e=wt,(n=vt).addEventListener("click",()=>{"password"===e.type?(e.type="input",n.innerHTML="Hide"):(e.type="password",n.innerHTML="View")}),s(rt,st),Lt=s(wt,mt),lt.addEventListener("input",Nt),ht.addEventListener("input",Ht),pt.addEventListener("input",Bt),i(gt,Kt),rt.addEventListener("input",qt),u(Tt,!1),function(t,e,n){let r=e;t.addEventListener("click",(function(){r=!r,c(n,r)})),c(n,r)}(ut,!1,[dt,pt,yt,ft,ct,lt,ht]),Vt(),Mt(),Yt()}},new class{getTabButton(){return Zt}getTabContent(){return Xt}onTabSelected(){X(),de()}init(){s(ne,ie),i(re,fe),i(ae,ge),te.addEventListener("input",()=>{de()}),ee.addEventListener("input",()=>{ee.value.length>0&&ue()}),oe.addEventListener("click",()=>{ee.value=""}),se.addEventListener("click",()=>{he("")})}},new class{getTabButton(){return ve}getTabContent(){return me}onTabSelected(){Q()}init(){s(Ae,_e),Ce(Ee,be.length-2),Ce(Se,be.length-1),Te.addEventListener("input",()=>{Te.value.length>0&&ke()}),Le.addEventListener("click",()=>{Te.value=""}),Oe.addEventListener("click",()=>{Ae.value=""}),i(Pe,Ie)}},new class{init(){F.addEventListener("input",$),K.addEventListener("input",D)}},new class{getTabButton(){return Ve}getTabContent(){return He}onTabSelected(){Q()}init(){i(Ge,xe),Be.addEventListener("click",Fe)}}],De=ze.filter(t=>void 0!==t.getTabButton),$e=ze.filter(t=>void 0!==t.init);new class{constructor(t){this.tabs=t,this._activeTabIndex=-1;for(let e=0;e<this.tabs.length;e+=1)t[e].getTabButton().addEventListener("click",()=>{this.setActiveTab(e)});this.setActiveTab(0)}get activeTabIndex(){return this._activeTabIndex}set activeTabIndex(t){if(t<0||t>=this.tabs.length)throw new Error(`Argument 'index' out of range. Must be in range [0;${this.tabs.length-1}].`);this.setActiveTab(t)}setActiveTab(t){if(t===this._activeTabIndex)return;let e;for(e of this.tabs){const t=e.getTabButton();t.style.removeProperty("font-weight"),t.style.setProperty("color","#C0C0C0"),e.getTabContent().style.setProperty("display","none")}const n=this.tabs[t].getTabButton();n.style.setProperty("font-weight","bold"),n.style.removeProperty("color"),this.tabs[t].getTabContent().style.removeProperty("display"),this._activeTabIndex=t,this.tabs[t].onTabSelected()}}(De);const je="5c606eaf213d564150748490c65fdfc409b5c049".substr(0,11);let Ye;for(Ye of(o("divInfo").innerHTML=`${je}<br/><a href="https://github.com/TanukiSharp/ItchyPassword" target="_blank">github</a>`,$e))Ye.init()}]);
//# sourceMappingURL=bundle.js.map
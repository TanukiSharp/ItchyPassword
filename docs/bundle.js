!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);function r(t){const e=document.getElementById(t);if(null===t)throw new Error(`DOM element '${t}' not found.`);return e}async function i(t){try{return await navigator.clipboard.writeText(t),!0}catch(t){return console.error(t.stack||t),!1}}function o(t){t.value="",t.focus()}function s(t,e){const n=function(t,e){let n=void 0;return{start:()=>{void 0!==n&&(clearTimeout(n),n=void 0),t()},end:()=>{void 0!==n&&clearTimeout(n),n=setTimeout(t,e)}}}(()=>{t.classList.remove("good-flash"),t.classList.remove("bad-flash")},1e3),r=async()=>{t.disabled=!0,n.start();try{const r=e();let i;i=r instanceof Promise?await r:r,void 0===i||!0===i?t.classList.add("good-flash"):t.classList.add("bad-flash")}catch(e){t.classList.add("bad-flash"),console.error(e.message||e)}finally{n.end(),t.disabled=!1}};return t.addEventListener("click",r),r}function a(t,e){return s(e,()=>i(t.value))}function l(t,e){e?t.style.removeProperty("display"):t.style.setProperty("display","none")}function u(t,e){for(const n of t)l(n,e)}class c{constructor(t){this.tabs=t,this._activeTabIndex=-1;for(let e=0;e<this.tabs.length;e+=1)t[e].getTabButton().addEventListener("click",()=>{this.setActiveTab(e)});this.setActiveTab(0)}get activeTabIndex(){return this._activeTabIndex}set activeTabIndex(t){if(t<0||t>=this.tabs.length)throw new Error(`Argument 'index' out of range. Must be in range [0;${this.tabs.length-1}].`);this.setActiveTab(t)}setActiveTab(t){if(t===this._activeTabIndex)return;let e;for(e of this.tabs){const t=e.getTabButton();t.style.removeProperty("font-weight"),t.style.setProperty("color","#C0C0C0"),e.getTabContent().style.setProperty("display","none")}const n=this.tabs[t].getTabButton();n.style.setProperty("font-weight","bold"),n.style.removeProperty("color"),this.tabs[t].getTabContent().style.removeProperty("display"),this._activeTabIndex=t,this.tabs[t].onTabSelected()}}const h="Stores the string in memory and removes it from the UI component. Prevents a physical intruder from copy/pasting the value.",d=r("txtPrivatePart"),p=r("txtPrivatePartConfirmation"),f=r("btnProtect"),y=r("spnProtectedConfirmation"),g=r("spnPrivatePartSize"),m=r("spnPrivatePartSizeConfirmation");let w;const b=[];function v(){return void 0!==w?w:d.value}function E(){0!==d.value.length&&(w=d.value,y.innerHTML="Protected",o(d),o(p),g.innerHTML="0",m.innerHTML="0",d.disabled=!0,p.disabled=!0,f.innerHTML="Clear and unlock",f.title="Removes the string form memory and re-enables the UI component.",L())}function T(){void 0===w?E():(w=void 0,y.innerHTML="",d.disabled=!1,p.disabled=!1,f.innerHTML="Protect and lock",f.title=h,f.disabled=!0)}function S(){T()}const A=new class{constructor(t,e){this.action=t,this.delay=e}reset(t){void 0!==this.timeout&&clearTimeout(this.timeout);const e=void 0!==t?t:this.delay;this.timeout=setTimeout(()=>{this.action(),this.timeout=void 0},e)}}(E,6e4);function C(){let t;for(t of(f.disabled=0===d.value.length,g.innerHTML=d.value.length.toString(),L(),b))t();A.reset()}function L(){p.value===d.value?p.style.setProperty("background","#D0FFD0"):p.style.setProperty("background","#FFD0D0")}function P(){m.innerHTML=p.value.length.toString(),A.reset(),L()}function _(t){const e=(t=function(t){if(t.byteLength>65535)throw new Error(`Buffer too large: ${t.byteLength} bytes`);let e=t.byteLength;const n=new Uint8Array(2+t.byteLength);for(let t=0;t<2;t+=1)n[t]=e%256,e/=256;return n.set(new Uint8Array(t),2),n.buffer}(t)).byteLength,n=new DataView(t,0);let r=0n,i=1n;for(let t=0;t<e;t+=1)r+=BigInt(n.getUint8(t))*i,i*=256n;return r}function O(t,e){const n=BigInt(e.length);let r="",i=function(t){const e=t.byteLength,n=new DataView(t,0);let r=0n,i=1n;for(let t=0;t<e;t+=1)r+=BigInt(n.getUint8(t))*i,i*=256n;return r}(t);for(;i>0n;){const t=i%n;i/=n,r+=e[BigInt.asUintN(8,t)]}return r}function R(t,e){const n=BigInt(e.length);let r=0n,i=1n;for(let o=0;o<t.length;o+=1){r+=BigInt(e.indexOf(t[o]))*i,i*=n}return function(t){const e=[];for(;t>0n;){const n=t%256n;t/=256n;const r=Number(BigInt.asUintN(8,n));e.push(r)}let n=e[0];e.length>1&&(n+=256*e[1]);const r=n-(e.length-2);for(let t=0;t<r;t+=1)e.push(0);return new Uint8Array(e.slice(2)).buffer}(r)}class k extends Error{constructor(t){super(t),this._name=k.ERROR_NAME,Object.setPrototypeOf(this,new.target.prototype)}get name(){return this._name}static isMatching(t){return t&&t.name===k.ERROR_NAME}}k.ERROR_NAME="TaskCancelledError";class V{constructor(){this._isCancelled=!1,this._token=new I(this)}get isCancelled(){return this._isCancelled}get token(){return this._token}cancel(){this._isCancelled=!0}}class I{constructor(t){this.source=t}static get none(){return I._none}get isCancelled(){return this.source.isCancelled}}function x(t){if(t.isCancelled)throw new k}I._none=new I(new V);const M="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";async function N(t,e,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveKey"]);x(n);const i={name:"PBKDF2",hash:"SHA-512",iterations:1e5,salt:e},o=await window.crypto.subtle.deriveKey(i,r,{name:"AES-CBC",length:256},!0,["encrypt"]);x(n);const s=await window.crypto.subtle.exportKey("raw",o);return x(n),s}function H(t=64,e=M){return O(function(t=64){const e=new Uint8Array(t);return crypto.getRandomValues(e).buffer}(t),e)}function U(t,e){return t.length<=e?t:t.substr(0,e)}function F(t){return(new TextEncoder).encode(t).buffer}function B(t){return null!=t&&!1===t.hasOwnProperty("constructor")&&"Object"===t.constructor.name}function G(t){const e={};for(const[n,r]of Object.entries(t).sort((t,e)=>t[0].localeCompare(e[0])))e[n]=B(r)?G(r):r;return e}const D={};function K(t){if(!t)throw new TypeError("Argument 'serviceName' is mandatory.");const e=D[t];if(void 0===e)throw new Error(`Service '${t}' is not registered.`);return e}function j(t,e){if(!t)throw new TypeError("Argument 'serviceName' is mandatory.");if(void 0===e)throw new TypeError("Argument 'instance' cannot be undefined.");if(void 0!==D[t])throw new Error(`Service '${t}' is already registered.`);D[t]=e}const z=r("divStorageOutput"),Y=r("txtPath"),$=r("lblMatchingPath"),W=r("txtParameters"),q=r("txtCustomKeys");function J(){!function(){const t=K("vault").computeUserPathMatchDepth(Y.value);if(t>0){const e=function(t,e){let n=0;for(let r=0;r<e;r+=1){if(n=t.indexOf("/",n),n<0){n=t.length+1;break}n+=1}return t.substr(0,n-1)}(Y.value,t);$.innerText=e}else $.innerText=""}(),X()}function Z(){X()}function X(){if(void 0===tt||void 0===et||void 0===nt)return;const t=function t(e,n){const r=e.indexOf("/"),i={},o=r>=0?e.substr(0,r):e,s=r>=0?e.substr(r+1):void 0;if(void 0===n){const t={};t[o]=i,n={head:t,tailParent:t,tail:i}}else n.tail[o]=i,n.tailParent=n.tail,n.tail=i;return s?t(s,n):n}(`${Y.value}/${et}`),e=t.tail;for(const[t,n]of Object.entries(tt))e[t]=n;const n=function(){if(""===q.value)return{};try{const t=JSON.parse(q.value);return null===t||"Object"!==t.constructor.name?null:t}catch{return null}}();null!==n?q.style.removeProperty("background"):q.style.setProperty("background","#FFD0D0");const r=function(t,e,n){const r={};if(null!==t)for(const[e,i]of Object.entries(t))!1===n.includes(e)&&(r[e]=i);if(null!==e)for(const[t,n]of Object.entries(e))r[t]=n;return r}(n,e,nt);0===Object.keys(r).length?t.tailParent[Object.keys(t.tailParent)[0]]=null:t.tailParent[Object.keys(t.tailParent)[0]]=r,W.value=JSON.stringify(G(t.head),void 0,4)}function Q(){tt=void 0,et=void 0,nt=void 0,o(W)}let tt,et,nt;function rt(t,e,n){tt=t,et=e,nt=n,X()}function it(){z.style.setProperty("display","initial")}function ot(){z.style.setProperty("display","none")}class st{async generateAndCopyPasswordToClipboard(t,e,n){e=void 0!==e?e:Rt,n=void 0!==n?n:Ot;const r=await Jt(t,e,I.none);if(null===r)return!1;const o=U(r,Math.max(4,n));return await i(o)}}const at=r("btnTabPasswords"),lt=r("divTabPasswords"),ut=new class{constructor(t){this.hkdfPurpose=F(t),this._description=`HKDF(PBKDF2, HMAC512) [purpose: ${t}]`}get version(){return 1}get description(){return this._description}async generatePassword(t,e,n){const r=await N(t,e,n);x(n);const i=await window.crypto.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-512"}},!1,["sign"]);x(n);const o=await window.crypto.subtle.sign("HMAC",i,this.hkdfPurpose);return x(n),o}}("Password"),ct=r("txtPublicPart"),ht=r("spnPublicPartSize"),dt=r("btnGeneratePublicPart"),pt=r("btnClearPublicPart"),ft=r("btnCopyPublicPart"),yt=r("btnShowHidePasswordOptionalFeatures"),gt=r("lblAlphabetLength"),mt=r("numOutputSizeRange"),wt=r("numOutputSizeNum"),bt=r("lblAlphabet"),vt=r("txtAlphabet"),Et=r("spnAlphabetSize"),Tt=r("divPasswordAlphabetActions"),St=r("btnResetAlphabet"),At=r("txtResultPassword"),Ct=r("spnResultPasswordLength"),Lt=r("btnViewResultPassword"),Pt=r("btnCopyResultPassword"),_t=r("lblGeneratingPassword"),Ot=64,Rt="!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~",kt=["alphabet","length","public","datetime"];let Vt,It;function xt(){return!(ct.value.length>0&&"y"!==prompt("Are you sure you want to clear the public part ?\nType 'y' to accept",""))&&(o(ct),Kt(),Nt(),Ft(),!0)}function Mt(){if(ct.value.length>0&&"y"!==prompt("Are you sure you want to generate a new public part ?\nType 'y' to accept",""))return!1;const t=H();return ct.value=t,Kt(),Nt(),Xt(),!0}function Nt(){Vt=ct.value.length>0?(new Date).toISOString():void 0}function Ht(){Ct.innerHTML=At.value.length.toString()}function Ut(t){const e=t.split("");e.sort();for(let t=1;t<e.length;t+=1)if(e[t-1]===e[t])return!1;return!0}function Ft(){if(!1===qt())return void Wt();const t={public:ct.value,datetime:Vt},e=At.value.length;e!==Ot&&(t.length=e);const n=vt.value;n!==Rt&&(t.alphabet=n),rt(t,"password",kt)}function Bt(){wt.value=mt.value}async function Gt(){Bt(),await Xt()}async function Dt(){(function(){const t=parseInt(mt.min,10),e=parseInt(wt.value,10),n=parseInt(mt.max,10);return!1===isNaN(e)&&(mt.value=Math.max(t,Math.min(e,n)).toString(),!0)})()&&Bt(),await Xt()}function Kt(){ht.innerHTML=ct.value.length.toString()}function jt(){Et.innerHTML=vt.value.length.toString()}function zt(t){t?vt.style.removeProperty("background"):vt.style.setProperty("background","#FFD0D0")}async function Yt(){const t=Ut(vt.value);zt(t),!1!==t&&(jt(),await Xt())}async function $t(){return!1!==te()&&(await Xt(),!0)}function Wt(){o(At),Q(),Ht()}function qt(t){const e=vt.value;return!1!==Ut(e)&&(t=t||ct.value,!(v().length<=0||t.length<8||e.length<2))}async function Jt(t,e,n){if(!1===qt(t))return null;const r=F(v()),i=F(t);return O(await ut.generatePassword(r,i,n),e)}const Zt=new class{constructor(){this.currentTokenSource=null,this.currentTask=null,this.microThreadId=0}get isRunning(){return null!==this.currentTask}async cancelInternal(t){this.microThreadId===Number.MAX_SAFE_INTEGER?this.microThreadId=0:this.microThreadId=this.microThreadId+1;const e=this.microThreadId;if(null===this.currentTask)return!0;if(null!==this.currentTokenSource&&(this.currentTokenSource.cancel(),null!==this.currentTask))try{await this.currentTask}catch(e){if(!k.isMatching(e))throw e;if(t)throw e}return e===this.microThreadId}async cancel(t=!1){await this.cancelInternal(t)}async cancelAndExecute(t,e=!1){if(!1===await this.cancelInternal(e)){if(!1===e)return;throw new k}var n=new V;this.currentTokenSource=n;try{return this.currentTask=t(this.currentTokenSource.token),await this.currentTask}catch(t){if(k.isMatching(t)&&!1===e)return;throw t}finally{this.currentTask=null}}};async function Xt(){if(!1!==qt()){l(_t,!0);try{await Zt.cancelAndExecute(Qt)}finally{l(_t,!1)}}else Wt()}async function Qt(t){const e=await Jt(ct.value,vt.value,t);null!==e&&(At.value=U(e,Math.max(4,parseInt(mt.value,10))),Ht(),Ft(),It())}function te(){vt.value=Rt,jt();const t=Ut(vt.value);return zt(t),t}async function ee(){Kt(),Nt(),await Xt()}class ne{get version(){return 2}get description(){return"PBKDF2 + AES-GCM"}async encrypt(t,e,n){const r=new ArrayBuffer(44+t.byteLength),i=crypto.getRandomValues(new Uint8Array(r,0,12)),o=crypto.getRandomValues(new Uint8Array(r,12,16)),s={name:"AES-GCM",iv:i},a=await window.crypto.subtle.importKey("raw",await N(e,o,n),{name:"AES-GCM",length:256},!1,["encrypt"]);x(n);const l=await window.crypto.subtle.encrypt(s,a,t);return x(n),new Uint8Array(r).set(new Uint8Array(l),28),r}async decrypt(t,e,n){const r=new Uint8Array(t,0,12),i=new Uint8Array(t,12,16),o=new Uint8Array(t,28),s={name:"AES-GCM",iv:r},a=await N(e,i,n);x(n);const l=await window.crypto.subtle.importKey("raw",a,{name:"AES-GCM",length:256},!1,["decrypt"]);x(n);const u=await window.crypto.subtle.decrypt(s,l,o);return x(n),u}}const re=["version","value"],ie=r("btnTabCiphers"),oe=r("divTabCiphers"),se=new ne,ae=r("txtCipherName"),le=r("txtCipherSource"),ue=r("txtCipherTarget"),ce=r("btnEncrypt"),he=r("btnDecrypt"),de=r("btnClearCipherSource"),pe=r("btnCopyCipherTarget"),fe=r("btnClearCipherTarget");function ye(){le.style.removeProperty("background-color")}function ge(){le.style.setProperty("background-color","#FFD0D0")}function me(){ye(),ue.style.removeProperty("background-color")}function we(t){ue.value=t,be()}function be(){if(""===ue.value||""===ae.value)return void Q();rt({version:se.version,value:ue.value},"ciphers/"+ae.value,re)}async function ve(t,e){const n=v();if(0===n.length)return console.warn("Private part is empty"),null;const r=F(t),i=F(n),o=await se.encrypt(r,i,e);return x(e),function(t,e){const n=BigInt(e.length);let r="",i=_(t);for(;i>0n;){const t=i%n;i/=n,r+=e[BigInt.asUintN(8,t)]}return r}(o,M)}async function Ee(t,e){const n=v();if(0===n.length)return console.warn("Private part is empty"),null;try{const i=R(t,M),o=F(n),s=await se.decrypt(i,o,e);return x(e),r=s,(new TextDecoder).decode(r)}catch(t){return function(t){if(k.isMatching(t))throw t}(t),console.warn("Failed to decrypt"+(t.message?", error: "+t.message:", no error message")),null}var r}async function Te(){if(le.focus(),we(""),me(),0===le.value.length)return ge(),!1;const t=await ve(le.value,I.none);return null!==t&&(we(t),!0)}async function Se(){if(le.focus(),we(""),me(),0===le.value.length)return ge(),!1;const t=await Ee(le.value,I.none);return null===t?(ue.style.setProperty("background-color","#FFD0D0"),!1):(we(t),!0)}const Ae=new Uint8Array([242,207,239,142,19,64,70,73,146,42,222,92,188,136,56,168]).buffer;const Ce=[new class{get version(){return 1}get description(){return"PBKDF2 + AES-GCM"}async encrypt(t,e,n){const r=new ArrayBuffer(28+t.byteLength),i=new DataView(r,0,12);crypto.getRandomValues(new Uint8Array(r,0,12));const o={name:"AES-GCM",iv:i},s=await window.crypto.subtle.importKey("raw",await N(e,Ae,n),{name:"AES-GCM",length:256},!1,["encrypt"]);x(n);const a=await window.crypto.subtle.encrypt(o,s,t);return x(n),new Uint8Array(r).set(new Uint8Array(a),12),r}async decrypt(t,e,n){const r=new DataView(t,0,12),i=new DataView(t,12),o={name:"AES-GCM",iv:r},s=await N(e,Ae,n);x(n);const a=await window.crypto.subtle.importKey("raw",s,{name:"AES-GCM",length:256},!1,["decrypt"]);x(n);const l=await window.crypto.subtle.decrypt(o,a,i);return x(n),l}},new ne],Le=r("btnTabReEncrypt"),Pe=r("divTabReEncrypt"),_e=r("txtReEncryptSource"),Oe=r("txtReEncryptTarget"),Re=r("cboReEncryptFrom"),ke=r("cboReEncryptTo"),Ve=r("btnReEncrypt"),Ie=r("btnClearReEncryptSource"),xe=r("btnCopyReEncryptTarget"),Me=r("btnClearReEncryptTarget");function Ne(t,e){let n;for(n of Ce){const e=document.createElement("option");e.value=t.childNodes.length.toString(),e.text=`${n.description} (v${n.version})`,t.add(e)}t.value=e.toString()}function He(){_e.style.removeProperty("background-color")}function Ue(){He(),Oe.style.removeProperty("background-color")}async function Fe(){if(o(Oe),Ue(),0===_e.value.length)return _e.style.setProperty("background-color","#FFD0D0"),!1;if(Re.value===ke.value)return Oe.style.setProperty("background-color","#FFD0D0"),!1;const t=v();if(0===t.length)return console.warn("Private part is empty"),!1;const e=parseInt(Re.value,10),n=parseInt(ke.value,10),r=F(t),i=function(t){t.length%2!=0&&(t="0"+t);const e=new Uint8Array(t.length/2);for(let n=0;n<e.byteLength;n+=1)e[n]=parseInt(t.substr(2*n,2),16);return e.buffer}(_e.value),s=await Ce[e].decrypt(i,r,I.none),a=await Ce[n].encrypt(s,r,I.none);var l;return Oe.value=(l=a,Array.prototype.map.call(new Uint8Array(l),t=>("00"+t.toString(16)).slice(-2)).join("")),!0}class Be{constructor(t){this.secureLocalStorage=t,this.token=null,this.oneTimePassword=null,this.currentVaultContentHash=null,this.username=null,this.repositoryName=null,this.vaultFilename=null}getUsername(){return this.username}getRepositoryName(){return this.repositoryName}getVaultFilename(){return this.vaultFilename}clear(){this.secureLocalStorage.removeItem(Ge.LOCAL_STORAGE_KEY_USERNAME),this.secureLocalStorage.removeItem(Ge.LOCAL_STORAGE_KEY_REPO),this.secureLocalStorage.removeItem(Ge.LOCAL_STORAGE_KEY_FILENAME),this.secureLocalStorage.removeItem(Be.AUTH_TOKEN_KEY_NAME)}constructTokenAuthString(){return"token "+this.token}constructFetchRequest(t,e,n){const r={Accept:"application/vnd.github.v3+json","Content-Type":"application/json",Authorization:e};return this.oneTimePassword&&(r["x-github-otp"]=this.oneTimePassword),{method:t,headers:r,body:n?JSON.stringify(n):void 0}}constructUrl(t){return`${Be.BASE_URL}${t}`}async request(t,e,n,r,i){const o=this.constructUrl(n),s=this.constructFetchRequest(e,r,i);let a=await fetch(o,s);return 401===a.status&&t?(this.oneTimePassword=prompt("Input your 2FA code:"),this.oneTimePassword?await this.request(t,e,n,r,i):null):a}getSetVaultParameter(t,e,n){let r=window.localStorage.getItem(t);return r||(r=prompt(e,n),r?(window.localStorage.setItem(t,r),r):null)}ensureVaultParameters(){const t=new URL(window.location.toString());let e="",n="";if("github.com"===t.hostname){const r=t.pathname.split("/");r.length>=3&&(e=r[1],n=r[2]+"Vault")}const r=this.getSetVaultParameter(Be.LOCAL_STORAGE_KEY_USERNAME,"GitHub account username:",e);if(!r)return Promise.resolve(!1);this.username=r;const i=this.getSetVaultParameter(Be.LOCAL_STORAGE_KEY_REPO,"Vault GitHub repository name:",n);if(!i)return Promise.resolve(!1);this.repositoryName=i;const o=this.getSetVaultParameter(Be.LOCAL_STORAGE_KEY_FILENAME,"Vault filename:","vault.json");return o?(this.vaultFilename=o,Promise.resolve(!0)):Promise.resolve(!1)}async ensureToken(){let t=await this.secureLocalStorage.getItem(Be.AUTH_TOKEN_KEY_NAME);return null===t&&(t=await this.getToken()),!!t&&(await this.secureLocalStorage.setItem(Be.AUTH_TOKEN_KEY_NAME,t),this.token=t,!0)}constructVaultFileUrl(){return`/repos/${this.username}/${this.repositoryName}/contents/${this.vaultFilename}`}async getVaultContent(){if(!1===await this.ensureVaultParameters())return null;if(!1===await this.ensureToken())return null;const t=this.constructVaultFileUrl(),e=await this.request(!1,"GET",t,this.constructTokenAuthString());if(null===e)return console.warn("Fetching vault content aborted."),null;if(!1===e.ok)return 401===e.status?(this.secureLocalStorage.removeItem(Be.AUTH_TOKEN_KEY_NAME),this.token=null,this.oneTimePassword=null,await this.getVaultContent()):(console.error(`Failed to fetch vault file '${this.vaultFilename}'.`,e),null);const n=await e.json();return this.currentVaultContentHash=n.sha,atob(n.content)}async setVaultContent(t,e){if(!1===await this.ensureVaultParameters())return!1;if(!1===await this.ensureToken())return!1;const n={message:e,content:btoa(t),sha:this.currentVaultContentHash},r=this.constructVaultFileUrl(),i=await this.request(!1,"PUT",r,this.constructTokenAuthString(),n);if(null===i)return console.warn("Push new vault content aborted."),!1;const o=await i.json();return!1===i.ok?(console.error(`Failed to create/update vault file '${this.vaultFilename}'.`,i,o),!1):(this.currentVaultContentHash=o.content.sha,!0)}}Be.BASE_URL="https://api.github.com",Be.AUTH_TOKEN_KEY_NAME="GitHubVaultStorageBase.AuthToken",Be.LOCAL_STORAGE_KEY_USERNAME="GitHubVaultStorageBase.Username",Be.LOCAL_STORAGE_KEY_REPO="GitHubVaultStorageBase.Repository",Be.LOCAL_STORAGE_KEY_FILENAME="GitHubVaultStorageBase.Filename";class Ge extends Be{constructor(t){super(t),this.basicAuthHeader=null,this.authorizationName=null}clear(){super.clear(),this.secureLocalStorage.removeItem(Ge.LOCAL_STORAGE_KEY_PASSWORD_PUBLIC),this.secureLocalStorage.removeItem(Ge.LOCAL_STORAGE_KEY_PASSWORD_LENGTH),this.secureLocalStorage.removeItem(Ge.LOCAL_STORAGE_KEY_BROWSER_NAME)}constructBasicAuthString(t,e){return console.log("username:",t),console.log("password:",e),"Basic "+btoa(`${t}:${e}`)}async listAuthorizations(){if(!this.basicAuthHeader)return null;const t=await this.request(!0,"GET","/authorizations",this.basicAuthHeader);return null===t?(console.warn("List authorizations aborted."),null):!1===t.ok?(console.error("Failed to list authorizations.",t),null):await t.json()}async deleteAuthorization(t){if(!this.basicAuthHeader)return!1;const e=await this.request(!0,"DELETE","/authorizations/"+t.id,this.basicAuthHeader);return null===e?(console.warn("Delete authorization aborted."),!1):(!1===e.ok&&console.error(`Failed to delete authorization '${t.id}'.`,e),e.ok)}async createAuthorization(){if(!this.authorizationName)return null;if(!this.basicAuthHeader)return null;const t={scopes:["repo"],note:this.authorizationName},e=await this.request(!0,"POST","/authorizations",this.basicAuthHeader,t);return null===e?(console.warn("Create new authorization aborted."),null):!1===e.ok?(console.error("Failed to create new authorization.",e),null):(await e.json()).token}findAuthorization(t){if(!this.authorizationName)return null;for(const e of t)if(e.app&&e.app.name===this.authorizationName)return e;return null}async ensureVaultParameters(){if(!1===await super.ensureVaultParameters())return!1;const t=this.getUsername();if(!t)return!1;const e=this.getSetVaultParameter(Ge.LOCAL_STORAGE_KEY_PASSWORD_PUBLIC,"GitHub account password public part:");if(!e)return!1;const n=this.getSetVaultParameter(Ge.LOCAL_STORAGE_KEY_PASSWORD_LENGTH,"GitHub account password length:");if(!n)return!1;const r=parseInt(n,10);if(!1===Number.isSafeInteger(r)||r<=0)return!1;let i=await Jt(e,Rt,I.none);if(!i)return!1;this.basicAuthHeader=this.constructBasicAuthString(t,i.substr(0,r));const o=this.getSetVaultParameter(Ge.LOCAL_STORAGE_KEY_BROWSER_NAME,"Current device/browser name:");return!!o&&(this.authorizationName=`${Ge.AUTHORIZATION_NAME} (${o})`,!0)}async getToken(){const t=await this.listAuthorizations();if(null===t)return null;const e=this.findAuthorization(t);return null!==e&&!1===await this.deleteAuthorization(e)?null:await this.createAuthorization()}}Ge.AUTHORIZATION_NAME="github.com/TanukiSharp/ItchyPassword",Ge.LOCAL_STORAGE_KEY_PASSWORD_PUBLIC="GitHubApiVaultStorage.PasswordPublicPart",Ge.LOCAL_STORAGE_KEY_PASSWORD_LENGTH="GitHubApiVaultStorage.PasswordLength",Ge.LOCAL_STORAGE_KEY_BROWSER_NAME="GitHubApiVaultStorage.BrowserName";class De{constructor(t,e,n,r,i){this.children=[],this.titleElement=null,this.isHint=!1,this.isCipher=!1,this.isPassword=!1,this.verticalLineElement=null,this.parent=t,this.title=n;let o=!1;if(De.isCiphersObject(n,i)||(De.isCipherObject(i)?(this.isCipher=!0,o=!0):De.isPasswordObject(n,i)?(this.isPassword=!0,o=!0):B(i)||(this.isHint=!0)),this.rootElement=document.createElement("div"),this.setRootElementStyle(),t){const t={isCipher:this.isCipher,isPassword:this.isPassword,path:e,key:n,value:i};this.titleElement=r.createTreeNodeTitleElement(t),this.titleElement.innerText=n,this.rootElement.appendChild(this.titleElement),this.setTitleElementStyle()}if(this.childrenContainerElement=document.createElement("div"),this.rootElement.appendChild(this.childrenContainerElement),this.setChildrenContainerElementStyle(),!1===o&&B(i))for(const[t,n]of Object.entries(i)){const i=new De(this,`${e}/${t}`,t,r,n);this.addChild(i)}else this.value=i;t&&this.setupLinesElements("#D0D0D0")}get element(){return this.rootElement}get isVisible(){return"none"!==this.rootElement.style.display}getVisibleChildCount(){let t=0;for(const e of this.children)e.isVisible&&(t+=1);return t}getVisibleLeafCount(){if(!1===this.isVisible)return 0;let t=1;for(const e of this.children)t+=e.getVisibleLeafCount();return t}addChild(t){this.childrenContainerElement.appendChild(t.rootElement),this.children.push(t)}static isPasswordObject(t,e){return"password"===t&&!(!e||!B(e)||"string"!=typeof e.public||e.public.length<4)}static isCipherObject(t){return!(!t||!B(t))&&(!("string"!=typeof t.value||t.value.length<=0)&&!("number"!=typeof t.version||t.version<0))}static isCiphersObject(t,e){if("ciphers"!==t)return!1;if(!e||!B(e))return!1;for(const t of Object.values(e))if(!De.isCipherObject(t))return!1;return!0}setRootElementStyle(){this.rootElement.classList.add("treenode-root"),this.rootElement.style.display="grid";let t=4,e=0;this.parent&&(t=24),this.parent&&this.parent.parent&&(e=12),this.rootElement.style.gridTemplateRows=t+"px 1fr",this.rootElement.style.gridTemplateColumns=e+"px 6px 1fr"}setupLinesElements(t){const e=document.createElement("div");if(e.classList.add("treenode-vertical-line"),e.style.gridColumn="2",e.style.gridRow="2",e.style.width="100%",e.style.borderRight="1px solid "+t,this.verticalLineElement=e,this.rootElement.appendChild(e),this.parent&&this.parent.parent){const e=document.createElement("div");e.classList.add("treenode-horizontal-line"),e.style.gridColumn="1",e.style.gridRow="1",e.style.width="100%",e.style.height="11px",e.style.borderBottom="1px solid "+t,this.rootElement.appendChild(e)}this.updateLines()}updateLines(){if(null===this.verticalLineElement)return;const t=this.getVisibleChildCount();if(0===t)return void(this.verticalLineElement.style.height="0px");let e=1;for(let n=0;n<t-1;n+=1)this.children[n].isVisible&&(e+=this.children[n].getVisibleLeafCount());const n=24*e-24+11+1;this.verticalLineElement.style.height=n+"px"}setTitleElementStyle(){this.titleElement&&(this.titleElement.classList.add("treenode-title"),this.titleElement.style.gridColumn="2 / span 2",this.titleElement.style.gridRow="1",this.titleElement.style.marginLeft="3px")}setChildrenContainerElementStyle(){this.childrenContainerElement.classList.add("treenode-children-container"),this.childrenContainerElement.style.gridColumn="3",this.childrenContainerElement.style.gridRow="2"}resetTitle(t){if(this.titleElement&&(this.titleElement.innerHTML="",this.titleElement.innerText=this.title),1===t&&this.parent&&this.parent.resetTitle(t),2===t)for(const e of this.children)e.resetTitle(t)}show(t){if(this.rootElement.style.display="grid",1===t&&this.parent&&this.parent.show(t),2===t)for(const e of this.children)e.show(t);this.updateLines()}hide(t){if(this.rootElement.style.display="none",1===t&&this.parent&&this.parent.hide(t),2===t)for(const e of this.children)e.hide(t);this.updateLines()}static createSpan(t,e){const n=document.createElement("span");return e&&(n.style.backgroundColor=e,n.style.borderRadius="2px"),n.innerText=t,n}static createColoredSpan(t,e){const n=document.createElement("span");let r=0;for(const i of e)i.pos!==r&&n.appendChild(De.createSpan(t.substr(r,i.pos-r))),n.appendChild(De.createSpan(t.substr(i.pos,i.len),"#80C0FF")),r=i.pos+i.len;return r<t.length&&n.appendChild(De.createSpan(t.substr(r,t.length-r))),n}filter(t,e){if(!t)return this.resetTitle(2),this.show(2),void this.updateLines();const n=[];e(this.title,t,n)?(this.titleElement&&(this.titleElement.innerHTML="",this.titleElement.appendChild(De.createColoredSpan(this.title,n))),this.show(1),this.show(2)):this.resetTitle(2);for(const n of this.children)n.filter(t,e);this.updateLines()}}const Ke=r("btnTabVaultTabTreeView"),je=r("divTabVaultTabTreeView"),ze=r("trvVaultTreeView"),Ye=r("txtVaultTreeViewSearch"),$e=r("cboVaultTreeViewSearchType");let We;const qe=[{text:"Aggresive",function:function(t,e,n){return function t(e,n,r,i){if(!r)return!0;e=e.toLowerCase();for(let o=(r=r.toLowerCase()).length;o>=1;o-=1){const s=r.substr(0,o),a=e.indexOf(s,n);if(a>=0)return i.push({pos:a,len:s.length}),t(e,a+s.length,r.substr(o),i)}return!1}(t,0,e,n)}},{text:"Regular",function:function(t,e,n){const r=t.toLowerCase().indexOf(e.toLowerCase());return!(r<0)&&(n.push({pos:r,len:e.length}),!0)}}];function Je(){if(!We)return;const t=$e.selectedIndex,e=qe[t].function;We.hide(2),We.filter(Ye.value.toLocaleLowerCase(),e)}class Ze{constructor(){this.passwordService=K("password")}async run(t){const e=t.value;await this.passwordService.generateAndCopyPasswordToClipboard(e.public,e.alphabet,e.length)}createTreeNodeTitleElement(t){if(t.isPassword){const e=document.createElement("button");return e.style.justifySelf="start",e.style.minWidth="80px",s(e,async()=>await this.run(t)),e}return document.createElement("div")}}const Xe=r("btnTabVaultTabTextView"),Qe=r("divTabVaultTabTextView"),tn=r("txtVault");class en{constructor(t){this.vaultComponent=t}computeUserPathMatchDepth(t){return this.vaultComponent.computeUserPathMatchDepth(t)}}const nn=r("divTabVault"),rn=r("btnTabVault"),on=r("btnRefreshVault"),sn=r("btnClearVaultSettings"),an=[new class{onVaultLoaded(t){We=new De(null,"<root>","",new Ze,t),ze.innerHTML="",ze.appendChild(We.element),Je()}getTabButton(){return Ke}getTabContent(){return je}onTabSelected(){Ye.focus()}init(){!function(){$e.innerHTML="";for(let t of qe){const e=document.createElement("option");e.text=t.text,$e.appendChild(e)}}(),Ye.addEventListener("input",Je),$e.addEventListener("change",Je)}},new class{onVaultLoaded(t){tn.value=JSON.stringify(t,void 0,4)}getTabButton(){return Xe}getTabContent(){return Qe}onTabSelected(){}init(){}}],ln=an.filter(t=>void 0!==t.getTabButton),un=an.filter(t=>void 0!==t.init),cn=new c(ln);let hn=new class extends Be{getToken(){const t=prompt("Personal access token:");return Promise.resolve(t)}}(new class{get length(){return window.localStorage.length}clear(){window.localStorage.clear()}key(t){return window.localStorage.key(t)}removeItem(t){window.localStorage.removeItem(t)}async getItem(t){const e=window.localStorage.getItem(t);return null===e?null:await Ee(e,I.none)}async setItem(t,e){const n=await ve(e,I.none);null!==n?window.localStorage.setItem(t,n):console.error("Failed to encrypt value. (nothing stored)")}}),dn=null;async function pn(){return v().length>0==!1?(alert("You must enter a master key first."),!1):await async function(){let t=await hn.getVaultContent();if(null===t)return!1;try{let e,n=JSON.parse(t);for(e of(n=G(n),dn=n,un))e.onVaultLoaded(n);return!0}catch(t){return dn=null,console.error(t),!1}}()}function fn(){"y"===prompt("Are you sure you want to clear the vault settings ?\nType 'y' to accept","")&&hn.clear()}const yn=[{getTabButton:()=>r("btnTabNothing"),getTabContent:()=>r("divTabNothing"),onTabSelected(){ot()}},new class{init(){f.addEventListener("click",S),d.addEventListener("input",C),p.addEventListener("input",P),L(),f.title=h,d.focus()}},new class{getTabButton(){return at}getTabContent(){return lt}onTabSelected(){it(),Ft(),ct.focus()}init(){var t,e,n;t=Xt,b.push(t),mt.max=Ot.toString(),mt.value=Ot.toString(),s(pt,xt),s(dt,Mt),e=At,(n=Lt).addEventListener("click",()=>{"password"===e.type?(e.type="input",n.innerHTML="Hide"):(e.type="password",n.innerHTML="View")}),a(ct,ft),It=a(At,Pt),mt.addEventListener("input",Gt),wt.addEventListener("input",Dt),vt.addEventListener("input",Yt),s(St,$t),ct.addEventListener("input",ee),l(_t,!1),function(t,e,n){let r=e;t.addEventListener("click",(function(){r=!r,u(n,r)})),u(n,r)}(yt,!1,[bt,vt,Et,Tt,gt,mt,wt]),Kt(),Bt(),te(),j("password",new st)}},new class{getTabButton(){return ie}getTabContent(){return oe}onTabSelected(){it(),be(),ae.focus()}init(){a(ue,pe),s(ce,Te),s(he,Se),ae.addEventListener("input",()=>{be()}),le.addEventListener("input",()=>{le.value.length>0&&ye()}),de.addEventListener("click",()=>{o(le)}),fe.addEventListener("click",()=>{we("")})}},new class{getTabButton(){return Le}getTabContent(){return Pe}onTabSelected(){ot(),_e.focus()}init(){a(Oe,xe),Ne(Re,Ce.length-2),Ne(ke,Ce.length-1),_e.addEventListener("input",()=>{_e.value.length>0&&He()}),Ie.addEventListener("click",()=>{o(_e)}),Me.addEventListener("click",()=>{o(Oe)}),s(Ve,Fe)}},new class{init(){q.addEventListener("input",Z),Y.addEventListener("input",J)}},new class{computeUserPathMatchDepth(t){return function(t){if(null===dn)return 0;let e=dn;const n=t.split("/");for(let t=0;t<n.length;t+=1){if(!e[n[t]])return t;e=e[n[t]]}return n.length}(t)}getTabButton(){return rn}getTabContent(){return nn}onTabSelected(){ot(),ln[cn.activeTabIndex].onTabSelected()}init(){s(on,pn),sn.addEventListener("click",fn);const t=new en(this);let e;for(e of(j("vault",t),un))e.init()}}],gn=yn.filter(t=>void 0!==t.getTabButton),mn=yn.filter(t=>void 0!==t.init);new c(gn);const wn="21111e0f40310a009fb92f494b628ab4f39ee5be".substr(0,11);let bn;for(bn of(r("divInfo").innerHTML=wn+'<br/><a href="https://github.com/TanukiSharp/ItchyPassword" target="_blank">github</a>',mn))bn.init()}]);
//# sourceMappingURL=bundle.js.map
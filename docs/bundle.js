(()=>{"use strict";const t="#FFD0D0";function e(t){const e=document.getElementById(t);if(null===t)throw new Error(`DOM element '${t}' not found.`);return e}async function n(t,e){try{return await navigator.clipboard.writeText(t),!0}catch(t){const n=t;return console.error(n.stack||t),e?.(n.stack||t),!1}}function r(t,e=!1){t.value="",e&&t.focus()}function o(t,e,n){const r=function(t){let e;return{start:()=>{void 0!==e&&(clearTimeout(e),e=void 0),t()},end:()=>{void 0!==e&&clearTimeout(e),e=setTimeout(t,1e3)}}}((()=>{t.classList.remove("good-flash"),t.classList.remove("bad-flash")})),o=async()=>{t.disabled=!0,r.start();try{const n=e();let r;r=n instanceof Promise?await n:n,void 0===r||!0===r?t.classList.add("good-flash"):t.classList.add("bad-flash")}catch(e){const r=e;t.classList.add("bad-flash"),console.error(r.stack||e),n?.(r.stack||e)}finally{r.end(),t.disabled=!1}};return t.addEventListener("click",o),o}function s(t,e,r){return o(e,(()=>n(t.value)),r)}function i(t,e){e?t.style.removeProperty("display"):t.style.setProperty("display","none")}function a(t,e){for(const n of t)i(n,e)}class l{tabs;_activeTabIndex=-1;get activeTabIndex(){return this._activeTabIndex}set activeTabIndex(t){if(t<0||t>=this.tabs.length)throw new Error(`Argument 'index' out of range. Must be in range [0;${this.tabs.length-1}].`);this.setActiveTab(t)}constructor(t){this.tabs=t;for(let e=0;e<this.tabs.length;e+=1)t[e].getTabButton().addEventListener("click",(()=>{this.setActiveTab(e)}));this.setActiveTab(0)}setActiveTab(t){if(t===this._activeTabIndex)return;let e;for(e of this.tabs){const t=e.getTabButton();t.style.removeProperty("font-weight"),t.style.setProperty("color","#C0C0C0"),e.getTabContent().style.setProperty("display","none")}const n=this.tabs[t].getTabButton();n.style.setProperty("font-weight","bold"),n.style.removeProperty("color"),this.tabs[t].getTabContent().style.removeProperty("display"),this._activeTabIndex=t,this.tabs[t].onTabSelected()}}const c="Stores the string in memory and removes it from the UI component. Prevents a physical intruder from copy/pasting the value.",u=e("divMasterKey"),d=e("txtPrivatePart"),h=e("txtPrivatePartConfirmation"),p=e("btnProtect"),g=e("spnProtectedConfirmation"),f=e("spnPrivatePartSize"),m=e("spnPrivatePartSizeConfirmation");let w;const y=[];function v(){return void 0!==w?w:d.value}function b(){0!==d.value.length&&(w=d.value,g.innerHTML="Protected",r(d),r(h),f.innerHTML="0",m.innerHTML="0",d.disabled=!0,h.disabled=!0,p.innerHTML="Clear and unlock",p.title="Removes the string form memory and re-enables the UI component.",L())}function E(){void 0===w?b():(w=void 0,g.innerHTML="",d.disabled=!1,h.disabled=!1,p.innerHTML="Protect and lock",p.title=c,p.disabled=!0)}const T=new class{action;delay;timeout;constructor(t,e){this.action=t,this.delay=e}reset(t=void 0){void 0!==this.timeout&&clearTimeout(this.timeout);const e=void 0!==t?t:this.delay;this.timeout=window.setTimeout((()=>{this.action(),this.timeout=void 0}),e)}}(b,6e4);function C(){let t;for(t of(p.disabled=0===d.value.length,f.innerHTML=d.value.length.toString(),L(),y))t();T.reset()}function L(){h.value===d.value?h.style.setProperty("background","#D0FFD0"):h.style.setProperty("background",t)}function S(){m.innerHTML=h.value.length.toString(),T.reset(),L()}const P="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";class A{get name(){return"base58"}get description(){return"Base58 alphabet in ASCII table order."}encode(t){return function(t,e){if(0===t.byteLength)return"";const n=new DataView(t,0);let r=0;const o=[0];for(let e=0;e<t.byteLength;e++){for(let t=0;t<o.length;t++)o[t]<<=8;o[0]+=n.getUint8(e),r=0;for(let t=0;t<o.length;t++)o[t]+=r,r=o[t]/58|0,o[t]%=58;for(;r>0;)o.push(r%58),r=r/58|0}for(let e=0;0===n.getUint8(e)&&e<t.byteLength-1;e++)o.push(0);let s="";for(let t=o.length-1;t>=0;t--)s+=e[o[t]];return s}(t,P)}decode(t){return function(t,e){if(e.length<2)throw new Error("Alphabet does not contain enough characters, at least 2 are required.");if(0===t.length)return new ArrayBuffer(0);for(let n=0;n<t.length;n++)if(!1===e.includes(t[n]))throw new Error(`Base${e.length} alphabet '${e}' does not contain character '${t[n]}'.`);const n=[0];let r=0;for(let o=0;o<t.length;o++){const s=t[o];for(let t=0;t<n.length;t++)n[t]*=e.length;n[0]+=e.indexOf(s),r=0;for(let t=0;t<n.length;t++)n[t]+=r,r=n[t]>>8,n[t]&=255;for(;r>0;)n.push(255&r),r>>=8}for(let r=0;t[r]===e[0]&&r<t.length-1;r++)n.push(0);return new Uint8Array(n.reverse()).buffer}(t,P)}}const x="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",V=[new class{get name(){return"base62"}get description(){return`Alphabet '${x}'.`}encode(t){return function(t,e){const n=BigInt(62);let r="",o=function(t){const e=(t=function(t){if(t.byteLength>65535)throw new Error(`Buffer too large: ${t.byteLength} bytes`);let e=t.byteLength;const n=new Uint8Array(2+t.byteLength);for(let t=0;t<2;t+=1)n[t]=e%256,e/=256;return n.set(new Uint8Array(t),2),n.buffer}(t)).byteLength,n=new DataView(t,0);let r=0n,o=1n;for(let t=0;t<e;t+=1)r+=BigInt(n.getUint8(t))*o,o*=256n;return r}(t);for(;o>0n;){const t=o%n;o/=n,r+=e[BigInt.asUintN(8,t)]}return r}(t,x)}decode(t){return function(t,e){const n=BigInt(e.length);let r=0n,o=1n;for(let s=0;s<t.length;s+=1)r+=BigInt(e.indexOf(t[s]))*o,o*=n;return function(t){const e=[];for(;t>0n;){const n=t%256n;t/=256n;const r=Number(BigInt.asUintN(8,n));e.push(r)}let n=e[0];e.length>1&&(n+=256*e[1]);const r=n-(e.length-2);for(let t=0;t<r;t+=1)e.push(0);return new Uint8Array(e.slice(2)).buffer}(r)}(t,x)}},new A,new class{get name(){return"base64"}get description(){return""}encode(t){return this._base64Encode(new Uint8Array(t))}decode(t){return this._base64Decode(t).buffer}_base64ToUint6(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0}_base64Decode(t,e){const n=(t=t.replace(/[^A-Za-z0-9+/]/g,"")).length,r=e?Math.ceil((3*n+1>>2)/e)*e:3*n+1>>2,o=new Uint8Array(r);let s=0,i=0;for(let e=0;e<n;e++){const a=e%4;if(s|=this._base64ToUint6(t.charCodeAt(e))<<6*(3-a),3===a||n-e==1){let t=0;for(;t<3&&i<r;)o[i]=s>>>(16>>>t&24)&255,t++,i++;s=0}}return o}_uint6ToBase64(t){return t<26?t+65:t<52?t+71:t<62?t-4:62===t?43:63===t?47:65}_base64Encode(t){let e=2,n="";const r=t.length;let o=0;for(let s=0;s<r;s++){e=s%3;const r=24&16>>>e;o|=t[s]<<r,2!==e&&t.length-s!=1||(n+=String.fromCodePoint(this._uint6ToBase64(o>>>18&63),this._uint6ToBase64(o>>>12&63),this._uint6ToBase64(o>>>6&63),this._uint6ToBase64(63&o)),o=0)}const s=2===e?"":1===e?"=":"==";return n.substring(0,n.length-2+e)+s}}];class I extends Error{_name;get name(){return this._name}constructor(t){super(t),this._name=I.ERROR_NAME,Object.setPrototypeOf(this,new.target.prototype)}static ERROR_NAME="TaskCancelledError";static isMatching(t){return t&&t.name===I.ERROR_NAME}}class k{_isCancelled=!1;_token;constructor(){this._token=new M(this)}get isCancelled(){return this._isCancelled}get token(){return this._token}cancel(){this._isCancelled=!0}}class M{source;static _none=null;static get none(){return null===M._none&&(M._none=new M(new k)),M._none}constructor(t){this.source=t}get isCancelled(){return this.source.isCancelled}}function _(t){if(t.isCancelled)throw new I}const O=new A;async function $(t,e,n,r){const o=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveKey"]);_(r);const s={name:"PBKDF2",hash:"SHA-512",iterations:n,salt:e},i=await window.crypto.subtle.deriveKey(s,o,{name:"AES-GCM",length:256},!0,["encrypt"]);_(r);const a=await window.crypto.subtle.exportKey("raw",i);return _(r),a}function R(t,e){return t.length<=e?t:t.substring(0,e)}function N(t){return(new TextEncoder).encode(t).buffer}function F(t){return null!=t&&!1===t.hasOwnProperty("constructor")&&"Object"===t.constructor.name}function U(t){const e={};for(const[n,r]of Object.entries(t).sort(((t,e)=>t[0].localeCompare(e[0]))))e[n]=F(r)?U(r):r;return e}const H={};function B(t){if(!t)throw new TypeError("Argument 'serviceName' is mandatory.");const e=H[t];if(void 0===e)throw new Error(`Service '${t}' is not registered.`);return e}function K(t,e){if(!t)throw new TypeError("Argument 'serviceName' is mandatory.");if(void 0===e)throw new TypeError("Argument 'instance' cannot be undefined.");if(void 0!==H[t])throw new Error(`Service '${t}' is already registered.`);H[t]=e}class j{secureLocalStorage;static BASE_URL="https://api.github.com";static AUTH_TOKEN_KEY_NAME="GitHubVaultStorageBase.AuthToken";static LOCAL_STORAGE_KEY_USERNAME="GitHubVaultStorageBase.Username";static LOCAL_STORAGE_KEY_REPO="GitHubVaultStorageBase.Repository";static LOCAL_STORAGE_KEY_FILENAME="GitHubVaultStorageBase.Filename";token=null;oneTimePassword=null;currentVaultContentHash=null;username=null;repositoryName=null;vaultFilename=null;getUsername(){return this.username}getRepositoryName(){return this.repositoryName}getVaultFilename(){return this.vaultFilename}constructor(t){this.secureLocalStorage=t}clear(){this.secureLocalStorage.removeItem(j.LOCAL_STORAGE_KEY_USERNAME),this.secureLocalStorage.removeItem(j.LOCAL_STORAGE_KEY_REPO),this.secureLocalStorage.removeItem(j.LOCAL_STORAGE_KEY_FILENAME),this.secureLocalStorage.removeItem(j.AUTH_TOKEN_KEY_NAME)}constructTokenAuthString(){return`token ${this.token}`}constructFetchRequest(t,e,n){const r={Accept:"application/vnd.github.v3+json","Content-Type":"application/json",Authorization:e};return this.oneTimePassword&&(r["x-github-otp"]=this.oneTimePassword),{method:t,headers:r,body:n?JSON.stringify(n):void 0}}constructUrl(t){return`${j.BASE_URL}${t}`}async request(t,e,n,r,o=void 0){const s=this.constructUrl(n),i=this.constructFetchRequest(e,r,o);let a=await fetch(s,i);return 401===a.status&&t?(this.oneTimePassword=prompt("Input your 2FA code:"),this.oneTimePassword?await this.request(t,e,n,r,o):null):a}getSetVaultParameter(t,e,n){let r=window.localStorage.getItem(t);return r||(r=prompt(e,n),r?(window.localStorage.setItem(t,r),r):null)}ensureVaultParameters(){const t=new URL(window.location.toString());let e="",n="";if("github.com"===t.hostname){const r=t.pathname.split("/");r.length>=3&&(e=r[1],n=`${r[2]}Vault`)}n||(n="ItchyPasswordVault");const r=this.getSetVaultParameter(j.LOCAL_STORAGE_KEY_USERNAME,"GitHub account username:",e);if(!r)return Promise.resolve(!1);this.username=r;const o=this.getSetVaultParameter(j.LOCAL_STORAGE_KEY_REPO,"Vault GitHub repository name:",n);if(!o)return Promise.resolve(!1);this.repositoryName=o;const s=this.getSetVaultParameter(j.LOCAL_STORAGE_KEY_FILENAME,"Vault filename:","vault.json");return s?(this.vaultFilename=s,Promise.resolve(!0)):Promise.resolve(!1)}async ensureToken(){let t=await this.secureLocalStorage.getItem(j.AUTH_TOKEN_KEY_NAME);return(null!==t||(t=await this.getToken(),null!==t))&&(await this.secureLocalStorage.setItem(j.AUTH_TOKEN_KEY_NAME,t),this.token=t,!0)}constructVaultFileUrl(){return`/repos/${this.username}/${this.repositoryName}/contents/${this.vaultFilename}`}async getVaultContent(){if(!1===await this.ensureVaultParameters())return null;if(!1===await this.ensureToken())return null;const t=this.constructVaultFileUrl(),e=await this.request(!1,"GET",t,this.constructTokenAuthString());if(null===e)return console.warn("Fetching vault content aborted."),null;if(!1===e.ok)return 401===e.status?(this.secureLocalStorage.removeItem(j.AUTH_TOKEN_KEY_NAME),this.token=null,this.oneTimePassword=null,await this.getVaultContent()):404===e.status?await this.setVaultContent("{}","[ItchyPassword] Creation of vault file")?"{}":null:(console.error(`Failed to fetch vault file '${this.vaultFilename}'.`,e),null);const n=await e.json();this.currentVaultContentHash=n.sha;const r=atob(n.content);return""===r.trim()?"{}":r}async setVaultContent(t,e){if(!1===await this.ensureVaultParameters())return!1;if(!1===await this.ensureToken())return!1;const n={message:e,content:btoa(t),sha:this.currentVaultContentHash},r=this.constructVaultFileUrl(),o=await this.request(!1,"PUT",r,this.constructTokenAuthString(),n);if(null===o)return console.warn("Push new vault content aborted."),!1;const s=await o.json();return!1===o.ok?(console.error(`Failed to create/update vault file '${this.vaultFilename}'.`,o,s),!1):(this.currentVaultContentHash=s.content.sha,!0)}getVaultSettings(){const t=window.localStorage.getItem(j.LOCAL_STORAGE_KEY_USERNAME),e=window.localStorage.getItem(j.LOCAL_STORAGE_KEY_REPO),n=window.localStorage.getItem(j.LOCAL_STORAGE_KEY_FILENAME);return`username: ${null==t?"<null>":`'${t}'`}\nrepository name: ${null==e?"<null>":`'${e}'`}\nvault filename: ${null==n?"<null>":`'${n}'`}`}}class D extends j{getToken(){const t=prompt("Personal access token:");return Promise.resolve(t)}}class G{cipherComponent;latestVersion;constructor(t){this.cipherComponent=t,this.latestVersion=dt().version}isLatestVersion(t){return t===this.getLatestVersion()}getLatestVersion(){return this.latestVersion}async activate(t,e,n){return!1!==await this.cipherComponent.setParameters(e,n,t)&&(this.cipherComponent.getTabButton().click(),!0)}}const Y="base58",z=e("btnTabCiphers"),J=e("divTabCiphers"),q=[new class{iterations=1e5;get version(){return 2}get description(){return"PBKDF2 + AES-GCM (100k iterations)"}async encrypt(t,e,n){const r=new ArrayBuffer(44+t.byteLength),o=crypto.getRandomValues(new Uint8Array(r,0,12)),s=crypto.getRandomValues(new Uint8Array(r,12,16)),i={name:"AES-GCM",iv:o},a=await window.crypto.subtle.importKey("raw",await $(e,s,this.iterations,n),{name:"AES-GCM",length:0},!1,["encrypt"]);_(n);const l=await window.crypto.subtle.encrypt(i,a,t);return _(n),new Uint8Array(r).set(new Uint8Array(l),28),r}async decrypt(t,e,n){const r=new Uint8Array(t,0,12),o=new Uint8Array(t,12,16),s=new Uint8Array(t,28),i={name:"AES-GCM",iv:r},a=await $(e,o,this.iterations,n);_(n);const l=await window.crypto.subtle.importKey("raw",a,{name:"AES-GCM",length:0},!1,["decrypt"]);_(n);const c=await window.crypto.subtle.decrypt(i,l,s);return _(n),c}},new class{iterations=4e5;get version(){return 3}get description(){return"PBKDF2 + AES-GCM (400k iterations)"}async encrypt(t,e,n){const r=new ArrayBuffer(44+t.byteLength),o=crypto.getRandomValues(new Uint8Array(r,0,12)),s=crypto.getRandomValues(new Uint8Array(r,12,16)),i={name:"AES-GCM",iv:o},a=await window.crypto.subtle.importKey("raw",await $(e,s,this.iterations,n),{name:"AES-GCM",length:0},!1,["encrypt"]);_(n);const l=await window.crypto.subtle.encrypt(i,a,t);return _(n),new Uint8Array(r).set(new Uint8Array(l),28),r}async decrypt(t,e,n){const r=new Uint8Array(t,0,12),o=new Uint8Array(t,12,16),s=new Uint8Array(t,28),i={name:"AES-GCM",iv:r},a=await $(e,o,this.iterations,n);_(n);const l=await window.crypto.subtle.importKey("raw",a,{name:"AES-GCM",length:0},!1,["decrypt"]);_(n);const c=await window.crypto.subtle.decrypt(i,l,s);return _(n),c}}],W=e("btnClearAllCipherInfo"),X=e("txtCipherName"),Z=e("txtCipherSource"),Q=e("txtCipherTarget"),tt=e("cboCipherVersion"),et=e("cboCipherEncoding"),nt=e("btnEncrypt"),rt=e("btnDecrypt"),ot=e("spnCipherSourceLength"),st=e("btnCopyCipherSource"),it=e("btnClearCipherSource"),at=e("spnCipherTargetLength"),lt=e("btnCopyCipherTarget"),ct=e("btnClearCipherTarget");let ut;function dt(){if(0===q.length)throw new Error("No ciphers registered.");let t=q[0];for(const e of q)e.version>t.version&&(t=e);return t}function ht(t){for(let e=0;e<V.length;e++)if(V[e].name===t)return e;return-1}function pt(){Z.style.removeProperty("background-color")}function gt(){Z.style.setProperty("background-color",t)}function ft(){pt(),Q.style.removeProperty("background-color"),et.style.removeProperty("background-color")}function mt(){ut=void 0}function wt(){ot.innerText=Z.value.length.toString()}function yt(){at.innerText=Q.value.length.toString()}function vt(t,e){const n=t.length>0&&Q.value!==t;Q.value=t,yt(),n&&e?ut=(new Date).toISOString():mt(),bt()}function bt(){const t=et.selectedIndex,e=t>=0&&t<V.length;""!==Q.value&&""!==X.value&&!1!==e?Gt({datetime:ut,version:q[tt.selectedIndex].version,encoding:V[t].name,value:Q.value},`ciphers/${X.value}`):Dt()}async function Et(t,e,n,r){const o=v();if(0===o.length)return console.warn("Private part is empty"),null;const s=N(t),i=N(o),a=await e.encrypt(s,i,r);return _(r),n.encode(a)}async function Tt(t,e,n,r){const o=v();if(0===o.length)return console.warn("Private part is empty"),null;try{const i=n.decode(t),a=N(o),l=await e.decrypt(i,a,r);return _(r),s=l,(new TextDecoder).decode(s)}catch(t){const e=t;return function(t){if(I.isMatching(t))throw t}(e),console.warn("Failed to decrypt"+(e.message?`, error: ${e.message}`:", no error message")),null}var s}async function Ct(){if(Z.focus(),vt("",!0),ft(),0===Z.value.length)return gt(),!1;const t=V[et.selectedIndex],e=await Et(Z.value,q[tt.selectedIndex],t,M.none);return null!==e&&(vt(e,!0),bt(),!0)}async function Lt(){if(Z.focus(),vt("",!1),ft(),0===Z.value.length)return gt(),!1;if(et.selectedIndex<0||et.selectedIndex>=V.length)return et.style.setProperty("background-color",t),!1;const e=V[et.selectedIndex],n=await Tt(Z.value,q[tt.selectedIndex],e,M.none);return null===n?(Q.style.setProperty("background-color",t),!1):(vt(n,!1),!0)}class St{name="Cipher";getTabButton(){return z}getTabContent(){return J}onTabSelected(){Jt(),bt(),X.focus()}static fullPathToStoragePath(t,e){const n=`/ciphers/${e}`;return!1===t.startsWith("<root>/")||!1===t.endsWith(n)?null:t.substring(7,t.length-n.length)}async setParameters(t,e,n){X.value="",Z.value="",wt(),Q.value="",yt(),tt.selectedIndex=tt.options.length-1,et.selectedIndex=ht(Y),Yt(""),zt("");const r=e.encoding??"base62",o=function(t){for(const e of V)if(e.name===t)return e;return null}(r);if(null===o)throw new Error(`Failed to find encoding '${r}'.`);const s=await async function(t,e,n,r){const o=function(t){for(const e of q)if(e.version===t)return e;return null}(e);if(null===o)throw new Error(`Failed to find cip[her for version ${e}.`);return Tt(t,o,n,r)}(e.value,e.version,o,M.none);if(null===s)return alert(`Failed to decrypt cipher '${t}'.`),!1;const i=St.fullPathToStoragePath(n,t);return null===i?(console.error(`Failed to retrieve storage path from full path '${n}'.`),alert("Failed to retrieve storage path from full path."),!1):(e.customKeys&&zt(JSON.stringify(e.customKeys,null,4)),delete e.customKeys,X.value=t,Z.value=s,wt(),tt.selectedIndex=function(t){for(let e=0;e<q.length;e++)if(q[e].version===t)return e;return-1}(e.version),et.selectedIndex=ht(r),Yt(i),Gt(e,`ciphers/${t}`),!0)}getVaultHint(){return`${this.name.toLowerCase()} '${X.value}'`}init(){const t=B("errorLogs").createLogErrorMessageFunction();s(Z,st,t),s(Q,lt,t),o(nt,Ct,t),o(rt,Lt,t),X.addEventListener("input",(()=>{bt()})),Z.addEventListener("input",(()=>{wt(),Z.value.length>0&&pt()})),Q.addEventListener("input",(()=>{yt()})),tt.addEventListener("input",(()=>{bt()})),W.addEventListener("click",(()=>{X.value="",Z.value="",wt(),Q.value="",yt(),tt.selectedIndex=tt.options.length-1,et.selectedIndex=ht(Y),Xt(),mt(),ft(),Wt()})),it.addEventListener("click",(()=>{r(Z,!0)})),ct.addEventListener("click",(()=>{vt("",!1)})),function(){for(const t of q){const e=document.createElement("option");e.text=`v${t.version}`,tt.appendChild(e)}tt.selectedIndex=tt.options.length-1}(),function(){for(const t of V){const e=document.createElement("option");e.text=t.name,e.title=t.description,et.appendChild(e)}et.selectedIndex=ht(Y)}(),K("cipher",new G(this))}}const Pt=new A;class At{get length(){return window.localStorage.length}clear(){window.localStorage.clear()}key(t){return window.localStorage.key(t)}removeItem(t){window.localStorage.removeItem(t)}async getItem(t){const e=window.localStorage.getItem(t);if(null===e)return null;const n=q.map((t=>t)).sort(((t,e)=>e.version-t.version));for(const t of n){const n=await Tt(e,t,Pt,M.none);if(null!==n)return n}return null}async setItem(t,e){const n=await Et(e,dt(),Pt,M.none);null!==n?window.localStorage.setItem(t,n):console.error("Failed to encrypt value. (nothing stored)")}}const xt=e("divStorageOutput"),Vt=e("txtPath"),It=e("lblMatchingPath"),kt=e("txtParameters"),Mt=e("btnPushToVault"),_t=e("txtCustomKeys");let Ot,$t,Rt=new D(new At);function Nt(t,e=void 0){const n=t.indexOf("/"),r={},o=n>=0?t.substring(0,n):t,s=n>=0?t.substring(n+1):void 0;if(void 0===e){const t={};t[o]=r,e={head:t,tailParent:t,tail:r}}else e.tail[o]=r,e.tailParent=e.tail,e.tail=r;return s?Nt(s,e):e}function Ft(){!function(){const t=B("vault").computeUserPathMatchDepth(Vt.value);if(t>0){const e=function(t,e){let n=0;for(let r=0;r<e;r+=1){if(n=t.indexOf("/",n),n<0){n=t.length+1;break}n+=1}return t.substring(0,n-1)}(Vt.value,t);It.innerText=e}else It.innerText=""}(),Bt()}function Ut(){Bt()}function Ht(e){e?_t.style.removeProperty("background"):_t.style.setProperty("background",t)}function Bt(){if(void 0===Ot||void 0===$t)return;const t=Nt(`${Vt.value}/${$t}`),e=t.tail;for(const[t,n]of Object.entries(Ot))e[t]=n;const n=function(){if(""===_t.value)return null;try{const t=JSON.parse(_t.value);return null===t||"Object"!==t.constructor.name?null:t}catch{return null}}();Ht(""===_t.value||null!==n),null!==n&&(e.customKeys=n),0===Object.keys(e).length&&(t.tailParent[Object.keys(t.tailParent)[0]]=null),kt.value=JSON.stringify(U(t.head),void 0,4)}function Kt(t,e){for(const n of Object.keys(t)){const r=e[n],o=t[n];null!=r&&"Object"===r.constructor.name&&"Object"===o.constructor.name?Kt(o,r):e[n]=o}}async function jt(){const t=await Rt.getVaultContent();if(null===t)return!1;const e=JSON.parse(kt.value);let n=JSON.parse(t);Kt(e,n);const r=function(){const t=tr.getActiveComponent();if(null===t)throw new Error("Could not determine active component.");let e=t.getVaultHint();const n=It.innerText,r=Vt.value;return n?n===r?`Updated ${e} for '${r}'`:`Updated ${e} for '${n}' adding '${function(t,...e){const n=function(t,e){for(let n=0;n<t.length;n+=1)if(!1===e.includes(t[n]))return n;return t.length}(t,e),r=function(t,e){for(let n=t.length-1;n>=0;n-=1)if(!1===e.includes(t[n]))return n+1;return t.length}(t,e);return t.substring(n,r)}(r.substring(n.length),"/")}'`:`Added ${e} for '${r}'`}(),o=JSON.stringify(U(n),void 0,4)+"\n";return await Rt.setVaultContent(o,`[ItchyPassword] ${r}`),!0}function Dt(){Ot=void 0,$t=void 0,r(kt)}function Gt(t,e){Ot=t,$t=e,Bt()}function Yt(t){Vt.value=t,Ft()}function zt(t){_t.value=t}function Jt(){xt.style.setProperty("display","initial")}function qt(){xt.style.setProperty("display","none")}function Wt(){Vt.value="",kt.value="",_t.value="",Ot=void 0,$t=void 0,Ht(!0)}function Xt(){It.innerText=""}class Zt{passwordComponent;constructor(t){this.passwordComponent=t}isLatestVersion(t){return t===this.getLatestVersion()}getLatestVersion(){return ne}async generateAndCopyPasswordToClipboard(t,e,r,o){e=void 0!==e?e:Pe,r=void 0!==r?r:Se,o=void 0!==o?o:ne;const s=await ze(t,e,o,M.none);if(null===s)return!1;const i=R(s,Math.max(4,r)),a=B("errorLogs").createLogErrorMessageFunction();return await n(i,a)}async activate(t,e){return!1!==this.passwordComponent.setParameters(e,t)&&(await qe(),this.passwordComponent.getTabButton().click(),!0)}}const Qt=e("btnTabPasswords"),te=e("divTabPasswords"),ee=[new class{hkdfPurpose;_description;constructor(t){this.hkdfPurpose=N(t),this._description=`HKDF(PBKDF2, HMAC512) [purpose: ${t}]`}get version(){return 1}get description(){return this._description}async generatePassword(t,e,n){const r=await $(t,e,1e5,n);_(n);const o=await window.crypto.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-512"}},!1,["sign"]);_(n);const s=await window.crypto.subtle.sign("HMAC",o,this.hkdfPurpose);return _(n),s}}("Password"),new class{hkdfPurpose;_description;constructor(t){this.hkdfPurpose=N(t),this._description=`HKDF(PBKDF2, HMAC512) [purpose: ${t}]`}get version(){return 2}get description(){return this._description}async generatePassword(t,e,n){const r=await $(t,e,4e5,n);_(n);const o=await window.crypto.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-512"}},!1,["sign"]);_(n);const s=await window.crypto.subtle.sign("HMAC",o,this.hkdfPurpose);return _(n),s}}("Password")],ne=2,re=e("btnClearAllPasswordInfo"),oe=e("txtPublicPart"),se=e("spnPublicPartSize"),ie=e("btnGeneratePublicPart"),ae=e("btnClearPublicPart"),le=e("btnCopyPublicPart"),ce=e("btnShowHidePasswordOptionalFeatures"),ue=e("lblAlphabetLength"),de=e("numOutputSizeRange"),he=e("numOutputSizeNum"),pe=e("lblAlphabet"),ge=e("txtAlphabet"),fe=e("spnAlphabetSize"),me=e("divPasswordAlphabetActions"),we=e("btnResetAlphabet"),ye=e("lblPasswordVersion"),ve=e("cboPasswordVersion"),be=e("txtResultPassword"),Ee=e("spnResultPasswordLength"),Te=e("btnViewResultPassword"),Ce=e("btnCopyResultPassword"),Le=e("lblGeneratingPassword"),Se=64,Pe="!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~";let Ae,xe;function Ve(){return!(oe.value.length>0&&"y"!==prompt("Are you sure you want to clear the public part ?\nType 'y' to accept","")||(r(oe,!0),Ue(),ke(),Oe(),0))}function Ie(){if(oe.value.length>0&&"y"!==prompt("Are you sure you want to generate a new public part ?\nType 'y' to accept",""))return!1;const t=function(t=64){const e=function(t=64){const e=new Uint8Array(t);return crypto.getRandomValues(e).buffer}(t);return O.encode(e)}();return oe.value=t,Ue(),ke(),qe(),!0}function ke(){Ae=oe.value.length>0?(new Date).toISOString():void 0}function Me(){Ee.innerHTML=be.value.length.toString()}function _e(t){const e=t.split("");e.sort();for(let t=1;t<e.length;t+=1)if(e[t-1]===e[t])return!1;return!0}function Oe(){if(!1===Ye())return void Ge();const t=ee[ve.selectedIndex];if(!t)throw new Error("Invalid selected password generator version.");Gt({public:oe.value,datetime:Ae,version:t.version,length:be.value.length,alphabet:ge.value},"password")}function $e(){he.value=de.value}function Re(){const t=parseInt(de.min,10),e=parseInt(he.value,10),n=parseInt(de.max,10);return!1===isNaN(e)&&(de.value=Math.max(t,Math.min(e,n)).toString(),!0)}async function Ne(){$e(),await qe()}async function Fe(){Re()&&$e(),await qe()}function Ue(){se.innerHTML=oe.value.length.toString()}function He(){fe.innerHTML=ge.value.length.toString()}function Be(e){e?ge.style.removeProperty("background"):ge.style.setProperty("background",t)}async function Ke(){const t=_e(ge.value);Be(t),!1!==t&&(He(),await qe())}async function je(){return!1!==Xe()&&(await qe(),!0)}async function De(){ee[ve.selectedIndex]&&await qe()}function Ge(){r(be),Dt(),Me()}function Ye(t){const e=ge.value;return!1!==_e(e)&&(t=t||oe.value,!(v().length<=0||t.length<8||e.length<2))}async function ze(t,e,n,r){if(!1===Ye(t))return null;const o=function(t){for(const e of ee)if(e?.version===t)return e;throw new Error(`Failed to find password generator version ${t}`)}(n),s=N(v()),i=N(t);return function(t,e){const n=BigInt(e.length);let r="",o=function(t){const e=t.byteLength,n=new DataView(t,0);let r=0n,o=1n;for(let t=0;t<e;t+=1)r+=BigInt(n.getUint8(t))*o,o*=256n;return r}(t);for(;o>0n;){const t=o%n;o/=n,r+=e[BigInt.asUintN(8,t)]}return r}(await o.generatePassword(s,i,r),e)}const Je=new class{currentTokenSource=null;currentTask=null;microThreadId=0;get isRunning(){return null!==this.currentTask}async cancelInternal(t){this.microThreadId===Number.MAX_SAFE_INTEGER?this.microThreadId=0:this.microThreadId=this.microThreadId+1;const e=this.microThreadId;if(null===this.currentTask)return!0;if(null!==this.currentTokenSource&&(this.currentTokenSource.cancel(),null!==this.currentTask))try{await this.currentTask}catch(e){if(!I.isMatching(e))throw e;if(t)throw e}return e===this.microThreadId}async cancel(t=!1){await this.cancelInternal(t)}async cancelAndExecute(t,e=!1){if(!1===await this.cancelInternal(e)){if(!1===e)return;throw new I}var n=new k;this.currentTokenSource=n;try{return this.currentTask=t(this.currentTokenSource.token),await this.currentTask}catch(t){if(I.isMatching(t)&&!1===e)return;throw t}finally{this.currentTask=null}}};async function qe(){if(!1!==Ye()){i(Le,!0);try{await Je.cancelAndExecute(We)}finally{i(Le,!1)}}else Ge()}async function We(t){const e=function(){const t=ee[ve.selectedIndex];if(!t)throw new Error(`Failed to find password generator version from index ${ve.selectedIndex}`);return t}(),n=await ze(oe.value,ge.value,e.version,t);null!==n&&(be.value=R(n,Math.max(4,parseInt(de.value,10))),Me(),Oe(),xe())}function Xe(){ge.value=Pe,He();const t=_e(ge.value);return Be(t),t}async function Ze(){Ue(),ke(),await qe()}function Qe(){return!1!==Ve()&&(r(be,!0),Me(),Xe(),de.value=Se.toString(),$e(),ve.selectedIndex=ve.options.length-1,Xt(),Wt(),!0)}const tn=e("btnTabReEncrypt"),en=e("divTabReEncrypt"),nn=e("txtReEncryptSource"),rn=e("txtReEncryptTarget"),on=e("cboReEncryptFrom"),sn=e("cboReEncryptTo"),an=e("btnReEncrypt"),ln=e("btnClearReEncryptSource"),cn=e("btnCopyReEncryptTarget"),un=e("btnClearReEncryptTarget");function dn(t,e){let n;for(n of q){const e=document.createElement("option");e.value=t.childNodes.length.toString(),e.text=`${n.description} (v${n.version})`,t.add(e)}t.value=e.toString()}function hn(){nn.style.removeProperty("background-color")}async function pn(){if(r(rn,!0),hn(),rn.style.removeProperty("background-color"),0===nn.value.length)return nn.style.setProperty("background-color",t),!1;if(on.value===sn.value)return rn.style.setProperty("background-color",t),!1;const e=v();if(0===e.length)return console.warn("Private part is empty"),!1;const n=parseInt(on.value,10),o=parseInt(sn.value,10),s=N(e),i=function(t){t.length%2!=0&&(t="0"+t);const e=new Uint8Array(t.length/2);for(let n=0;n<e.byteLength;n+=1){const r=2*n;e[n]=parseInt(t.substring(r,r+2),16)}return e.buffer}(nn.value),a=await q[n].decrypt(i,s,M.none),l=await q[o].encrypt(a,s,M.none);var c;return rn.value=(c=l,Array.prototype.map.call(new Uint8Array(c),(t=>("00"+t.toString(16)).slice(-2))).join("")),!0}const gn=Math.floor(15);class fn{parent;children=[];rootElement;contentContainerElement;childrenContainerElement;treeNodeCreationController;path;key;value;get element(){return this.rootElement}get isVisible(){return"none"!==this.rootElement.style.display}getVisibleChildCount(){let t=0;for(const e of this.children)e.isVisible&&(t+=1);return t}getVisibleLeafCount(){if(!1===this.isVisible)return 0;let t=1;for(const e of this.children)t+=e.getVisibleLeafCount();return t}addChild(t){this.childrenContainerElement.appendChild(t.rootElement),this.children.push(t)}createChildNodes(t){for(const[e,n]of Object.entries(t)){const t=decodeURIComponent(escape(e)),r=new fn(this,`${this.path}/${t}`,t,n,this.treeNodeCreationController);this.addChild(r)}}constructor(t,e,n,r,o){this.parent=t,this.path=e,this.key=n,this.value=r,this.treeNodeCreationController=o,this.rootElement=document.createElement("div"),this.setRootElementStyle(),this.contentContainerElement=document.createElement("div"),this.setTitleElementStyle();for(const t of this.createTreeNodeContentElements())this.contentContainerElement.appendChild(t);this.rootElement.appendChild(this.contentContainerElement),this.childrenContainerElement=document.createElement("div"),this.rootElement.appendChild(this.childrenContainerElement),this.setChildrenContainerElementStyle();const s=o.isLeaf(e,n,r);!1===s&&F(r)?this.createChildNodes(r):s&&r.customKeys&&this.createChildNodes(r.customKeys),t&&this.setupLinesElements("#D0D0D0")}createTreeNodeContentElements(){return this.treeNodeCreationController.createTreeNodeContentElements(this.path,this.key,this.value)}setRootElementStyle(){this.rootElement.classList.add("treenode-root"),this.rootElement.style.display="grid";let t=4,e=0;this.parent&&(t=30),this.parent&&this.parent.parent&&(e=12),this.rootElement.style.gridTemplateRows=`${t}px 1fr`,this.rootElement.style.gridTemplateColumns=`${e}px 6px 1fr`}verticalLineElement=null;setupLinesElements(t){const e=document.createElement("div");if(e.classList.add("treenode-vertical-line"),e.style.gridColumn="2",e.style.gridRow="2",e.style.width="100%",e.style.borderRight=`1px solid ${t}`,this.verticalLineElement=e,this.rootElement.appendChild(e),this.parent&&this.parent.parent){const e=document.createElement("div");e.classList.add("treenode-horizontal-line"),e.style.gridColumn="1",e.style.gridRow="1",e.style.width="100%",e.style.height=`${gn}px`,e.style.borderBottom=`1px solid ${t}`,this.rootElement.appendChild(e)}this.updateLines()}updateLines(){if(null===this.verticalLineElement)return;const t=this.getVisibleChildCount();if(0===t)return void(this.verticalLineElement.style.height="0px");let e=1;for(let n=0;n<t-1;n+=1)this.children[n].isVisible&&(e+=this.children[n].getVisibleLeafCount());const n=30*e-30+gn+1;this.verticalLineElement.style.height=`${n}px`}setTitleElementStyle(){this.contentContainerElement&&(this.contentContainerElement.classList.add("treenode-title"),this.contentContainerElement.style.gridColumn="2 / span 2",this.contentContainerElement.style.gridRow="1",this.contentContainerElement.style.marginLeft="3px",this.contentContainerElement.style.alignSelf="center")}setChildrenContainerElementStyle(){this.childrenContainerElement.classList.add("treenode-children-container"),this.childrenContainerElement.style.gridColumn="3",this.childrenContainerElement.style.gridRow="2"}resetTitle(t){if(this.contentContainerElement){this.contentContainerElement.innerHTML="";for(const t of this.createTreeNodeContentElements())this.contentContainerElement.appendChild(t)}if(1===t&&this.parent&&this.parent.resetTitle(t),2===t)for(const e of this.children)e.resetTitle(t)}show(t){if(this.rootElement.style.display="grid",1===t&&this.parent&&this.parent.show(t),2===t)for(const e of this.children)e.show(t);this.updateLines()}hide(t){if(this.rootElement.style.display="none",1===t&&this.parent&&this.parent.hide(t),2===t)for(const e of this.children)e.hide(t);this.updateLines()}static createSpan(t,e){const n=document.createElement("span");return e&&(n.style.backgroundColor=e,n.style.borderRadius="2px"),n.innerText=t,n}static createColoredSpan(t,e){const n=document.createElement("span");let r=0;for(const o of e)o.pos!==r&&n.appendChild(fn.createSpan(t.substring(r,o.pos))),n.appendChild(fn.createSpan(t.substring(o.pos,o.pos+o.len),"#80C0FF")),r=o.pos+o.len;return r<t.length&&n.appendChild(fn.createSpan(t.substring(r,t.length))),n}static findLeafElement(t){return 0===t.children.length?t:fn.findLeafElement(t.children[0])}filter(t,e){if(!t)return this.resetTitle(2),this.show(2),void this.updateLines();if(0===this.contentContainerElement.childNodes.length)return;const n=[],r=fn.findLeafElement(this.contentContainerElement);if(e(r.innerText,t,n)){const t=fn.createColoredSpan(r.innerText,n);r.innerHTML="",r.appendChild(t),this.show(1),this.show(2)}else this.resetTitle(2);for(const n of this.children)n.filter(t,e);this.updateLines()}}function mn(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function wn(t,e,n,r){if(!n)return!0;t=mn(t);for(let o=(n=mn(n)).length;o>=1;o-=1){const s=n.substring(0,o),i=t.indexOf(s,e);if(i>=0)return r.push({pos:i,len:s.length}),wn(t,i+s.length,n.substring(o),r)}return!1}const yn=e("btnTabVaultTabTreeView"),vn=e("divTabVaultTabTreeView"),bn=e("trvVaultTreeView"),En=e("txtVaultTreeViewSearch"),Tn=e("cboVaultTreeViewSearchType");let Cn;const Ln=[{text:"Fuzzy",function:function(t,e,n){return wn(t,0,e,n)}},{text:"Contains",function:function(t,e,n){const r=mn(t).indexOf(mn(e));return!(r<0||(n.push({pos:r,len:e.length}),0))}},{text:"Exact",function:function(t,e,n){return mn(t)===mn(e)&&(n.push({pos:0,len:e.length}),!0)}}];function Sn(){if(!Cn)return;const t=Tn.selectedIndex,e=Ln[t].function;Cn.hide(2),Cn.filter(En.value.toLocaleLowerCase(),e)}class Pn{maxTimestampInMilliseconds;passwordService;cipherService;buttonBackgroundColor;constructor(t){this.maxTimestampInMilliseconds=t,this.passwordService=B("password"),this.cipherService=B("cipher");const e=window.getComputedStyle(yn);this.buttonBackgroundColor=e.backgroundColor}async runPassword(t){await this.passwordService.generateAndCopyPasswordToClipboard(t.public,t.alphabet,t.length,t.version)}async editPassword(t,e){return await this.passwordService.activate(t,e)}async runCipher(t,e,n){return await this.cipherService.activate(t,e,n)}static isPasswordObject(t,e){return"password"===t&&!(!e||!F(e)||"string"!=typeof e.public||e.public.length<4)}static isCipherObject(t){return!(!t||!F(t)||"string"!=typeof t.value||t.value.length<=0||"number"!=typeof t.version||t.version<0)}static isCiphersObject(t,e){if("ciphers"!==t)return!1;if(!e||!F(e))return!1;for(const t of Object.values(e))if(!Pn.isCipherObject(t))return!1;return!0}static isHint(t,e){return!(Pn.isCiphersObject(t,e)||Pn.isCipherObject(e)||Pn.isPasswordObject(t,e)||F(e))}isLeaf(t,e,n){return!(!Pn.isCipherObject(n)&&!Pn.isPasswordObject(e,n))||!1===F(n)}computeTimestampProgress(t){const e=Date.now()-t.getTime();return Math.max(0,Math.min(e,this.maxTimestampInMilliseconds))/this.maxTimestampInMilliseconds}static dateToString(t){return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}createButton(t,e){const n=document.createElement("button");n.title=`Last modified: ${Pn.dateToString(e)}`;const r=document.createElement("div");r.classList.add("content-container");const o=document.createElement("span");o.innerText=t,o.classList.add("text"),r.appendChild(o);const s=document.createElement("div");return s.classList.add("timestamp"),s.style.backgroundColor=this.buttonBackgroundColor,s.style.width=`${Math.round(100*(1-this.computeTimestampProgress(e)))}%`,r.appendChild(s),n.appendChild(r),n}createTreeNodeContentElements(t,e,n){if(Pn.isPasswordObject(e,n)){const e=n.version,r=this.passwordService.isLatestVersion(e),s=new Date(n.datetime),i=this.createButton("Password",s);i.classList.add("password"),i.style.justifySelf="start",i.style.minWidth="80px",!1===r&&(i.setAttribute("not-latest",`⚠️ Password version ${e}, latest is ${this.passwordService.getLatestVersion()}`),i.classList.add("not-latest"));const a=B("errorLogs").createLogErrorMessageFunction();o(i,(async()=>await this.runPassword(n)),a);const l=document.createElement("button");return l.classList.add("edit-password"),l.innerText="✏️",l.title="Edit password generation details",o(l,(async()=>await this.editPassword(t,n)),a),[i,l]}if(Pn.isCipherObject(n)){const r=n.version,s=this.cipherService.isLatestVersion(r),i=new Date(n.datetime),a=this.createButton(e,i);return a.classList.add("cipher"),a.style.justifySelf="start",!1===s&&(a.setAttribute("not-latest",`⚠️ Cipher version ${r}, latest is ${this.cipherService.getLatestVersion()}`),a.classList.add("not-latest")),o(a,(async()=>await this.runCipher(t,e,n)),B("errorLogs").createLogErrorMessageFunction()),[a]}if(Pn.isHint(e,n)){const t=document.createElement("span");return t.style.justifySelf="start",t.innerText=`${e}: ${n}`,[t]}const r=document.createElement("div");return r.innerText=e,[r]}}const An=e("btnTabVaultTabTextView"),xn=e("divTabVaultTabTextView"),Vn=e("txtVault");class In{vaultComponent;constructor(t){this.vaultComponent=t}computeUserPathMatchDepth(t){return this.vaultComponent.computeUserPathMatchDepth(t)}}const kn=e("divTabVault"),Mn=e("btnTabVault"),_n=e("btnRefreshVault"),On=e("btnClearVaultSettings"),$n=e("btnViewVaultSettings"),Rn=[new class{name="VaultTreeView";onVaultLoaded(t){Cn=new fn(null,"<root>","",t,new Pn(94608e6)),bn.innerHTML="",bn.appendChild(Cn.element),Sn()}getTabButton(){return yn}getTabContent(){return vn}onTabSelected(){En.focus()}getVaultHint(){throw new Error("Not supported.")}init(){!function(){Tn.innerHTML="";for(let t of Ln){const e=document.createElement("option");e.text=t.text,Tn.appendChild(e)}}(),En.addEventListener("input",Sn),Tn.addEventListener("change",Sn)}},new class{name="VaultTextView";onVaultLoaded(t){Vn.value=JSON.stringify(t,void 0,4)}getTabButton(){return An}getTabContent(){return xn}onTabSelected(){}getVaultHint(){throw new Error("Not supported.")}init(){}}],Nn=Rn.filter((t=>void 0!==t.getTabButton)),Fn=Rn.filter((t=>void 0!==t.init)),Un=new l(Nn);let Hn=new D(new At),Bn=null;async function Kn(){if(v().length>0==0)return alert("You must enter a master key first."),!1;const t=await async function(){let t=await Hn.getVaultContent();if(null===t)return!1;try{let e,n=JSON.parse(t);for(e of(n=U(n),Bn=n,Fn))e.onVaultLoaded(n);return!0}catch(t){Bn=null,alert("Failed to parse vault content, it needs to be fixed and be valid JSON data.");const e=t.message;return e&&(alert(e),console.error(e)),!1}}();return t&&(b(),u.style.display="none"),t}function jn(){"y"===prompt("Are you sure you want to clear the vault settings ?\nType 'y' to accept","")&&Hn.clear()}function Dn(){alert(Hn.getVaultSettings())}class Gn{errorLogsComponent;constructor(t){this.errorLogsComponent=t}createLogErrorMessageFunction(){return t=>this.logErrorMessage(t)}logErrorMessage(...t){this.errorLogsComponent.logErrorMessage(...t)}}const Yn=e("divErrorLogs"),zn=e("btnTabErrorLogs"),Jn=e("btnClearErrorLogs"),qn=e("txtErrorLogs"),Wn=[{getTabButton:()=>e("btnTabNothing"),getTabContent:()=>e("divTabNothing"),onTabSelected(){qt()}},new class{name="PrivatePart";getVaultHint(){throw new Error("Not supported.")}init(){p.addEventListener("click",E),d.addEventListener("input",C),h.addEventListener("input",S),L(),p.title=c,d.focus()}},new class{name="Password";getTabButton(){return Qt}getTabContent(){return te}onTabSelected(){Jt(),Oe(),oe.focus()}getVaultHint(){return this.name.toLowerCase()}setParameters(t,e){if(!1===Qe())return!1;const n=!1===(r=e).startsWith("<root>/")||!1===r.endsWith("/password")?null:r.substring(7,r.length-9);var r;if(null===n)return console.error(`Failed to retrieve storage path from full path '${e}'.`),alert("Failed to retrieve storage path from full path."),!1;if(t.customKeys&&zt(JSON.stringify(t.customKeys,null,4)),delete t.customKeys,oe.value=t.public,Ue(),ge.value=t.alphabet,Be(_e(ge.value)),He(),he.value=t.length,!1===Re())return console.error(`Failed to retrieve length from full path '${e}'.`),alert("Failed to retrieve length from full path."),!1;const o=function(t){for(let e=0;e<ee.length;e++)if(ee[e].version===t)return e;return-1}(t.version);return o<0?(console.error(`Failed to retrieve version from full path '${e}'.`),alert("Failed to retrieve version from full path."),!1):(ve.selectedIndex=o,Yt(n),Gt(t,"password"),!0)}init(){const t=B("errorLogs").createLogErrorMessageFunction();var e,n,r;e=qe,y.push(e),de.max=Se.toString(),de.value=Se.toString(),o(ae,Ve,t),o(ie,Ie,t),n=be,(r=Te).addEventListener("click",(()=>{"password"===n.type?(n.type="input",r.innerHTML="Hide"):(n.type="password",r.innerHTML="View")})),s(oe,le,t),xe=s(be,Ce,t),de.addEventListener("input",Ne),he.addEventListener("input",Fe),ge.addEventListener("input",Ke),o(we,je,t),ve.addEventListener("input",De),oe.addEventListener("input",Ze),i(Le,!1),function(t,e,n){let r=!1;t.addEventListener("click",(function(){r=!r,a(n,r)})),a(n,r)}(ce,0,[pe,ge,fe,me,ue,de,he,ye,ve]),Ue(),$e(),Xe(),function(){for(const t of ee){const e=document.createElement("option");e.text=`v${t.version}`,ve.appendChild(e)}ve.selectedIndex=ve.options.length-1}(),re.addEventListener("click",Qe),K("password",new Zt(this))}},new St,new class{name="ReEncrypt";getTabButton(){return tn}getTabContent(){return en}onTabSelected(){qt(),nn.focus()}getVaultHint(){throw new Error("Not supported.")}init(){const t=B("errorLogs").createLogErrorMessageFunction();s(rn,cn,t),dn(on,q.length-2),dn(sn,q.length-1),nn.addEventListener("input",(()=>{nn.value.length>0&&hn()})),ln.addEventListener("click",(()=>{r(nn,!0)})),un.addEventListener("click",(()=>{r(rn,!0)})),o(an,pn,t)}},new class{constructor(){window.addEventListener("error",(t=>this.onError(t)),!0),window.addEventListener("unhandledrejection",(t=>this.onUnhandledRejection(t)),!0),Jn.addEventListener("click",(()=>{qn.value=""})),K("errorLogs",new Gn(this))}logErrorMessage(...t){if(0==t.length)return;const e=(new Date).toISOString();let n=t[0].toString();for(let e=1;e<t.length;e++)n+=` ${t[e].toString()}`;qn.value+=`[${e}] ${n}\n\n`}onUnhandledRejection(t){this.logErrorMessage(`Promise rejected, reason: ${t.reason}`)}onError(t){this.logErrorMessage(`${t.message}\n${t.toString()}`)}getTabButton(){return zn}getTabContent(){return Yn}onTabSelected(){qt()}},new class{name="StorageOutput";getVaultHint(){throw new Error("Not supported.")}init(){const t=B("errorLogs").createLogErrorMessageFunction();_t.addEventListener("input",Ut),o(Mt,jt,t),Vt.addEventListener("input",Ft)}},new class{name="Vault";computeUserPathMatchDepth(t){return function(t){if(null===Bn)return 0;let e=Bn;const n=t.split("/");for(let t=0;t<n.length;t+=1){if(!e[n[t]])return t;e=e[n[t]]}return n.length}(t)}getTabButton(){return Mn}getTabContent(){return kn}onTabSelected(){qt(),Nn[Un.activeTabIndex].onTabSelected()}getVaultHint(){throw new Error("Not supported.")}init(){const t=B("errorLogs").createLogErrorMessageFunction();o(_n,Kn,t),On.addEventListener("click",jn),$n.addEventListener("click",Dn);const e=new In(this);let n;for(n of(K("vault",e),Fn))n.init()}}],Xn=Wn.filter((t=>void 0!==t.getTabButton)),Zn=Wn.filter((t=>void 0!==t.init)),Qn=new l(Xn),tr=new class{name="Root";constructor(){}getVaultHint(){throw new Error("Not supported.")}init(){let t;for(t of Zn)t.init()}getActiveComponent(){const t=Xn[Qn.activeTabIndex];return void 0!==t.init?t:null}},er="5417856cf1645c5e2bf0b6c14db955506c763ab5".substring(0,11);e("divInfo").innerHTML=`${er}<br/><a href="https://github.com/TanukiSharp/ItchyPassword" target="_blank">github</a>`,tr.init()})();
//# sourceMappingURL=bundle.js.map
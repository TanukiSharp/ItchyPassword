{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack://itchy-password/./src/ui.ts","webpack://itchy-password/./src/TabControl.ts","webpack://itchy-password/./src/components/privatePartComponent.ts","webpack://itchy-password/./src/TimedAction.ts","webpack://itchy-password/./src/arrayUtils.ts","webpack://itchy-password/./src/asyncUtils.ts","webpack://itchy-password/./src/crypto.ts","webpack://itchy-password/./src/stringUtils.ts","webpack://itchy-password/./src/PlainObject.ts","webpack://itchy-password/./src/services/serviceManger.ts","webpack://itchy-password/./src/storages/GitHubVaultStorage.ts","webpack://itchy-password/./src/ciphers/v2.ts","webpack://itchy-password/./src/services/cipherService.ts","webpack://itchy-password/./src/components/cipherComponent.ts","webpack://itchy-password/./src/components/storageOutputComponent.ts","webpack://itchy-password/./src/storages/SecureLocalStorage.ts","webpack://itchy-password/./src/services/passwordService.ts","webpack://itchy-password/./src/components/passwordComponent.ts","webpack://itchy-password/./src/passwordGenerators/v1.ts","webpack://itchy-password/./src/ciphers/v1.ts","webpack://itchy-password/./src/components/reEncryptComponent.ts","webpack://itchy-password/./src/components/vaultComponents/TreeNode.ts","webpack://itchy-password/./src/searchMatchFunctions.ts","webpack://itchy-password/./src/components/vaultComponents/treeViewComponent.ts","webpack://itchy-password/./src/components/vaultComponents/textViewComponent.ts","webpack://itchy-password/./src/services/vaultService.ts","webpack://itchy-password/./src/components/vaultComponent.ts","webpack://itchy-password/./src/components/rootComponent.ts","webpack://itchy-password/./src/index.ts"],"sourcesContent":["export const SUCCESS_COLOR: string = '#D0FFD0';\nexport const ERROR_COLOR: string = '#FFD0D0';\n\nexport function getElementById(elementName: string): HTMLElement {\n    const element: HTMLElement|null = document.getElementById(elementName);\n\n    if (elementName === null) {\n        throw new Error(`DOM element '${elementName}' not found.`);\n    }\n\n    return element as HTMLElement;\n}\n\nexport async function writeToClipboard(text: string): Promise<boolean> {\n    try {\n        await navigator.clipboard.writeText(text);\n        return true;\n    } catch (error) {\n        const typedError = error as Error;\n        console.error(typedError.stack || error);\n        return false;\n    }\n}\n\nexport function clearText(txt: HTMLInputElement, refocus: boolean = false): void {\n    txt.value = '';\n    if (refocus) {\n        txt.focus();\n    }\n}\n\ninterface ThrottleTimeout {\n    start: Function;\n    end: Function;\n}\n\nfunction createThrottleTimeout(clearFunc: Function, duration: number): ThrottleTimeout {\n    let timeout: number | undefined = undefined;\n\n    return {\n        start: () => {\n            if (timeout !== undefined) {\n                clearTimeout(timeout);\n                timeout = undefined;\n            }\n            clearFunc();\n        },\n        end: () => {\n            if (timeout !== undefined) {\n                clearTimeout(timeout);\n            }\n            timeout = setTimeout(clearFunc, duration);\n        }\n    };\n}\n\nexport type FeedbackButtonAsyncFunction = () => Promise<boolean> | boolean | Promise<void> | void;\n\nexport function setupFeedbackButton(button: HTMLButtonElement, action: FeedbackButtonAsyncFunction): () => void {\n    const throttleTimeout: ThrottleTimeout = createThrottleTimeout(() => {\n        button.classList.remove('good-flash');\n        button.classList.remove('bad-flash');\n    }, 1000);\n\n    const clickFunction = async () => {\n        button.disabled = true;\n        throttleTimeout.start();\n\n        try {\n            const actionResult = action();\n\n            let result;\n            if (actionResult instanceof Promise) {\n                result = await actionResult;\n            } else {\n                result = actionResult;\n            }\n\n            if (result === undefined || result === true) {\n                button.classList.add('good-flash');\n            } else {\n                button.classList.add('bad-flash');\n            }\n        } catch (error) {\n            const typedError = error as Error;\n            button.classList.add('bad-flash');\n            console.error(typedError.stack || error);\n        } finally {\n            throttleTimeout.end();\n            button.disabled = false;\n        }\n    };\n\n    button.addEventListener('click', clickFunction);\n\n    return clickFunction;\n}\n\nexport function setupCopyButton(txt: HTMLInputElement, button: HTMLButtonElement): () => void {\n    return setupFeedbackButton(button, () => writeToClipboard(txt.value));\n}\n\nexport function setupViewButton(txt: HTMLInputElement, button: HTMLButtonElement): void {\n    button.addEventListener('click', () => {\n        if (txt.type === 'password') {\n            txt.type = 'input';\n            button.innerHTML = 'Hide';\n        } else {\n            txt.type = 'password';\n            button.innerHTML = 'View';\n        }\n    });\n}\n\nexport function showHide(element: HTMLElement, isVisible: boolean): void {\n    if (isVisible) {\n        element.style.removeProperty('display');\n    } else {\n        element.style.setProperty('display', 'none');\n    }\n}\n\nexport function showHideMany(elements: HTMLElement[], isVisible: boolean): void {\n    for (const element of elements) {\n        showHide(element, isVisible);\n    }\n}\n\nexport function setupShowHideButton(button: HTMLButtonElement, startVisible: boolean, elements: HTMLElement[]): void {\n    let isVisible = startVisible;\n    button.addEventListener('click', function () {\n        isVisible = !isVisible;\n        showHideMany(elements, isVisible);\n    });\n    showHideMany(elements, isVisible);\n}\n","export interface ITabInfo {\n    getTabButton(): HTMLButtonElement;\n    getTabContent(): HTMLElement;\n    onTabSelected(): void;\n}\n\nexport class TabControl {\n    private _activeTabIndex: number = -1;\n\n    public get activeTabIndex(): number {\n        return this._activeTabIndex;\n    }\n\n    public set activeTabIndex(index: number) {\n        if (index < 0 || index >= this.tabs.length) {\n            throw new Error(`Argument 'index' out of range. Must be in range [0;${this.tabs.length - 1}].`);\n        }\n        this.setActiveTab(index);\n    }\n\n    public constructor(private tabs: ITabInfo[]) {\n        for (let i = 0; i < this.tabs.length; i += 1) {\n            tabs[i].getTabButton().addEventListener('click', () => {\n                this.setActiveTab(i);\n            });\n        }\n\n        this.setActiveTab(0);\n    }\n\n    private setActiveTab(activeTabIndex: number) {\n        if (activeTabIndex === this._activeTabIndex) {\n            return;\n        }\n\n        let tabInfo: ITabInfo;\n\n        for (tabInfo of this.tabs) {\n            const button = tabInfo.getTabButton();\n            button.style.removeProperty('font-weight');\n            button.style.setProperty('color', '#C0C0C0');\n\n            tabInfo.getTabContent().style.setProperty('display', 'none');\n        }\n\n        const button = this.tabs[activeTabIndex].getTabButton();\n        button.style.setProperty('font-weight', 'bold');\n        button.style.removeProperty('color');\n\n        this.tabs[activeTabIndex].getTabContent().style.removeProperty('display');\n\n        this._activeTabIndex = activeTabIndex;\n\n        this.tabs[activeTabIndex].onTabSelected();\n    }\n}\n","import * as ui from '../ui';\n\nimport { TimedAction } from '../TimedAction';\nimport { IComponent } from './IComponent';\n\nconst btnProtectTitleForProtect = 'Stores the string in memory and removes it from the UI component. Prevents a physical intruder from copy/pasting the value.';\nconst btnProtectTitleForClear = 'Removes the string form memory and re-enables the UI component.';\n\nconst txtPrivatePart = ui.getElementById('txtPrivatePart') as HTMLInputElement;\nconst txtPrivatePartConfirmation = ui.getElementById('txtPrivatePartConfirmation') as HTMLInputElement;\nconst btnProtect = ui.getElementById('btnProtect') as HTMLButtonElement;\nconst spnProtectedConfirmation = ui.getElementById('spnProtectedConfirmation');\n\nconst spnPrivatePartSize = ui.getElementById('spnPrivatePartSize');\nconst spnPrivatePartSizeConfirmation = ui.getElementById('spnPrivatePartSizeConfirmation');\n\nconst PRIVATE_PART_PROTECTION_TIMEOUT: number = 60 * 1000;\n\nlet privatePart: string | undefined;\n\nconst onChangedHandlers: (() => void)[] = [];\n\nexport function registerOnChanged(onChanged: () => void) {\n    onChangedHandlers.push(onChanged);\n}\n\nexport function hasPrivatePart(): boolean {\n    return getPrivatePart().length > 0;\n}\n\nexport function getPrivatePart(): string {\n    if (privatePart !== undefined) {\n        return privatePart;\n    }\n    return txtPrivatePart.value;\n}\n\nexport function protectAndLockPrivatePart(): void {\n    if (txtPrivatePart.value.length === 0) {\n        return;\n    }\n\n    privatePart = txtPrivatePart.value;\n    spnProtectedConfirmation.innerHTML = 'Protected';\n\n    ui.clearText(txtPrivatePart);\n\n    ui.clearText(txtPrivatePartConfirmation);\n    spnPrivatePartSize.innerHTML = '0';\n    spnPrivatePartSizeConfirmation.innerHTML = '0';\n\n    txtPrivatePart.disabled = true;\n    txtPrivatePartConfirmation.disabled = true;\n\n    btnProtect.innerHTML = 'Clear and unlock';\n    btnProtect.title = btnProtectTitleForClear;\n\n    updatePrivatePartsMatching();\n}\n\nfunction clearAndUnLockPrivatePart(): void {\n    privatePart = undefined;\n    spnProtectedConfirmation.innerHTML = '';\n\n    txtPrivatePart.disabled = false;\n    txtPrivatePartConfirmation.disabled = false;\n\n    btnProtect.innerHTML = 'Protect and lock';\n    btnProtect.title = btnProtectTitleForProtect;\n    btnProtect.disabled = true;\n}\n\nfunction togglePrivatePartProtection(): void {\n    if (privatePart === undefined) {\n        protectAndLockPrivatePart();\n    } else {\n        clearAndUnLockPrivatePart();\n    }\n}\n\nfunction onProtectButtonClick() {\n    togglePrivatePartProtection();\n}\n\nconst protectPrivatePartAction: TimedAction = new TimedAction(protectAndLockPrivatePart, PRIVATE_PART_PROTECTION_TIMEOUT);\n\nfunction onPrivatePartTextInput(): void {\n    btnProtect.disabled = txtPrivatePart.value.length === 0;\n\n    spnPrivatePartSize.innerHTML = txtPrivatePart.value.length.toString();\n    updatePrivatePartsMatching();\n\n    let onChangedHandler: () => void;\n    for (onChangedHandler of onChangedHandlers) {\n        onChangedHandler();\n    }\n\n    protectPrivatePartAction.reset();\n}\n\nfunction updatePrivatePartsMatching(): void {\n    if (txtPrivatePartConfirmation.value === txtPrivatePart.value) {\n        txtPrivatePartConfirmation.style.setProperty('background', ui.SUCCESS_COLOR);\n    } else {\n        txtPrivatePartConfirmation.style.setProperty('background', ui.ERROR_COLOR);\n    }\n};\n\nfunction onPrivatePartConfirmationTextInput(): void {\n    spnPrivatePartSizeConfirmation.innerHTML = txtPrivatePartConfirmation.value.length.toString();\n    protectPrivatePartAction.reset();\n    updatePrivatePartsMatching();\n}\n\nexport class PrivatePartComponent implements IComponent {\n    public readonly name: string = 'PrivatePart';\n\n    public getVaultHint(): string {\n        throw new Error('Not supported.');\n    }\n\n    public init(): void {\n        btnProtect.addEventListener('click', onProtectButtonClick);\n        txtPrivatePart.addEventListener('input', onPrivatePartTextInput);\n        txtPrivatePartConfirmation.addEventListener('input', onPrivatePartConfirmationTextInput);\n\n        updatePrivatePartsMatching();\n        btnProtect.title = btnProtectTitleForProtect;\n        txtPrivatePart.focus();\n    }\n}\n","export class TimedAction {\n    private timeout: number | undefined;\n\n    public constructor(private action: Function, private delay: number) {\n    }\n\n    public reset(overrideDelay: number | undefined = undefined): void {\n        if (this.timeout !== undefined) {\n            clearTimeout(this.timeout);\n        }\n\n        const delay = overrideDelay !== undefined ? overrideDelay : this.delay;\n\n        this.timeout = window.setTimeout(() => {\n            this.action();\n            this.timeout = undefined;\n        }, delay);\n    }\n}\n","export function arrayToString(array: ArrayBuffer): string {\n    const decoder = new TextDecoder(/*'utf-8'*/);\n    return decoder.decode(array);\n};\n\nexport function copy(source: Uint8Array, sourceIndex: number, target: Uint8Array, targetIndex: number, length: number): void {\n    for (let i: number = 0; i < length; i += 1) {\n        target[i + targetIndex] = source[i + sourceIndex];\n    }\n}\n\nfunction createHeaderedBuffer(buffer: ArrayBuffer): ArrayBuffer {\n    if (buffer.byteLength > 0xFFFF) {\n        throw new Error(`Buffer too large: ${buffer.byteLength} bytes`);\n    }\n\n    let length = buffer.byteLength;\n    const headeredBuffer: Uint8Array = new Uint8Array(2 + buffer.byteLength);\n\n    for (let i: number = 0; i < 2; i += 1) {\n        headeredBuffer[i] = length % 256;\n        length /= 256;\n    }\n\n    headeredBuffer.set(new Uint8Array(buffer), 2);\n\n    return headeredBuffer.buffer;\n}\n\nfunction arrayBufferToUnsignedBigIntWithoutHeader(arrayBuffer: ArrayBuffer): bigint {\n    const length: number = arrayBuffer.byteLength;\n    const arrayView: DataView = new DataView(arrayBuffer, 0);\n\n    let result: bigint = 0n;\n    let multiplier: bigint = 1n;\n\n    for (let i: number = 0; i < length; i += 1) {\n        result += BigInt(arrayView.getUint8(i)) * multiplier;\n        multiplier *= 256n;\n    }\n\n    return result;\n}\n\nfunction arrayBufferToUnsignedBigInt(arrayBuffer: ArrayBuffer): bigint {\n    arrayBuffer = createHeaderedBuffer(arrayBuffer);\n\n    const length: number = arrayBuffer.byteLength;\n    const arrayView: DataView = new DataView(arrayBuffer, 0);\n\n    let result: bigint = 0n;\n    let multiplier: bigint = 1n;\n\n    for (let i: number = 0; i < length; i += 1) {\n        result += BigInt(arrayView.getUint8(i)) * multiplier;\n        multiplier *= 256n;\n    }\n\n    return result;\n}\n\nexport function unsignedBigIntToArrayBuffer(number: bigint): ArrayBuffer {\n    const result: Array<number> = [];\n\n    while (number > 0n)\n    {\n        const remainder: bigint = number % 256n;\n        number /= 256n;\n\n        const byteValue: number = Number(<any>BigInt.asUintN(8, remainder));\n\n        result.push(byteValue);\n    }\n\n    let totalLength: number = result[0];\n    if (result.length > 1) { // For case where original buffer is of length 1 and contains 0.\n        totalLength += result[1] * 256;\n    }\n\n    // The varable 'result' contains 2 bytes of size header.\n    const diff = totalLength - (result.length - 2);\n\n    for (let i: number = 0; i < diff; i += 1) {\n        result.push(0);\n    }\n\n    return new Uint8Array(result.slice(2)).buffer;\n}\n\n// This is a one way encoding in the sense that decoding is not always deterministic.\n// This can be used to generate strings where decoding it doesn't matter.\nexport function toCustomBaseOneWay(bytes: ArrayBuffer, alphabet: string): string {\n    const alphabetLength: bigint = BigInt(alphabet.length);\n\n    let result: string = '';\n    let number: bigint = arrayBufferToUnsignedBigIntWithoutHeader(bytes);\n\n    while (number > 0n)\n    {\n        const remainder: bigint = number % alphabetLength;\n        number /= alphabetLength;\n\n        const index: number = <number><any>BigInt.asUintN(8, remainder);\n\n        result += alphabet[index];\n    }\n\n    return result;\n}\n\nexport function toCustomBase(bytes: ArrayBuffer, alphabet: string): string {\n    const alphabetLength: bigint = BigInt(alphabet.length);\n\n    let result: string = '';\n    let number: bigint = arrayBufferToUnsignedBigInt(bytes);\n\n    while (number > 0n)\n    {\n        const remainder: bigint = number % alphabetLength;\n        number /= alphabetLength;\n\n        const index: number = <number><any>BigInt.asUintN(8, remainder);\n\n        result += alphabet[index];\n    }\n\n    return result;\n}\n\nexport function fromCustomBase(input: string, alphabet: string): ArrayBuffer {\n    const alphabetLength: bigint = BigInt(alphabet.length);\n\n    let number: bigint = 0n;\n    let multiplier: bigint = 1n;\n\n    for (let i: number = 0; i < input.length; i += 1) {\n        const value: bigint = BigInt(alphabet.indexOf(input[i]));\n\n        number += value * multiplier;\n        multiplier *= alphabetLength;\n    }\n\n    return unsignedBigIntToArrayBuffer(number);\n}\n\nexport function toBase16(buffer: ArrayBuffer): string {\n    return Array.prototype.map.call(\n        new Uint8Array(buffer),\n        x => ('00' + x.toString(16)).slice(-2)\n    ).join('');\n}\n","export class TaskCancelledError extends Error {\n    private _name: string;\n\n    public get name(): string {\n        return this._name;\n    }\n\n    constructor(message?: string) {\n        super(message);\n        this._name = TaskCancelledError.ERROR_NAME;\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n\n    public static readonly ERROR_NAME: string = 'TaskCancelledError';\n\n    public static isMatching(error: Error) {\n        return error && error.name === TaskCancelledError.ERROR_NAME;\n    }\n}\n\nexport class CancellationTokenSource {\n    private _isCancelled: boolean = false;\n    private _token: CancellationToken;\n\n    constructor() {\n        this._token = new CancellationToken(this);\n    }\n\n    public get isCancelled(): boolean {\n        return this._isCancelled;\n    }\n\n    public get token(): CancellationToken {\n        return this._token;\n    }\n\n    public cancel(): void {\n        this._isCancelled = true;\n    }\n}\n\nexport class CancellationToken {\n    private static _none: CancellationToken | null = null;\n    public static get none(): CancellationToken {\n        if (CancellationToken._none === null) {\n            CancellationToken._none = new CancellationToken(new CancellationTokenSource());\n        }\n        return CancellationToken._none;\n    }\n\n    constructor(private source: CancellationTokenSource) {\n    }\n\n    public get isCancelled(): boolean {\n        return this.source.isCancelled;\n    }\n}\n\nexport function ensureNotCancelled(cancellationToken: CancellationToken): void {\n    if (cancellationToken.isCancelled) {\n        throw new TaskCancelledError();\n    }\n}\n\nexport function rethrowCancelled(error: Error): void {\n    if (TaskCancelledError.isMatching(error)) {\n        throw error;\n    }\n}\n\nexport type TaskFactory<T> = (cancellationToken: CancellationToken) => Promise<T>;\n\n// Manages the lifetime of a single task, and automatically cancels the previous when running a new one.\n// It also awaits for previous task to be fully terminated before running the new one.\nexport class TaskRunner<TValue> {\n    private currentTokenSource: CancellationTokenSource | null = null;\n    private currentTask: Promise<TValue | undefined> | null = null;\n    private microThreadId: number = 0;\n\n    // Gets a value indicating whether a task is currently running or not.\n    public get isRunning(): boolean {\n        return this.currentTask !== null;\n    }\n\n    // Cancels the currently running task, if any.\n    // Returns true if no one called cancelInternal() when it returns.\n    private async cancelInternal(throwTaskCanceledError: boolean): Promise<boolean> {\n        if (this.microThreadId === Number.MAX_SAFE_INTEGER) {\n            this.microThreadId = 0;\n        } else {\n            this.microThreadId = this.microThreadId + 1;\n        }\n\n        const localMicroThreadId: number = this.microThreadId;\n\n        // This corresponds to the end of cancelAndExecute().\n        if (this.currentTask === null) {\n            return true;\n        }\n\n        if (this.currentTokenSource !== null) {\n            this.currentTokenSource.cancel();\n\n            // The above currentTokenSource.cancel() can run the finally block of cancelAndExecute() and set currentTask to null.\n            if (this.currentTask !== null) {\n                try {\n                    await this.currentTask;\n                } catch (error) {\n                    if (TaskCancelledError.isMatching(error as Error)) {\n                        if (throwTaskCanceledError) {\n                            throw error;\n                        }\n                    } else {\n                        throw error;\n                    }\n                }\n            }\n        }\n\n        return localMicroThreadId === this.microThreadId;\n    }\n\n    // Cancels the currently running task, if any.\n    // throwTaskCanceledError: Pass true allow to throw a TaskCancelledError.\n    // Returns a Promise that completes when the current job is fully cancelled.\n    public async cancel(throwTaskCanceledError: boolean = false): Promise<void> {\n        await this.cancelInternal(throwTaskCanceledError);\n    }\n\n    // Cancels the current task if any, and runs a new one.\n    // T: Type of value returned by the task to run.\n    // taskFactory: A task producer that receives a CancellationToken.\n    // throwTaskCanceledError: Pass true allow to throw a TaskCancelledError.\n    // Returns the task produced by the taskFactory.\n    public async cancelAndExecute(taskFactory: TaskFactory<TValue>, throwTaskCanceledError: boolean = false): Promise<TValue | undefined> {\n        if (await this.cancelInternal(throwTaskCanceledError) === false) {\n            if (throwTaskCanceledError === false) {\n                return undefined;\n            }\n            throw new TaskCancelledError();\n        }\n\n        var localToken = new CancellationTokenSource();\n        this.currentTokenSource = localToken;\n\n        try {\n            this.currentTask = taskFactory(this.currentTokenSource.token);\n            return await this.currentTask;\n        } catch (error) {\n            if (TaskCancelledError.isMatching(error as Error) && throwTaskCanceledError === false) {\n                return undefined;\n            }\n            throw error;\n        } finally {\n            this.currentTask = null;\n        }\n    }\n}\n","import * as arrayUtils from './arrayUtils';\nimport { CancellationToken, ensureNotCancelled } from './asyncUtils';\n\nexport const BASE62_ALPHABET: string = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n\nexport interface IPasswordGenerator {\n    readonly version: number;\n    readonly description: string;\n    generatePassword(privatePart: ArrayBuffer, publicPart: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer>;\n}\n\nexport interface ICipher {\n    readonly version: number;\n    readonly description: string;\n    encrypt(input: ArrayBuffer, password: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer>;\n    decrypt(input: ArrayBuffer, password: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer>;\n}\n\nexport async function getDerivedBytes(password: ArrayBuffer, salt: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer> {\n    const baseKey: CryptoKey = await window.crypto.subtle.importKey(\n        'raw',\n        password,\n        'PBKDF2',\n        false,\n        ['deriveKey']\n    );\n\n    ensureNotCancelled(cancellationToken);\n\n    const algorithm: Pbkdf2Params = {\n        name: 'PBKDF2',\n        hash: 'SHA-512',\n        iterations: 100000,\n        salt\n    };\n\n    const derivedKeyType: AesDerivedKeyParams = {\n        name: 'AES-GCM', // Using AES-CBC or AES-GCM here produces the same result.\n        length: 256\n    };\n\n    const result: CryptoKey = await window.crypto.subtle.deriveKey(\n        algorithm,\n        baseKey,\n        derivedKeyType,\n        true,\n        ['encrypt']\n    );\n\n    ensureNotCancelled(cancellationToken);\n\n    const key: ArrayBuffer = await window.crypto.subtle.exportKey('raw', result);\n\n    ensureNotCancelled(cancellationToken);\n\n    return key;\n}\n\nexport function generateRandomBytes(byteCount: number = 64): ArrayBuffer {\n    const array: Uint8Array = new Uint8Array(byteCount);\n    return crypto.getRandomValues(array).buffer;\n}\n\nexport function generateRandomString(byteCount: number = 64, alphabet: string = BASE62_ALPHABET): string {\n    const array: ArrayBuffer = generateRandomBytes(byteCount);\n    return arrayUtils.toCustomBaseOneWay(array, alphabet);\n}\n","function findNonCharFromStart(value: string, chars: string[]): number {\n    for (let i = 0; i < value.length; i += 1) {\n        if (chars.includes(value[i]) === false) {\n            return i;\n        }\n    }\n\n    return value.length;\n}\n\nfunction findNonCharFromEnd(value: string, chars: string[]): number {\n    for (let i = value.length - 1; i >= 0; i -= 1) {\n        if (chars.includes(value[i]) === false) {\n            return i + 1;\n        }\n    }\n\n    return value.length;\n}\n\nexport function trim(value: string, ...chars: string[]): string {\n    const start: number = findNonCharFromStart(value, chars);\n    const end: number = findNonCharFromEnd(value, chars);\n\n    return value.substring(start, end);\n}\n\nexport function truncate(input: string, length: number): string {\n    if (input.length <= length) {\n        return input;\n    }\n\n    return input.substring(0, length);\n}\n\nexport function stringToArray(str: string): ArrayBuffer {\n    const encoder = new TextEncoder(/*'utf-8'*/);\n    return encoder.encode(str).buffer;\n}\n\nexport function fromBase16(str: string): ArrayBuffer {\n    if (str.length % 2 !== 0) {\n        str = '0' + str;\n    }\n\n    const result: Uint8Array = new Uint8Array(str.length / 2);\n\n    for (let i = 0; i < result.byteLength; i += 1) {\n        const position = i * 2;\n        result[i] = parseInt(str.substring(position, position + 2), 16);\n    }\n\n    return result.buffer;\n}\n","export type PlainObject = { [key: string]: any };\n\nexport function isPlainObject(value: any): boolean {\n    return value !== undefined &&\n        value !== null &&\n        value.hasOwnProperty('constructor') === false &&\n        value.constructor.name === 'Object';\n}\n\nexport function objectDeepSort(object: PlainObject): PlainObject {\n    const output: PlainObject = {};\n\n    for (const [key, value] of Object.entries(object).sort((a, b) => a[0].localeCompare(b[0]))) {\n        output[key] = isPlainObject(value) ? objectDeepSort(value) : value;\n    }\n\n    return output;\n}\n","type ServiceContainer = { [key: string]: any };\n\nconst services: ServiceContainer = {};\n\nexport function listServices(): string[] {\n    return Object.keys(services);\n}\n\nexport function getService(serviceName: string): any {\n    if (!serviceName) {\n        throw new TypeError(`Argument 'serviceName' is mandatory.`);\n    }\n\n    const service = services[serviceName];\n\n    if (service === undefined) {\n        throw new Error(`Service '${serviceName}' is not registered.`);\n    }\n\n    return service;\n}\n\nexport function registerService(serviceName: string, instance: any): void {\n    if (!serviceName) {\n        throw new TypeError(`Argument 'serviceName' is mandatory.`);\n    }\n    if (instance === undefined) {\n        throw new TypeError(`Argument 'instance' cannot be undefined.`);\n    }\n\n    if (services[serviceName] !== undefined) {\n        throw new Error(`Service '${serviceName}' is already registered.`);\n    }\n\n    services[serviceName] = instance;\n}\n","import * as passwordComponent from '../components/passwordComponent';\n\nimport { SecureLocalStorage } from './SecureLocalStorage';\nimport { IVaultStorage } from './IVaultStorage';\nimport { PlainObject } from '../PlainObject';\n\nimport { CancellationToken } from '../asyncUtils';\n\ninterface IApp {\n    name: string;\n}\n\ninterface IAuthorization {\n    id: number;\n    app: IApp;\n}\n\ninterface IGitHubContent {\n    sha: string;\n    content: string;\n}\n\nabstract class GitHubVaultStorageBase implements IVaultStorage {\n    static BASE_URL: string = 'https://api.github.com';\n    static AUTH_TOKEN_KEY_NAME: string = 'GitHubVaultStorageBase.AuthToken';\n\n    private token: string | null = null;\n    private oneTimePassword: string | null = null;\n    private currentVaultContentHash: string | null = null;\n\n    private username: string | null = null;\n    private repositoryName: string | null = null;\n    private vaultFilename: string | null = null;\n\n    static LOCAL_STORAGE_KEY_USERNAME: string = 'GitHubVaultStorageBase.Username';\n    static LOCAL_STORAGE_KEY_REPO: string = 'GitHubVaultStorageBase.Repository';\n    static LOCAL_STORAGE_KEY_FILENAME: string = 'GitHubVaultStorageBase.Filename';\n\n    protected getUsername(): string | null {\n        return this.username;\n    }\n\n    protected getRepositoryName(): string | null {\n        return this.repositoryName;\n    }\n\n    protected getVaultFilename(): string | null {\n        return this.vaultFilename;\n    }\n\n    public constructor(protected secureLocalStorage: SecureLocalStorage) {\n    }\n\n    public clear(): void {\n        this.secureLocalStorage.removeItem(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_USERNAME);\n        this.secureLocalStorage.removeItem(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_REPO);\n        this.secureLocalStorage.removeItem(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_FILENAME);\n\n        this.secureLocalStorage.removeItem(GitHubVaultStorageBase.AUTH_TOKEN_KEY_NAME);\n    }\n\n    private constructTokenAuthString(): string {\n        return `token ${this.token}`;\n    }\n\n    private constructFetchRequest(method: string, authHeader: string, body: any): RequestInit {\n        const headers: PlainObject = {\n            'Accept': 'application/vnd.github.v3+json',\n            'Content-Type': 'application/json',\n            'Authorization': authHeader\n        };\n\n        if (this.oneTimePassword) {\n            headers['x-github-otp'] = this.oneTimePassword;\n        }\n\n        return {\n            method,\n            headers,\n            body: body ? JSON.stringify(body) : undefined\n        };\n    }\n\n    private constructUrl(relativeUrl: string): string {\n        return `${GitHubVaultStorageBase.BASE_URL}${relativeUrl}`;\n    }\n\n    protected async request(retryOnUnauthorized: boolean, method: string, relativeUrl: string, authHeader: string, body: any = undefined): Promise<Response | null> {\n        const url: string = this.constructUrl(relativeUrl);\n        const requestInfo: RequestInit = this.constructFetchRequest(method, authHeader, body);\n\n        let response: Response = await fetch(url, requestInfo);\n\n        if (response.status === 401 && retryOnUnauthorized) {\n            this.oneTimePassword = prompt('Input your 2FA code:');\n\n            if (!this.oneTimePassword) {\n                return null;\n            }\n\n            return await this.request(retryOnUnauthorized, method, relativeUrl, authHeader, body);\n        }\n\n        return response;\n    }\n\n    protected getSetVaultParameter(key: string, promptText: string, defaultValue?: string): string | null {\n        let value: string | null = window.localStorage.getItem(key);\n\n        if (value) {\n            return value;\n        }\n\n        value = prompt(promptText, defaultValue);\n\n        if (!value) {\n            return null;\n        }\n\n        window.localStorage.setItem(key, value);\n\n        return value;\n    }\n\n    protected ensureVaultParameters(): Promise<boolean> {\n        const url = new URL(window.location.toString());\n\n        let defaultAccountUsername = '';\n        let defaultRepo = '';\n\n        if (url.hostname === 'github.com') {\n            const pathElements = url.pathname.split('/');\n            if (pathElements.length >= 3) {\n                defaultAccountUsername = pathElements[1];\n                defaultRepo = `${pathElements[2]}Vault`;\n            }\n        }\n\n        const username = this.getSetVaultParameter(GitHubVaultStorageBase.LOCAL_STORAGE_KEY_USERNAME, 'GitHub account username:', defaultAccountUsername);\n        if (!username) {\n            return Promise.resolve(false);\n        }\n        this.username = username;\n\n        const repositoryName: string | null = this.getSetVaultParameter(GitHubVaultStorageBase.LOCAL_STORAGE_KEY_REPO, 'Vault GitHub repository name:', defaultRepo);\n        if (!repositoryName) {\n            return Promise.resolve(false);\n        }\n        this.repositoryName = repositoryName;\n\n        const vaultFilename: string | null = this.getSetVaultParameter(GitHubVaultStorageBase.LOCAL_STORAGE_KEY_FILENAME, 'Vault filename:', 'vault.json');\n        if (!vaultFilename) {\n            return Promise.resolve(false);\n        }\n        this.vaultFilename = vaultFilename;\n\n        return Promise.resolve(true);\n    }\n\n    protected abstract getToken(): Promise<string | null>;\n\n    private async ensureToken(): Promise<boolean> {\n        let token: string | null = await this.secureLocalStorage.getItem(GitHubVaultStorageBase.AUTH_TOKEN_KEY_NAME);\n\n        if (token === null) {\n            token = await this.getToken();\n        }\n\n        if (!token) {\n            return false;\n        }\n\n        await this.secureLocalStorage.setItem(GitHubVaultStorageBase.AUTH_TOKEN_KEY_NAME, token);\n\n        this.token = token;\n\n        return true;\n    }\n\n    private constructVaultFileUrl() {\n        return `/repos/${this.username}/${this.repositoryName}/contents/${this.vaultFilename}`;\n    }\n\n    public async getVaultContent(): Promise<string | null> {\n        if (await this.ensureVaultParameters() === false) {\n            return null;\n        }\n        if (await this.ensureToken() === false) {\n            return null;\n        }\n\n        const url: string = this.constructVaultFileUrl();\n        const response: Response | null = await this.request(false, 'GET', url, this.constructTokenAuthString());\n\n        if (response === null) {\n            console.warn('Fetching vault content aborted.');\n            return null;\n        }\n\n        if (response.ok === false) {\n            if (response.status === 401) {\n                this.secureLocalStorage.removeItem(GitHubVaultStorageBase.AUTH_TOKEN_KEY_NAME);\n                this.token = null;\n                this.oneTimePassword = null;\n\n                return await this.getVaultContent();\n            } else if (response.status === 404) {\n                if (await this.setVaultContent('{}', '[ItchyPassword] Creation of vault file')) {\n                    return '{}';\n                }\n                return null;\n            }\n\n            console.error(`Failed to fetch vault file '${this.vaultFilename}'.`, response);\n\n            return null;\n        }\n\n        const responseContent: IGitHubContent = await response.json();\n\n        this.currentVaultContentHash = responseContent.sha;\n\n        const decodedContent = atob(responseContent.content);\n\n        if (decodedContent.trim() === '') {\n            return '{}';\n        }\n\n        return decodedContent;\n    }\n\n    async setVaultContent(newContent: string, updateMessage: string): Promise<boolean> {\n        if (await this.ensureVaultParameters() === false) {\n            return false;\n        }\n        if (await this.ensureToken() === false) {\n            return false;\n        }\n\n        const body = {\n            message: updateMessage,\n            content: btoa(newContent),\n            sha: this.currentVaultContentHash\n        };\n\n        const url: string = this.constructVaultFileUrl();\n        const response: Response | null = await this.request(false, 'PUT', url, this.constructTokenAuthString(), body);\n\n        if (response === null) {\n            console.warn('Push new vault content aborted.');\n            return false;\n        }\n\n        const responseContent: any = await response.json();\n\n        if (response.ok === false) {\n            console.error(`Failed to create/update vault file '${this.vaultFilename}'.`, response, responseContent);\n            return false;\n        }\n\n        this.currentVaultContentHash = (responseContent.content as IGitHubContent).sha;\n\n        return true;\n    };\n}\n\n// ================================================================================================\n\nexport class GitHubPersonalAccessTokenVaultStorage extends GitHubVaultStorageBase {\n    protected getToken(): Promise<string | null> {\n        const authToken: string | null = prompt('Personal access token:');\n        return Promise.resolve(authToken);\n    }\n}\n\n// ================================================================================================\n\nexport class GitHubApiVaultStorage extends GitHubVaultStorageBase {\n    static AUTHORIZATION_NAME: string = 'github.com/TanukiSharp/ItchyPassword';\n\n    static LOCAL_STORAGE_KEY_PASSWORD_PUBLIC: string = 'GitHubApiVaultStorage.PasswordPublicPart';\n    static LOCAL_STORAGE_KEY_PASSWORD_LENGTH: string = 'GitHubApiVaultStorage.PasswordLength';\n    static LOCAL_STORAGE_KEY_BROWSER_NAME: string = 'GitHubApiVaultStorage.BrowserName';\n\n    private basicAuthHeader: string | null = null;\n    private authorizationName: string | null = null;\n\n    public constructor(secureLocalStorage: SecureLocalStorage) {\n        super(secureLocalStorage);\n    }\n\n    public clear(): void {\n        super.clear();\n\n        this.secureLocalStorage.removeItem(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_PASSWORD_PUBLIC);\n        this.secureLocalStorage.removeItem(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_PASSWORD_LENGTH);\n        this.secureLocalStorage.removeItem(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_BROWSER_NAME);\n    }\n\n    private constructBasicAuthString(username: string, password: string): string {\n        console.log('username:', username);\n        console.log('password:', password);\n\n        const authString = btoa(`${username}:${password}`);\n        return `Basic ${authString}`;\n    }\n\n    private async listAuthorizations(): Promise<IAuthorization[] | null> {\n        if (!this.basicAuthHeader) {\n            return null;\n        }\n\n        const response: Response | null = await this.request(true, 'GET', '/authorizations', this.basicAuthHeader);\n\n        if (response === null) {\n            console.warn('List authorizations aborted.');\n            return null;\n        }\n\n        if (response.ok === false) {\n            console.error('Failed to list authorizations.', response);\n            return null;\n        }\n\n        return await response.json();\n    }\n\n    private async deleteAuthorization(authorization: IAuthorization): Promise<boolean> {\n        if (!this.basicAuthHeader) {\n            return false;\n        }\n\n        const response: Response | null = await this.request(true, 'DELETE', `/authorizations/${authorization.id}`, this.basicAuthHeader);\n\n        if (response === null) {\n            console.warn('Delete authorization aborted.');\n            return false;\n        }\n\n        if (response.ok === false) {\n            console.error(`Failed to delete authorization '${authorization.id}'.`, response);\n        }\n\n        return response.ok;\n    }\n\n    private async createAuthorization(): Promise<string | null> {\n        if (!this.authorizationName) {\n            return null;\n        }\n\n        if (!this.basicAuthHeader) {\n            return null;\n        }\n\n        const body: PlainObject = {\n            scopes: ['repo'],\n            note: this.authorizationName\n        };\n\n        const response: Response | null = await this.request(true, 'POST', '/authorizations', this.basicAuthHeader, body);\n\n        if (response === null) {\n            console.warn('Create new authorization aborted.');\n            return null;\n        }\n\n        if (response.ok === false) {\n            console.error('Failed to create new authorization.', response);\n            return null;\n        }\n\n        return (await response.json()).token as string;\n    }\n\n    private findAuthorization(authorizations: IAuthorization[]): IAuthorization | null {\n        if (!this.authorizationName) {\n            return null;\n        }\n\n        for (const authorization of authorizations) {\n            if (authorization.app && authorization.app.name === this.authorizationName) {\n                return authorization;\n            }\n        }\n\n        return null;\n    }\n\n    protected async ensureVaultParameters(): Promise<boolean> {\n        if (await super.ensureVaultParameters() === false) {\n            return false;\n        }\n\n        const username: string | null = this.getUsername();\n        if (!username) {\n            return false;\n        }\n\n        const passwordPublicPart: string | null = this.getSetVaultParameter(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_PASSWORD_PUBLIC, 'GitHub account password public part:');\n        if (!passwordPublicPart) {\n            return false;\n        }\n\n        const passwordLengthString: string | null = this.getSetVaultParameter(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_PASSWORD_LENGTH, 'GitHub account password length:');\n        if (!passwordLengthString) {\n            return false;\n        }\n\n        const passwordLength: number = parseInt(passwordLengthString, 10);\n        if (Number.isSafeInteger(passwordLength) === false || passwordLength <= 0) {\n            return false;\n        }\n\n        let password: string | null = await passwordComponent.generatePasswordString(passwordPublicPart, passwordComponent.DEFAULT_ALPHABET, CancellationToken.none);\n        if (!password) {\n            return false;\n        }\n\n        this.basicAuthHeader = this.constructBasicAuthString(username, password.substring(0, passwordLength));\n\n        const browserName: string | null = this.getSetVaultParameter(GitHubApiVaultStorage.LOCAL_STORAGE_KEY_BROWSER_NAME, 'Current device/browser name:');\n        if (!browserName) {\n            return false;\n        }\n\n        this.authorizationName = `${GitHubApiVaultStorage.AUTHORIZATION_NAME} (${browserName})`;\n\n\n        return true;\n    }\n\n    protected async getToken(): Promise<string | null> {\n        const authorizations: IAuthorization[] | null = await this.listAuthorizations();\n\n        if (authorizations === null) {\n            return null;\n        }\n\n        const authorization: IAuthorization | null = this.findAuthorization(authorizations);\n\n        if (authorization !== null) {\n            if (await this.deleteAuthorization(authorization) === false) {\n                return null;\n            }\n        }\n\n        return await this.createAuthorization();\n    }\n}\n","import { ICipher, getDerivedBytes } from '../crypto';\nimport { CancellationToken, ensureNotCancelled } from '../asyncUtils';\n\nexport class CipherV2 implements ICipher {\n    public get version(): number {\n        return 2;\n    }\n\n    public get description(): string {\n        return 'PBKDF2 + AES-GCM';\n    }\n\n    async encrypt(input: ArrayBuffer, password: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer> {\n        const output: ArrayBuffer = new ArrayBuffer(12 + 16 + 16 + input.byteLength);\n\n        const nonce: Uint8Array = crypto.getRandomValues(new Uint8Array(output, 0, 12));\n        const passwordSalt: Uint8Array = crypto.getRandomValues(new Uint8Array(output, 12, 16));\n\n        const aesGcmParams: AesGcmParams = {\n            name: 'AES-GCM',\n            iv: nonce\n        };\n\n        const aesKeyAlgorithm: AesKeyAlgorithm = {\n            name: 'AES-GCM',\n            length: 256\n        };\n\n        const passwordKey: CryptoKey = await window.crypto.subtle.importKey(\n            'raw',\n            await getDerivedBytes(password, passwordSalt, cancellationToken),\n            aesKeyAlgorithm,\n            false,\n            ['encrypt']\n        );\n\n        ensureNotCancelled(cancellationToken);\n\n        const result: ArrayBuffer = await window.crypto.subtle.encrypt(aesGcmParams, passwordKey, input);\n\n        ensureNotCancelled(cancellationToken);\n\n        new Uint8Array(output).set(new Uint8Array(result), 12 + 16);\n\n        return output;\n    }\n\n    async decrypt(input: ArrayBuffer, password: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer> {\n        const nonce: Uint8Array = new Uint8Array(input, 0, 12);\n        const passwordSalt: Uint8Array = new Uint8Array(input, 12, 16);\n        const payload: Uint8Array = new Uint8Array(input, 12 + 16);\n\n        const aesGcmParams: AesGcmParams = {\n            name: 'AES-GCM',\n            iv: nonce\n        };\n\n        const aesKeyAlgorithm: AesKeyAlgorithm = {\n            name: 'AES-GCM',\n            length: 256\n        };\n\n        const derivedKey: ArrayBuffer = await getDerivedBytes(password, passwordSalt, cancellationToken);\n\n        ensureNotCancelled(cancellationToken);\n\n        const passwordKey: CryptoKey = await window.crypto.subtle.importKey(\n            'raw',\n            derivedKey,\n            aesKeyAlgorithm,\n            false,\n            ['decrypt']\n        );\n\n        ensureNotCancelled(cancellationToken);\n\n        const result: ArrayBuffer = await window.crypto.subtle.decrypt(aesGcmParams, passwordKey, payload);\n\n        ensureNotCancelled(cancellationToken);\n\n        return result;\n    }\n}\n","import { PlainObject } from 'PlainObject';\nimport { CipherComponent } from '../components/cipherComponent';\n\nexport class CipherService {\n    public constructor(private readonly cipherComponent: CipherComponent) {\n    }\n\n    public async activate(storageFullPath: string, cipherName: string, parameterKeys: PlainObject): Promise<boolean> {\n        if (await this.cipherComponent.setParameters(cipherName, parameterKeys, storageFullPath) === false) {\n            return false;\n        }\n\n        this.cipherComponent.getTabButton().click();\n\n        return true;\n    }\n}\n","import * as crypto from '../crypto';\nimport * as stringUtils from '../stringUtils';\nimport * as arrayUtils from '../arrayUtils';\n\nimport * as ui from '../ui';\nimport { getPrivatePart } from './privatePartComponent';\n\nimport { CipherV2 } from '../ciphers/v2';\nimport { ITabInfo } from '../TabControl';\nimport { IComponent } from './IComponent';\n\nimport * as storageOutputComponent from './storageOutputComponent';\n\nimport * as serviceManager from '../services/serviceManger';\nimport { CipherService } from '../services/cipherService';\n\nimport { CancellationToken, ensureNotCancelled, rethrowCancelled } from '../asyncUtils';\nimport { PlainObject } from '../PlainObject';\n\nconst btnTabCiphers = ui.getElementById('btnTabCiphers') as HTMLButtonElement;\nconst divTabCiphers = ui.getElementById('divTabCiphers');\n\nconst cipher: crypto.ICipher = new CipherV2();\n\nconst btnClearAllCipherInfo = ui.getElementById('btnClearAllCipherInfo') as HTMLButtonElement;\n\nconst txtCipherName = ui.getElementById('txtCipherName') as HTMLInputElement;\nconst txtCipherSource = ui.getElementById('txtCipherSource') as HTMLInputElement;\nconst txtCipherTarget = ui.getElementById('txtCipherTarget') as HTMLInputElement;\n\nconst btnEncrypt = ui.getElementById('btnEncrypt') as HTMLButtonElement;\nconst btnDecrypt = ui.getElementById('btnDecrypt') as HTMLButtonElement;\n\nconst btnCopyCipherSource = ui.getElementById('btnCopyCipherSource') as HTMLButtonElement;\nconst btnClearCipherSource = ui.getElementById('btnClearCipherSource') as HTMLButtonElement;\nconst btnCopyCipherTarget = ui.getElementById('btnCopyCipherTarget') as HTMLButtonElement;\nconst btnClearCipherTarget = ui.getElementById('btnClearCipherTarget') as HTMLButtonElement;\n\nlet cipherTargetLastChange: string | undefined;\n\nfunction clearSourceVisualCue(): void {\n    txtCipherSource.style.removeProperty('background-color');\n}\n\nfunction clearTargetVisualCue(): void {\n    txtCipherTarget.style.removeProperty('background-color');\n}\n\nfunction setSourceVisualCueError() {\n    txtCipherSource.style.setProperty('background-color', ui.ERROR_COLOR);\n}\n\nfunction setTargetVisualCueError() {\n    txtCipherTarget.style.setProperty('background-color', ui.ERROR_COLOR);\n}\n\nfunction clearAllVisualCues(): void {\n    clearSourceVisualCue();\n    clearTargetVisualCue();\n}\n\nfunction clearCipherTargetLastUpdate(): void {\n    cipherTargetLastChange = undefined;\n}\n\nfunction updateCipherTargetLastUpdate(): void {\n    cipherTargetLastChange = new Date().toISOString();\n}\n\nfunction setCipherTargetValue(value: string, isEncrypt: boolean): void {\n    const needDateTimeUpdate = value.length > 0 && txtCipherTarget.value !== value;\n\n    txtCipherTarget.value = value;\n\n    if (needDateTimeUpdate && isEncrypt) {\n        updateCipherTargetLastUpdate();\n    } else {\n        clearCipherTargetLastUpdate();\n    }\n\n    onCipherTargetChanged();\n}\n\nfunction onCipherTargetChanged(): void {\n    updateCipherParameters();\n}\n\nfunction updateCipherParameters(): void {\n    if (txtCipherTarget.value === '' || txtCipherName.value === '') {\n        storageOutputComponent.clearOutputs();\n        return;\n    }\n\n    const cipherParameters = {\n        datetime: cipherTargetLastChange,\n        version: cipher.version,\n        value: txtCipherTarget.value\n    }\n\n    const path = `ciphers/${txtCipherName.value}`;\n\n    storageOutputComponent.setParameters(cipherParameters, path);\n}\n\nexport async function encryptString(value: string, cancellationToken: CancellationToken): Promise<string | null> {\n    const privatePart: string = getPrivatePart();\n    if (privatePart.length === 0) {\n        console.warn('Private part is empty');\n        return null;\n    }\n\n    const input: ArrayBuffer = stringUtils.stringToArray(value);\n    const password: ArrayBuffer = stringUtils.stringToArray(privatePart);\n\n    const encrypted: ArrayBuffer = await cipher.encrypt(input, password, cancellationToken);\n\n    ensureNotCancelled(cancellationToken);\n\n    return arrayUtils.toCustomBase(encrypted, crypto.BASE62_ALPHABET);\n}\n\nexport async function decryptString(value: string, cancellationToken: CancellationToken): Promise<string | null> {\n    const privatePart: string = getPrivatePart();\n    if (privatePart.length === 0) {\n        console.warn('Private part is empty');\n        return null;\n    }\n\n    try {\n        const input: ArrayBuffer = arrayUtils.fromCustomBase(value, crypto.BASE62_ALPHABET);\n        const password: ArrayBuffer = stringUtils.stringToArray(privatePart);\n\n        const decrypted: ArrayBuffer = await cipher.decrypt(input, password, cancellationToken);\n\n        ensureNotCancelled(cancellationToken);\n\n        return arrayUtils.arrayToString(decrypted);\n    } catch (error) {\n        const typedError = error as Error;\n\n        rethrowCancelled(typedError);\n\n        console.warn(`Failed to decrypt${typedError.message ? `, error: ${typedError.message}` : ', no error message'}`);\n        return null;\n    }\n}\n\nasync function onEncryptButtonClick(): Promise<boolean> {\n    txtCipherSource.focus();\n    setCipherTargetValue('', true);\n    clearAllVisualCues();\n\n    if (txtCipherSource.value.length === 0) {\n        setSourceVisualCueError();\n        return false;\n    }\n\n    const encryptedString: string | null = await encryptString(txtCipherSource.value, CancellationToken.none);\n\n    if (encryptedString === null) {\n        return false;\n    }\n\n    setCipherTargetValue(encryptedString, true);\n    updateCipherParameters();\n\n    return true;\n}\n\nasync function onDecryptButtonClick(): Promise<boolean> {\n    txtCipherSource.focus();\n    setCipherTargetValue('', false);\n    clearAllVisualCues();\n\n    if (txtCipherSource.value.length === 0) {\n        setSourceVisualCueError();\n        return false;\n    }\n\n    const decryptedString: string | null = await decryptString(txtCipherSource.value, CancellationToken.none);\n\n    if (decryptedString === null) {\n        setTargetVisualCueError();\n        return false;\n    }\n\n    setCipherTargetValue(decryptedString, false);\n\n    return true;\n}\n\nexport class CipherComponent implements IComponent, ITabInfo {\n    public readonly name: string = 'Cipher';\n\n    public getTabButton(): HTMLButtonElement {\n        return btnTabCiphers;\n    }\n\n    public getTabContent(): HTMLElement {\n        return divTabCiphers;\n    }\n\n    public onTabSelected(): void {\n        storageOutputComponent.show();\n        updateCipherParameters();\n        txtCipherName.focus();\n    }\n\n    private static fullPathToStoragePath(fullPath: string, cipherName: string): string | null {\n        const prefix = '<root>/';\n        const suffix = `/ciphers/${cipherName}`;\n\n        if (fullPath.startsWith(prefix) === false) {\n            return null;\n        }\n\n        if (fullPath.endsWith(suffix) === false) {\n            return null;\n        }\n\n        return fullPath.substring(prefix.length, fullPath.length - suffix.length);\n    }\n\n    public async setParameters(cipherName: string, parameterKeys: PlainObject, storageFullPath: string): Promise<boolean> {\n        txtCipherName.value = '';\n        txtCipherSource.value = '';\n        txtCipherTarget.value = '';\n        storageOutputComponent.setPathUI('');\n        storageOutputComponent.setCustomKeysUI('');\n\n        const decrypted: string | null = await decryptString(parameterKeys.value, CancellationToken.none);\n\n        if (decrypted === null) {\n            alert(`Failed to decrypt cipher '${cipherName}'.`);\n            return false;\n        }\n\n        const storagePath: string | null = CipherComponent.fullPathToStoragePath(storageFullPath, cipherName);\n\n        if (storagePath === null) {\n            console.error(`Failed to retrieve storage path from full path '${storageFullPath}'.`);\n            alert('Failed to retrieve storage path from full path.');\n            return false;\n        }\n\n        if (parameterKeys.customKeys) {\n            storageOutputComponent.setCustomKeysUI(JSON.stringify(parameterKeys.customKeys, null, 4));\n        }\n\n        delete parameterKeys.customKeys;\n\n        txtCipherName.value = cipherName;\n        txtCipherSource.value = decrypted;\n\n        storageOutputComponent.setPathUI(storagePath);\n        storageOutputComponent.setParameters(parameterKeys, `ciphers/${cipherName}`);\n\n        return true;\n    }\n\n    public getVaultHint(): string {\n        return `${this.name.toLowerCase()} '${txtCipherName.value}'`;\n    }\n\n    public init(): void {\n        ui.setupCopyButton(txtCipherSource, btnCopyCipherSource);\n        ui.setupCopyButton(txtCipherTarget, btnCopyCipherTarget);\n\n        ui.setupFeedbackButton(btnEncrypt, onEncryptButtonClick);\n        ui.setupFeedbackButton(btnDecrypt, onDecryptButtonClick);\n\n        txtCipherName.addEventListener('input', () => {\n            updateCipherParameters();\n        });\n\n        txtCipherSource.addEventListener('input', () => {\n            if (txtCipherSource.value.length > 0) {\n                clearSourceVisualCue();\n            }\n        });\n\n        btnClearAllCipherInfo.addEventListener('click', () => {\n            txtCipherName.value = '';\n            txtCipherSource.value = '';\n            txtCipherTarget.value = '';\n            storageOutputComponent.clearMatchingPath();\n            clearCipherTargetLastUpdate();\n            clearAllVisualCues();\n\n            storageOutputComponent.clearUI();\n        });\n\n        btnClearCipherSource.addEventListener('click', () => {\n            ui.clearText(txtCipherSource, true);\n        });\n\n        btnClearCipherTarget.addEventListener('click', () => {\n            setCipherTargetValue('', false);\n        });\n\n        serviceManager.registerService('cipher', new CipherService(this));\n    }\n}\n","import * as ui from '../ui';\nimport * as stringUtils from '../stringUtils';\nimport { PlainObject, objectDeepSort } from '../PlainObject';\nimport { IComponent } from './IComponent';\nimport { rootComponent, RootComponent } from './rootComponent';\nimport * as serviceManager from '../services/serviceManger';\nimport { VaultService } from '../services/vaultService';\n\nimport { IVaultStorage } from '../storages/IVaultStorage';\nimport { GitHubPersonalAccessTokenVaultStorage } from '../storages/GitHubVaultStorage';\nimport { SecureLocalStorage } from '../storages/SecureLocalStorage';\n\nconst divStorageOutput: HTMLElement = ui.getElementById('divStorageOutput');\n\nconst txtPath: HTMLInputElement = ui.getElementById('txtPath') as HTMLInputElement;\nconst lblMatchingPath: HTMLElement = ui.getElementById('lblMatchingPath');\n\nconst txtParameters: HTMLInputElement = ui.getElementById('txtParameters') as HTMLInputElement;\nconst btnPushToVault: HTMLButtonElement = ui.getElementById('btnPushToVault') as HTMLButtonElement;\nconst txtCustomKeys: HTMLInputElement = ui.getElementById('txtCustomKeys') as HTMLInputElement;\n\nlet vaultStorage: IVaultStorage = new GitHubPersonalAccessTokenVaultStorage(new SecureLocalStorage());\n\ntype IChainInfo = {\n    head: PlainObject,\n    tailParent: PlainObject,\n    tail: PlainObject\n};\n\n// Transforms a path like \"a/b/c/d\" into a hierarchy of objects like { \"a\": { \"b\": { \"c\": { \"d\": {} } } } }\n// From the result object, head is the root object that contains \"a\", tail is the value of \"d\", and tailParent is the value of \"c\"\nfunction pathToObjectChain(path: string, chainInfo: IChainInfo | undefined = undefined): IChainInfo {\n    const separatorIndex: number = path.indexOf('/');\n\n    const tail: PlainObject = {};\n\n    const firstPath: string = separatorIndex >= 0 ? path.substring(0, separatorIndex) : path;\n    const remainingPath: string | undefined = separatorIndex >= 0 ? path.substring(separatorIndex + 1) : undefined;\n\n    if (chainInfo === undefined) {\n        const node: PlainObject = {};\n        node[firstPath] = tail;\n        chainInfo = {\n            head: node,\n            tailParent: node,\n            tail\n        };\n    } else {\n        chainInfo.tail[firstPath] = tail;\n        chainInfo.tailParent = chainInfo.tail;\n        chainInfo.tail = tail;\n    }\n\n    if (remainingPath) {\n        return pathToObjectChain(remainingPath, chainInfo);\n    }\n\n    return chainInfo;\n}\n\nfunction createMatchingPath(path: string, depth: number): string {\n    let position = 0;\n\n    for (let i = 0; i < depth; i += 1) {\n        position = path.indexOf('/', position);\n        if (position < 0) {\n            position = path.length + 1;\n            break;\n        }\n        position += 1;\n    }\n\n    return path.substring(0, position - 1);\n}\n\nfunction updateMatchingPath(): void {\n    const vaultService: VaultService = serviceManager.getService('vault');\n\n    const depth = vaultService.computeUserPathMatchDepth(txtPath.value);\n\n    if (depth > 0) {\n        const matchingPath = createMatchingPath(txtPath.value, depth);\n        lblMatchingPath.innerText = matchingPath;\n    } else {\n        lblMatchingPath.innerText = '';\n    }\n}\n\nfunction onPathTextInput() {\n    updateMatchingPath();\n    update();\n}\n\nfunction onCustomKeysTextInput(): void {\n    update();\n}\n\nfunction updateCustomKeysDisplay(isValid: boolean): void {\n    if (isValid) {\n        txtCustomKeys.style.removeProperty('background');\n        return;\n    }\n\n    txtCustomKeys.style.setProperty('background', ui.ERROR_COLOR);\n}\n\nfunction parseCustomKeys(): PlainObject | null {\n    if (txtCustomKeys.value === '') {\n        return null;\n    }\n\n    try {\n        const obj: any = JSON.parse(txtCustomKeys.value);\n        if (obj === null || obj.constructor.name !== 'Object') {\n            return null;\n        }\n        return obj as PlainObject;\n    } catch {\n        return null;\n    }\n}\n\nfunction update(): void {\n    if (_parameterKeys === undefined || _parameterPath === undefined) {\n        return;\n    }\n\n    const chainInfo: IChainInfo = pathToObjectChain(`${txtPath.value}/${_parameterPath}`);\n    const leaf: PlainObject = chainInfo.tail;\n\n    for (const [key, value] of Object.entries(_parameterKeys)) {\n        leaf[key] = value;\n    }\n\n    const customKeys: PlainObject | null = parseCustomKeys();\n\n    updateCustomKeysDisplay(txtCustomKeys.value === '' || customKeys !== null);\n\n    if (customKeys !== null) {\n        leaf.customKeys = customKeys;\n    }\n\n    if (Object.keys(leaf).length === 0) {\n        // Remove the leaf object.\n        chainInfo.tailParent[Object.keys(chainInfo.tailParent)[0]] = null;\n    }\n\n    txtParameters.value = JSON.stringify(objectDeepSort(chainInfo.head), undefined, 4);\n}\n\nfunction deepMerge(source: PlainObject, target: PlainObject): void {\n    for (const sourceKey of Object.keys(source)) {\n        const targetValue: any = target[sourceKey];\n        const sourceValue: any = source[sourceKey];\n\n        if (targetValue === undefined ||\n            targetValue === null ||\n            targetValue.constructor.name !== 'Object' ||\n            sourceValue.constructor.name !== 'Object') {\n            target[sourceKey] = sourceValue;\n            continue;\n        }\n\n        deepMerge(sourceValue, targetValue);\n    }\n}\n\nfunction generateUpdateMessage() {\n    const activeComponent: IComponent | null = (rootComponent as RootComponent).getActiveComponent();\n\n    if (activeComponent === null) {\n        throw new Error('Could not determine active component.');\n    }\n\n    let hint: string = activeComponent.getVaultHint();\n\n    const matchingPath: string = lblMatchingPath.innerText;\n    const fullPath: string = txtPath.value;\n\n    if (!matchingPath) {\n        return `Added ${hint} for '${fullPath}'`;\n    }\n\n    if (matchingPath === fullPath) {\n        return `Updated ${hint} for '${fullPath}'`;\n    }\n\n    const remainingPath: string = stringUtils.trim(fullPath.substring(matchingPath.length), '/');\n\n    return `Updated ${hint} for '${matchingPath}' adding '${remainingPath}'`;\n}\n\nasync function pushToVault(): Promise<boolean> {\n    const vaultContentData: string | null = await vaultStorage.getVaultContent();\n\n    if (vaultContentData === null) {\n        return false;\n    }\n\n    const newData = JSON.parse(txtParameters.value);\n    let vaultContent = JSON.parse(vaultContentData);\n\n    // Keep deepMerge despite now all properties are explicitly defined, because of\n    // the datetime property that really need to be overwritten only if it exists.\n    deepMerge(newData, vaultContent);\n\n    const message: string = generateUpdateMessage();\n\n    const newVaultContentData: string = JSON.stringify(objectDeepSort(vaultContent), undefined, 4) + '\\n';\n\n    await vaultStorage.setVaultContent(newVaultContentData, `[ItchyPassword] ${message}`);\n\n    return true;\n}\n\nexport function clearOutputs(): void {\n    _parameterKeys = undefined;\n    _parameterPath = undefined;\n    ui.clearText(txtParameters);\n}\n\nlet _parameterKeys: PlainObject | undefined;\nlet _parameterPath: string | undefined;\n\nexport function setParameters(parameterKeys: PlainObject, parameterPath: string) {\n    _parameterKeys = parameterKeys;\n    _parameterPath = parameterPath;\n    update();\n}\n\nexport function setPathUI(path: string) {\n    txtPath.value = path;\n    onPathTextInput();\n}\n\nexport function setCustomKeysUI(customKeys: string) {\n    txtCustomKeys.value = customKeys;\n}\n\nexport function show(): void {\n    divStorageOutput.style.setProperty('display', 'initial');\n}\n\nexport function hide(): void {\n    divStorageOutput.style.setProperty('display', 'none');\n}\n\nexport function clearUI(): void {\n    txtPath.value = '';\n    txtParameters.value = '';\n    txtCustomKeys.value = '';\n    _parameterKeys = undefined;\n    _parameterPath = undefined;\n    updateCustomKeysDisplay(true);\n}\n\nexport function clearMatchingPath(): void {\n    lblMatchingPath.innerText = '';\n}\n\nexport class StorageOutputComponent implements IComponent {\n    public readonly name: string = 'StorageOutput';\n\n    public getVaultHint(): string {\n        throw new Error('Not supported.');\n    }\n\n    public init(): void {\n        txtCustomKeys.addEventListener('input', onCustomKeysTextInput);\n        ui.setupFeedbackButton(btnPushToVault, pushToVault);\n        txtPath.addEventListener('input', onPathTextInput);\n    }\n}\n","import * as cipherComponent from '../components/cipherComponent';\nimport { CancellationToken } from '../asyncUtils';\n\nexport interface IAsyncStorage {\n    readonly length: number;\n    clear(): void;\n    getItem(key: string): Promise<string | null>;\n    key(index: number): string | null;\n    removeItem(key: string): void;\n    setItem(key: string, value: string): Promise<void>;\n}\n\nexport class SecureLocalStorage implements IAsyncStorage {\n    get length(): number {\n        return window.localStorage.length;\n    }\n\n    clear(): void {\n        window.localStorage.clear();\n    }\n\n    key(index: number): string | null {\n        return window.localStorage.key(index);\n    }\n\n    removeItem(key: string): void {\n        window.localStorage.removeItem(key);\n    }\n\n    async getItem(key: string): Promise<string | null> {\n        const encryptedItem: string | null = window.localStorage.getItem(key);\n\n        if (encryptedItem === null) {\n            return null;\n        }\n\n        return await cipherComponent.decryptString(encryptedItem, CancellationToken.none);\n    }\n\n    async setItem(key: string, value: string): Promise<void> {\n        const encrypted: string | null = await cipherComponent.encryptString(value, CancellationToken.none);\n\n        if (encrypted === null) {\n            console.error('Failed to encrypt value. (nothing stored)');\n            return;\n        }\n\n        window.localStorage.setItem(key, encrypted);\n    }\n}\n","import { CancellationToken } from '../asyncUtils';\nimport * as stringUtils from '../stringUtils';\nimport * as ui from '../ui';\nimport * as passwordComponent from '../components/passwordComponent';\n\nexport class PasswordService {\n    async generateAndCopyPasswordToClipboard(publicPart: string, alphabet?: string, length?: number): Promise<boolean> {\n        alphabet = alphabet !== undefined ? alphabet : passwordComponent.DEFAULT_ALPHABET;\n        length = length !== undefined ? length : passwordComponent.DEFAULT_LENGTH;\n\n        const keyString: string | null = await passwordComponent.generatePasswordString(publicPart, alphabet, CancellationToken.none);\n\n        if (keyString === null) {\n            return false;\n        }\n\n        const password = stringUtils.truncate(keyString, Math.max(4, length));\n\n        return await ui.writeToClipboard(password);\n    }\n}\n","import * as ui from '../ui';\nimport * as privatePartComponent from './privatePartComponent';\n\nimport * as crypto from '../crypto';\nimport * as stringUtils from '../stringUtils';\nimport * as arrayUtils from '../arrayUtils';\n\nimport { PlainObject } from '../PlainObject';\nimport { PasswordGeneratorV1 } from '../passwordGenerators/v1';\nimport { ITabInfo } from '../TabControl';\nimport { IComponent } from './IComponent';\n\nimport * as storageOutputComponent from './storageOutputComponent';\n\nimport { CancellationToken, TaskRunner } from '../asyncUtils';\n\nimport * as serviceManager from '../services/serviceManger';\nimport { PasswordService } from '../services/passwordService';\n\nconst btnTabPasswords = ui.getElementById('btnTabPasswords') as HTMLButtonElement;\nconst divTabPasswords = ui.getElementById('divTabPasswords');\n\nconst passwordGenerator: crypto.IPasswordGenerator = new PasswordGeneratorV1('Password');\n\nconst txtPublicPart = ui.getElementById('txtPublicPart') as HTMLInputElement;\nconst spnPublicPartSize = ui.getElementById('spnPublicPartSize');\nconst btnGeneratePublicPart = ui.getElementById('btnGeneratePublicPart') as HTMLButtonElement;\nconst btnClearPublicPart = ui.getElementById('btnClearPublicPart') as HTMLButtonElement;\nconst btnCopyPublicPart = ui.getElementById('btnCopyPublicPart') as HTMLButtonElement;\nconst btnShowHidePasswordOptionalFeatures = ui.getElementById('btnShowHidePasswordOptionalFeatures') as HTMLButtonElement;\n\nconst lblAlphabetLength = ui.getElementById('lblAlphabetLength');\nconst numOutputSizeRange = ui.getElementById('numOutputSizeRange') as HTMLInputElement;\nconst numOutputSizeNum = ui.getElementById('numOutputSizeNum') as HTMLInputElement;\n\nconst lblAlphabet = ui.getElementById('lblAlphabet');\nconst txtAlphabet = ui.getElementById('txtAlphabet') as HTMLInputElement;\nconst spnAlphabetSize = ui.getElementById('spnAlphabetSize');\nconst divPasswordAlphabetActions = ui.getElementById('divPasswordAlphabetActions');\nconst btnResetAlphabet = ui.getElementById('btnResetAlphabet') as HTMLButtonElement;\n\nconst txtResultPassword = ui.getElementById('txtResultPassword') as HTMLInputElement;\nconst spnResultPasswordLength = ui.getElementById('spnResultPasswordLength');\nconst btnViewResultPassword = ui.getElementById('btnViewResultPassword') as HTMLButtonElement;\nconst btnCopyResultPassword = ui.getElementById('btnCopyResultPassword') as HTMLButtonElement;\nconst lblGeneratingPassword = ui.getElementById('lblGeneratingPassword');\n\nexport const DEFAULT_LENGTH: number = 64;\nexport const DEFAULT_ALPHABET: string = '!\"#$%&\\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~';\n\nlet passwordPublicPartLastChange: string | undefined;\nlet copyPasswordFunction: () => void;\n\nfunction onClearPublicPartButtonClick(): boolean {\n    if (txtPublicPart.value.length > 0) {\n        if (prompt('Are you sure you want to clear the public part ?\\nType \\'y\\' to accept', '') !== 'y') {\n            return false;\n        }\n    }\n\n    ui.clearText(txtPublicPart, true);\n\n    updatePublicPartSize();\n\n    updatePasswordPublicPartLastUpdate();\n    updatePasswordGenerationParameters();\n\n    return true;\n}\n\nfunction onGeneratePublicPartButtonClick(): boolean {\n    if (txtPublicPart.value.length > 0) {\n        if (prompt('Are you sure you want to generate a new public part ?\\nType \\'y\\' to accept', '') !== 'y') {\n            return false;\n        }\n    }\n\n    const randomString: string = crypto.generateRandomString();\n    txtPublicPart.value = randomString;\n    updatePublicPartSize();\n\n    updatePasswordPublicPartLastUpdate();\n\n    run();\n\n    return true;\n}\n\nfunction updatePasswordPublicPartLastUpdate(): void {\n    if (txtPublicPart.value.length > 0) {\n        passwordPublicPartLastChange = new Date().toISOString();\n    } else {\n        passwordPublicPartLastChange = undefined;\n    }\n}\n\nfunction updateResultPasswordLength(): void {\n    spnResultPasswordLength.innerHTML = txtResultPassword.value.length.toString();\n}\n\nfunction isAlphabetValid(alphabet: string): boolean {\n    const sortedAlphabet: string[] = alphabet.split('');\n    sortedAlphabet.sort();\n\n    for (let i: number = 1; i < sortedAlphabet.length; i += 1) {\n        if (sortedAlphabet[i - 1] === sortedAlphabet[i]) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\nfunction updatePasswordGenerationParameters(): void {\n    if (canRun() === false) {\n        clearOutputs();\n        return;\n    }\n\n    const passwordParamters: PlainObject = {\n        public: txtPublicPart.value,\n        datetime: passwordPublicPartLastChange,\n        version: passwordGenerator.version,\n        length: txtResultPassword.value.length,\n        alphabet: txtAlphabet.value\n    };\n\n    storageOutputComponent.setParameters(passwordParamters, 'password');\n}\n\nfunction updateOutputSizeRangeToNum(): void {\n    numOutputSizeNum.value = numOutputSizeRange.value;\n}\n\nfunction updateOutputSizeNumToRange(): boolean {\n    const min: number = parseInt(numOutputSizeRange.min, 10);\n    const val: number = parseInt(numOutputSizeNum.value, 10);\n    const max: number = parseInt(numOutputSizeRange.max, 10);\n\n    if (isNaN(val) === false) {\n        numOutputSizeRange.value = Math.max(min, Math.min(val, max)).toString();\n        return true;\n    }\n\n    return false;\n}\n\nasync function onOutputSizeRangeInput(): Promise<void> {\n    updateOutputSizeRangeToNum();\n    await run();\n}\n\nasync function onOutputSizeNumInput(): Promise<void> {\n    if (updateOutputSizeNumToRange()) {\n        updateOutputSizeRangeToNum();\n    }\n    await run();\n}\n\nfunction updatePublicPartSize(): void {\n    spnPublicPartSize.innerHTML = txtPublicPart.value.length.toString();\n}\n\nfunction updateAlphabetSize(): void {\n    spnAlphabetSize.innerHTML = txtAlphabet.value.length.toString();\n}\n\nfunction updateAlphabetValidityDisplay(isAlphabetValid: boolean): void {\n    if (isAlphabetValid) {\n        txtAlphabet.style.removeProperty('background');\n    } else {\n        txtAlphabet.style.setProperty('background', ui.ERROR_COLOR);\n    }\n}\n\nasync function onAlphabetTextInput(): Promise<void> {\n    const isAlphabetValidResult: boolean = isAlphabetValid(txtAlphabet.value);\n\n    updateAlphabetValidityDisplay(isAlphabetValidResult);\n\n    if (isAlphabetValidResult === false) {\n        return;\n    }\n\n    updateAlphabetSize();\n    await run();\n}\n\nasync function onResetAlphabetButtonClick(): Promise<boolean> {\n    if (resetAlphabet() === false) {\n        return false;\n    }\n\n    await run();\n\n    return true;\n}\n\nfunction clearOutputs(): void {\n    ui.clearText(txtResultPassword);\n    storageOutputComponent.clearOutputs();\n    updateResultPasswordLength();\n}\n\nfunction canRun(publicPart?: string): boolean {\n    const alphabet: string = txtAlphabet.value;\n\n    if (isAlphabetValid(alphabet) === false) {\n        return false;\n    }\n\n    publicPart = publicPart || txtPublicPart.value;\n\n    if (privatePartComponent.getPrivatePart().length <= 0 || publicPart.length < 8 || alphabet.length < 2) {\n        return false;\n    }\n\n    return true;\n}\n\nexport async function generatePasswordString(publicPart: string, alphabet: string, cancellationToken: CancellationToken): Promise<string | null> {\n    if (canRun(publicPart) === false) {\n        return null;\n    }\n\n    const privatePartString: string = privatePartComponent.getPrivatePart();\n    const privatePrivateBytes: ArrayBuffer = stringUtils.stringToArray(privatePartString);\n    const publicPartBytes: ArrayBuffer = stringUtils.stringToArray(publicPart);\n    const keyBytes: ArrayBuffer = await passwordGenerator.generatePassword(privatePrivateBytes, publicPartBytes, cancellationToken);\n\n    return arrayUtils.toCustomBaseOneWay(keyBytes, alphabet);\n}\n\nconst passwordTaskRunner: TaskRunner<void> = new TaskRunner<void>();\n\nexport async function run(): Promise<void> {\n    if (canRun() === false) {\n        clearOutputs();\n        return;\n    }\n\n    ui.showHide(lblGeneratingPassword, true);\n\n    try {\n        await passwordTaskRunner.cancelAndExecute(runCore);\n    } finally {\n        ui.showHide(lblGeneratingPassword, false);\n    }\n}\n\nasync function runCore(cancellationToken: CancellationToken): Promise<void> {\n    const keyString: string | null = await generatePasswordString(txtPublicPart.value, txtAlphabet.value, cancellationToken);\n    if (keyString === null) {\n        return;\n    }\n\n    txtResultPassword.value = stringUtils.truncate(keyString, Math.max(4, parseInt(numOutputSizeRange.value, 10)));\n\n    updateResultPasswordLength();\n    updatePasswordGenerationParameters();\n\n    copyPasswordFunction();\n}\n\nfunction resetAlphabet(): boolean {\n    txtAlphabet.value = DEFAULT_ALPHABET;\n    updateAlphabetSize();\n\n    const isAlphabetValidResult: boolean = isAlphabetValid(txtAlphabet.value);\n\n    updateAlphabetValidityDisplay(isAlphabetValidResult);\n\n    return isAlphabetValidResult;\n}\n\nasync function onPublicPartTextInput(): Promise<void> {\n    updatePublicPartSize();\n    updatePasswordPublicPartLastUpdate();\n    await run();\n}\n\nexport class PasswordComponent implements IComponent, ITabInfo {\n    public readonly name: string = 'Password';\n\n    public getTabButton(): HTMLButtonElement {\n        return btnTabPasswords;\n    }\n\n    public getTabContent(): HTMLElement {\n        return divTabPasswords;\n    }\n\n    public onTabSelected(): void {\n        storageOutputComponent.show();\n        updatePasswordGenerationParameters();\n        txtPublicPart.focus();\n    }\n\n    public getVaultHint(): string {\n        return this.name.toLowerCase();\n    }\n\n    public init(): void {\n        privatePartComponent.registerOnChanged(run);\n\n        // dafuq!?\n        numOutputSizeRange.max = DEFAULT_LENGTH.toString();\n        numOutputSizeRange.value = DEFAULT_LENGTH.toString();\n\n        ui.setupFeedbackButton(btnClearPublicPart, onClearPublicPartButtonClick);\n        ui.setupFeedbackButton(btnGeneratePublicPart, onGeneratePublicPartButtonClick);\n\n        ui.setupViewButton(txtResultPassword, btnViewResultPassword);\n\n        ui.setupCopyButton(txtPublicPart, btnCopyPublicPart);\n        copyPasswordFunction = ui.setupCopyButton(txtResultPassword, btnCopyResultPassword);\n\n        numOutputSizeRange.addEventListener('input', onOutputSizeRangeInput);\n        numOutputSizeNum.addEventListener('input', onOutputSizeNumInput);\n\n        txtAlphabet.addEventListener('input', onAlphabetTextInput);\n        ui.setupFeedbackButton(btnResetAlphabet, onResetAlphabetButtonClick);\n\n        txtPublicPart.addEventListener('input', onPublicPartTextInput);\n\n        ui.showHide(lblGeneratingPassword, false);\n\n        ui.setupShowHideButton(btnShowHidePasswordOptionalFeatures, false, [\n            lblAlphabet,\n            txtAlphabet,\n            spnAlphabetSize,\n            divPasswordAlphabetActions,\n            lblAlphabetLength,\n            numOutputSizeRange,\n            numOutputSizeNum\n        ]);\n\n        updatePublicPartSize();\n        updateOutputSizeRangeToNum();\n        resetAlphabet();\n\n        serviceManager.registerService('password', new PasswordService());\n    }\n};\n","import { stringToArray } from '../stringUtils';\nimport { IPasswordGenerator, getDerivedBytes } from '../crypto';\nimport { CancellationToken, ensureNotCancelled } from '../asyncUtils';\n\nexport class PasswordGeneratorV1 implements IPasswordGenerator {\n    private hkdfPurpose: ArrayBuffer;\n    private _description: string;\n\n    public constructor(hkdfPurpose: string) {\n        this.hkdfPurpose = stringToArray(hkdfPurpose);\n        this._description = `HKDF(PBKDF2, HMAC512) [purpose: ${hkdfPurpose}]`;\n    }\n\n    public get version(): number {\n        return 1;\n    }\n\n    public get description(): string {\n        return this._description;\n    }\n\n    public async generatePassword(privatePart: ArrayBuffer, publicPart: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer> {\n        const derivedKey: ArrayBuffer = await getDerivedBytes(privatePart, publicPart, cancellationToken);\n\n        ensureNotCancelled(cancellationToken);\n\n        const hmacParameters: HmacImportParams = {\n            name: 'HMAC',\n            hash: { name: 'SHA-512' }\n        };\n\n        const hkdfKey: CryptoKey = await window.crypto.subtle.importKey(\n            'raw',\n            derivedKey,\n            hmacParameters,\n            false,\n            ['sign']\n        );\n\n        ensureNotCancelled(cancellationToken);\n\n        const result: ArrayBuffer = await window.crypto.subtle.sign('HMAC', hkdfKey, this.hkdfPurpose);\n\n        ensureNotCancelled(cancellationToken);\n\n        return result;\n    }\n}\n","import { ICipher, getDerivedBytes } from '../crypto';\nimport { CancellationToken, ensureNotCancelled } from '../asyncUtils';\n\nconst encryptionKeyDerivationSalt: ArrayBuffer = new Uint8Array([ 0xf2, 0xcf, 0xef, 0x8e, 0x13, 0x40, 0x46, 0x49, 0x92, 0x2a, 0xde, 0x5c, 0xbc, 0x88, 0x38, 0xa8 ]).buffer;\n\nexport class CipherV1 implements ICipher {\n    public get version(): number {\n        return 1;\n    }\n\n    public get description(): string {\n        return 'PBKDF2 + AES-GCM';\n    }\n\n    async encrypt(input: ArrayBuffer, password: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer> {\n        const output: ArrayBuffer = new ArrayBuffer(12 + 16 + input.byteLength);\n\n        const nonce: DataView = new DataView(output, 0, 12);\n        crypto.getRandomValues(new Uint8Array(output, 0, 12));\n\n        const aesGcmParams: AesGcmParams = {\n            name: 'AES-GCM',\n            iv: nonce\n        };\n\n        const aesKeyAlgorithm: AesKeyAlgorithm = {\n            name: 'AES-GCM',\n            length: 256\n        };\n\n        const passwordKey: CryptoKey = await window.crypto.subtle.importKey(\n            'raw',\n            await getDerivedBytes(password, encryptionKeyDerivationSalt, cancellationToken),\n            aesKeyAlgorithm,\n            false,\n            ['encrypt']\n        );\n\n        ensureNotCancelled(cancellationToken);\n\n        const result: ArrayBuffer = await window.crypto.subtle.encrypt(aesGcmParams, passwordKey, input);\n\n        ensureNotCancelled(cancellationToken);\n\n        new Uint8Array(output).set(new Uint8Array(result), 12);\n\n        return output;\n    }\n\n    async decrypt(input: ArrayBuffer, password: ArrayBuffer, cancellationToken: CancellationToken): Promise<ArrayBuffer> {\n        const nonce: DataView = new DataView(input, 0, 12);\n        const payload: DataView = new DataView(input, 12);\n\n        const aesGcmParams: AesGcmParams = {\n            name: 'AES-GCM',\n            iv: nonce\n        };\n\n        const aesKeyAlgorithm: AesKeyAlgorithm = {\n            name: 'AES-GCM',\n            length: 256\n        };\n\n        const derivedKey: ArrayBuffer = await getDerivedBytes(password, encryptionKeyDerivationSalt, cancellationToken);\n\n        ensureNotCancelled(cancellationToken);\n\n        const passwordKey: CryptoKey = await window.crypto.subtle.importKey(\n            'raw',\n            derivedKey,\n            aesKeyAlgorithm,\n            false,\n            ['decrypt']\n        );\n\n        ensureNotCancelled(cancellationToken);\n\n        const result: ArrayBuffer = await window.crypto.subtle.decrypt(aesGcmParams, passwordKey, payload);\n\n        ensureNotCancelled(cancellationToken);\n\n        return result;\n    }\n}\n","import { ICipher } from '../crypto';\nimport * as stringUtils from '../stringUtils';\nimport * as arrayUtils from '../arrayUtils';\nimport { ITabInfo } from '../TabControl';\nimport * as ui from '../ui';\nimport { getPrivatePart } from './privatePartComponent';\n\nimport { CipherV1 } from '../ciphers/v1';\nimport { CipherV2 } from '../ciphers/v2';\nimport { IComponent } from './IComponent';\n\nimport * as storageOutputComponent from './storageOutputComponent';\n\nimport { CancellationToken } from '../asyncUtils';\n\nconst ciphers: ICipher[] = [\n    new CipherV1(),\n    new CipherV2()\n];\n\nconst btnTabReEncrypt: HTMLButtonElement = ui.getElementById('btnTabReEncrypt') as HTMLButtonElement;\nconst divTabReEncrypt: HTMLElement = ui.getElementById('divTabReEncrypt');\n\nconst txtReEncryptSource: HTMLInputElement = ui.getElementById('txtReEncryptSource') as HTMLInputElement;\nconst txtReEncryptTarget: HTMLInputElement = ui.getElementById('txtReEncryptTarget') as HTMLInputElement;\n\nconst cboReEncryptFrom: HTMLSelectElement = ui.getElementById('cboReEncryptFrom') as HTMLSelectElement;\nconst cboReEncryptTo: HTMLSelectElement = ui.getElementById('cboReEncryptTo') as HTMLSelectElement;\nconst btnReEncrypt: HTMLButtonElement = ui.getElementById('btnReEncrypt') as HTMLButtonElement;\n\nconst btnClearReEncryptSource: HTMLButtonElement = ui.getElementById('btnClearReEncryptSource') as HTMLButtonElement;\nconst btnCopyReEncryptTarget: HTMLButtonElement = ui.getElementById('btnCopyReEncryptTarget') as HTMLButtonElement;\nconst btnClearReEncryptTarget: HTMLButtonElement = ui.getElementById('btnClearReEncryptTarget') as HTMLButtonElement;\n\nfunction fillCipherComboBox(cbo: HTMLSelectElement, initialValue: number): void {\n    let cipher: ICipher;\n\n    for (cipher of ciphers) {\n        const item: HTMLOptionElement = document.createElement('option');\n        item.value = cbo.childNodes.length.toString();\n        item.text = `${cipher.description} (v${cipher.version})`;\n        cbo.add(item);\n    }\n\n    cbo.value = initialValue.toString();\n}\n\nfunction clearSourceVisualCue(): void {\n    txtReEncryptSource.style.removeProperty('background-color');\n}\n\nfunction clearTargetVisualCue(): void {\n    txtReEncryptTarget.style.removeProperty('background-color');\n}\n\nfunction setSourceVisualCueError() {\n    txtReEncryptSource.style.setProperty('background-color', ui.ERROR_COLOR);\n}\n\nfunction setTargetVisualCueError() {\n    txtReEncryptTarget.style.setProperty('background-color', ui.ERROR_COLOR);\n}\n\nfunction clearAllVisualCues(): void {\n    clearSourceVisualCue();\n    clearTargetVisualCue();\n}\n\nasync function onReEncryptButtonClick(): Promise<boolean> {\n    ui.clearText(txtReEncryptTarget, true);\n    clearAllVisualCues();\n\n    if (txtReEncryptSource.value.length === 0) {\n        setSourceVisualCueError();\n        return false;\n    }\n\n    if (cboReEncryptFrom.value === cboReEncryptTo.value) {\n        setTargetVisualCueError();\n        return false;\n    }\n\n    const privatePart: string = getPrivatePart();\n    if (privatePart.length === 0) {\n        console.warn('Private part is empty');\n        return false;\n    }\n\n    const sourceCipherIndex = parseInt(cboReEncryptFrom.value, 10);\n    const targetCipherIndex = parseInt(cboReEncryptTo.value, 10);\n\n    const password: ArrayBuffer = stringUtils.stringToArray(privatePart);\n\n    const input: ArrayBuffer = stringUtils.fromBase16(txtReEncryptSource.value);\n    const decrypted: ArrayBuffer = await ciphers[sourceCipherIndex].decrypt(input, password, CancellationToken.none);\n    const reEncrypted: ArrayBuffer = await ciphers[targetCipherIndex].encrypt(decrypted, password, CancellationToken.none);\n\n    txtReEncryptTarget.value = arrayUtils.toBase16(reEncrypted);\n\n    return true;\n}\n\nexport class ReEncryptComponent implements IComponent, ITabInfo {\n    public readonly name: string = 'ReEncrypt';\n\n    public getTabButton(): HTMLButtonElement {\n        return btnTabReEncrypt;\n    }\n\n    public getTabContent(): HTMLElement {\n        return divTabReEncrypt;\n    }\n\n    public onTabSelected() {\n        storageOutputComponent.hide();\n        txtReEncryptSource.focus();\n    }\n\n    public getVaultHint(): string {\n        throw new Error('Not supported.');\n    }\n\n    public init(): void {\n        ui.setupCopyButton(txtReEncryptTarget, btnCopyReEncryptTarget);\n\n        // Mais est-ce que ce monde est serieux?\n        fillCipherComboBox(<HTMLSelectElement><any>cboReEncryptFrom, ciphers.length - 2);\n        fillCipherComboBox(<HTMLSelectElement><any>cboReEncryptTo, ciphers.length - 1);\n\n        txtReEncryptSource.addEventListener('input', () => {\n            if (txtReEncryptSource.value.length > 0) {\n                clearSourceVisualCue();\n            }\n        });\n\n        btnClearReEncryptSource.addEventListener('click', () => {\n            ui.clearText(txtReEncryptSource, true);\n        });\n\n        btnClearReEncryptTarget.addEventListener('click', () => {\n            ui.clearText(txtReEncryptTarget, true);\n        });\n\n        ui.setupFeedbackButton(btnReEncrypt, onReEncryptButtonClick);\n    }\n}\n","import * as plainObject from '../../PlainObject';\nimport { SearchMatchFunction, PositionMarker } from '../../searchMatchFunctions';\n\nexport const DEEP_MODE_NONE = 0;\nexport const DEEP_MODE_UP = 1;\nexport const DEEP_MODE_DOWN = 2;\n\nconst TREE_ELEMENT_HEIGHT = 30;\n\nconst HORIZONTAL_LINE_VERTICAL_OFFSET = Math.floor(TREE_ELEMENT_HEIGHT / 2);\nconst HORIZONTAL_LINE_LENGTH = 12;\nconst VERTICAL_BAR_OFFSET = 6;\n\nexport interface TreeNodeCreationController {\n    isLeaf(path: string, key: string, value: any): boolean;\n    createTreeNodeContentElement(path: string, key: string, value: any): HTMLElement;\n}\n\nexport class TreeNode {\n    protected readonly parent: TreeNode | null;\n    protected readonly children: TreeNode[] = [];\n\n    protected readonly rootElement: HTMLElement;\n    protected readonly titleElement: HTMLElement;\n    protected readonly childrenContainerElement: HTMLElement;\n\n    protected readonly treeNodeCreationController: TreeNodeCreationController;\n\n    protected readonly path: string;\n    protected readonly key: string;\n    protected readonly value: any;\n\n    public get element(): HTMLElement {\n        return this.rootElement;\n    }\n\n    public get isVisible(): boolean {\n        return this.rootElement.style.display !== 'none';\n    }\n\n    public getVisibleChildCount(): number {\n        let visibleChildCount = 0;\n\n        for (const child of this.children) {\n            if (child.isVisible) {\n                visibleChildCount += 1;\n            }\n        }\n\n        return visibleChildCount;\n    }\n\n    public getVisibleLeafCount(): number {\n        if (this.isVisible === false) {\n            return 0;\n        }\n\n        let visibleLeafCount = 1;\n\n        for (const child of this.children) {\n            visibleLeafCount += child.getVisibleLeafCount();\n        }\n\n        return visibleLeafCount;\n    }\n\n    private addChild(child: TreeNode) {\n        this.childrenContainerElement.appendChild(child.rootElement);\n        this.children.push(child);\n    }\n\n    private createChildNodes(object: plainObject.PlainObject) {\n        for (const [childKey, childValue] of Object.entries(object)) {\n            const child = new TreeNode(this, `${this.path}/${childKey}`, childKey, childValue, this.treeNodeCreationController);\n            this.addChild(child);\n        }\n}\n\n    constructor(parent: TreeNode | null, path: string, key: string, value: any, treeNodeCreationController: TreeNodeCreationController) {\n        this.parent = parent;\n        this.path = path;\n        this.key = key;\n        this.value = value;\n        this.treeNodeCreationController = treeNodeCreationController;\n\n        this.rootElement = document.createElement('div');\n        this.setRootElementStyle();\n\n        // Construct title DOM element.\n        this.titleElement = document.createElement('div');\n        this.setTitleElementStyle();\n\n        this.titleElement.appendChild(this.createTreeNodeContentElement());\n\n        this.rootElement.appendChild(this.titleElement);\n\n        // Construct children container DOM element.\n        this.childrenContainerElement = document.createElement('div');\n        this.rootElement.appendChild(this.childrenContainerElement);\n        this.setChildrenContainerElementStyle();\n\n        const isLeaf = treeNodeCreationController.isLeaf(path, key, value);\n\n        if (isLeaf === false && plainObject.isPlainObject(value)) {\n            this.createChildNodes(value);\n        } else if (isLeaf && value.customKeys) {\n            this.createChildNodes(value.customKeys);\n        }\n\n        if (parent) {\n            // Construct lines DOM elements.\n            this.setupLinesElements('#D0D0D0');\n        }\n    }\n\n    private createTreeNodeContentElement(): HTMLElement {\n        return this.treeNodeCreationController.createTreeNodeContentElement(this.path, this.key, this.value);\n    }\n\n    private setRootElementStyle(): void {\n        this.rootElement.classList.add('treenode-root');\n        this.rootElement.style.display = 'grid';\n\n        let height = 4; // Gives a bit of top spacing.\n        let childrenOffset = 0;\n\n        if (this.parent) {\n            height = TREE_ELEMENT_HEIGHT;\n        }\n        if (this.parent && this.parent.parent) {\n            childrenOffset = HORIZONTAL_LINE_LENGTH;\n        }\n\n        this.rootElement.style.gridTemplateRows = `${height}px 1fr`;\n        this.rootElement.style.gridTemplateColumns = `${childrenOffset}px ${VERTICAL_BAR_OFFSET}px 1fr`;\n    }\n\n    private verticalLineElement: HTMLElement | null = null;\n\n    private setupLinesElements(color: string): void {\n        const verticalLineElement = document.createElement('div');\n        verticalLineElement.classList.add('treenode-vertical-line');\n        verticalLineElement.style.gridColumn = '2';\n        verticalLineElement.style.gridRow = '2';\n        verticalLineElement.style.width = '100%';\n        verticalLineElement.style.borderRight = `1px solid ${color}`;\n        this.verticalLineElement = verticalLineElement;\n        this.rootElement.appendChild(verticalLineElement);\n\n        if (this.parent && this.parent.parent) {\n            const horizontalLineElement = document.createElement('div');\n            horizontalLineElement.classList.add('treenode-horizontal-line');\n            horizontalLineElement.style.gridColumn = '1';\n            horizontalLineElement.style.gridRow = '1';\n            horizontalLineElement.style.width = '100%';\n            horizontalLineElement.style.height = `${HORIZONTAL_LINE_VERTICAL_OFFSET}px`;\n            horizontalLineElement.style.borderBottom = `1px solid ${color}`;\n            this.rootElement.appendChild(horizontalLineElement);\n        }\n\n        this.updateLines();\n    }\n\n    private updateLines(): void {\n        if (this.verticalLineElement === null) {\n            return;\n        }\n\n        const visibleChildCount = this.getVisibleChildCount();\n\n        if (visibleChildCount === 0) {\n            this.verticalLineElement.style.height = '0px';\n            return;\n        }\n\n        let totalVisibleLeafCount = 1;\n\n        for (let i = 0; i < visibleChildCount - 1; i += 1) {\n            if (this.children[i].isVisible) {\n                totalVisibleLeafCount += this.children[i].getVisibleLeafCount();\n            }\n        }\n\n        const bottomPosition = (totalVisibleLeafCount * TREE_ELEMENT_HEIGHT) - TREE_ELEMENT_HEIGHT + HORIZONTAL_LINE_VERTICAL_OFFSET + 1;\n\n        this.verticalLineElement.style.height = `${bottomPosition}px`;\n    }\n\n    private setTitleElementStyle(): void {\n        if (!this.titleElement) {\n            return;\n        }\n\n        this.titleElement.classList.add('treenode-title');\n        this.titleElement.style.gridColumn = '2 / span 2';\n        this.titleElement.style.gridRow = '1';\n        this.titleElement.style.marginLeft = '3px';\n        this.titleElement.style.alignSelf = 'center';\n    }\n\n    private setChildrenContainerElementStyle(): void {\n        this.childrenContainerElement.classList.add('treenode-children-container');\n        this.childrenContainerElement.style.gridColumn = '3';\n        this.childrenContainerElement.style.gridRow = '2';\n    }\n\n    private resetTitle(deepMode: number): void {\n        if (this.titleElement) {\n            this.titleElement.innerHTML = '';\n            this.titleElement.appendChild(this.createTreeNodeContentElement());\n        }\n\n        if (deepMode === DEEP_MODE_UP && this.parent) {\n            this.parent.resetTitle(deepMode);\n        }\n\n        if (deepMode === DEEP_MODE_DOWN) {\n            for (const child of this.children) {\n                child.resetTitle(deepMode);\n            }\n        }\n    }\n\n    public show(deepMode: number): void {\n        this.rootElement.style.display = 'grid';\n\n        if (deepMode === DEEP_MODE_UP && this.parent) {\n            this.parent.show(deepMode);\n        }\n\n        if (deepMode === DEEP_MODE_DOWN) {\n            for (const child of this.children) {\n                child.show(deepMode);\n            }\n        }\n\n        this.updateLines();\n    }\n\n    public hide(deepMode: number): void {\n        this.rootElement.style.display = 'none';\n\n        if (deepMode === DEEP_MODE_UP && this.parent) {\n            this.parent.hide(deepMode);\n        }\n\n        if (deepMode === DEEP_MODE_DOWN) {\n            for (const child of this.children) {\n                child.hide(deepMode);\n            }\n        }\n\n        this.updateLines();\n    }\n\n    private static createSpan(text: string, color?: string): HTMLElement {\n        const element = document.createElement('span');\n        if (color) {\n            element.style.backgroundColor = color;\n            element.style.borderRadius = '2px';\n        }\n        element.innerText = text;\n        return element;\n    }\n\n    private static createColoredSpan(text: string, markers: PositionMarker[]): HTMLElement {\n        const root = document.createElement('span');\n\n        let pos = 0;\n\n        for (const marker of markers) {\n            if (marker.pos !== pos) {\n                root.appendChild(TreeNode.createSpan(text.substring(pos, marker.pos)));\n            }\n\n            root.appendChild(TreeNode.createSpan(text.substring(marker.pos, marker.pos + marker.len), '#80C0FF'));\n\n            pos = marker.pos + marker.len;\n        }\n\n        if (pos < text.length) {\n            root.appendChild(TreeNode.createSpan(text.substring(pos, text.length)));\n        }\n\n        return root;\n    }\n\n    private static findLeafElement(element: Element): Element {\n        if (element.children.length === 0) {\n            return element;\n        }\n\n        return TreeNode.findLeafElement(element.children[0]);\n    }\n\n    public filter(searchText: string, matchFunction: SearchMatchFunction): void {\n        if (!searchText) {\n            this.resetTitle(DEEP_MODE_DOWN);\n            this.show(DEEP_MODE_DOWN);\n            this.updateLines();\n            return;\n        }\n\n        const markers: PositionMarker[] = [];\n        const isMatch = matchFunction(this.titleElement.innerText, searchText, markers);\n\n        if (isMatch) {\n            if (this.titleElement) {\n                const element = TreeNode.findLeafElement(this.titleElement);\n                element.innerHTML = '';\n                const title = this.createTreeNodeContentElement();\n                element.appendChild(TreeNode.createColoredSpan(title.innerText, markers));\n            }\n\n            this.show(DEEP_MODE_UP);\n            this.show(DEEP_MODE_DOWN);\n        } else {\n            this.resetTitle(DEEP_MODE_DOWN);\n        }\n\n        for (const child of this.children) {\n            child.filter(searchText, matchFunction);\n        }\n\n        this.updateLines();\n    }\n}\n","export interface PositionMarker {\n    pos: number;\n    len: number;\n}\n\nexport type SearchMatchFunction = (lhs: string, rhs: string, markers: PositionMarker[]) => boolean;\n\nfunction indexedAggresiveSearchMatchFunction(lhs: string, lhsIndex: number, rhs: string, markers: PositionMarker[]): boolean {\n    if (!rhs) {\n        return true;\n    }\n\n    lhs = lhs.toLowerCase();\n    rhs = rhs.toLowerCase();\n\n    for (let len = rhs.length; len >= 1; len -= 1) {\n        const subWord = rhs.substring(0, len);\n        const foundPos = lhs.indexOf(subWord, lhsIndex);\n\n        if (foundPos >= 0) {\n            markers.push({\n                pos: foundPos,\n                len: subWord.length\n            });\n\n            return indexedAggresiveSearchMatchFunction(lhs, foundPos + subWord.length, rhs.substring(len), markers);\n        }\n    }\n\n    return false;\n}\n\nexport function aggresiveSearchMatchFunction(lhs: string, rhs: string, markers: PositionMarker[]): boolean {\n    return indexedAggresiveSearchMatchFunction(lhs, 0, rhs, markers);\n}\n\nexport function containsSearchMatchFunction(lhs: string, rhs: string, markers: PositionMarker[]): boolean {\n    const index = lhs.toLowerCase().indexOf(rhs.toLowerCase());\n\n    if (index < 0) {\n        return false;\n    }\n\n    markers.push({\n        pos: index,\n        len: rhs.length\n    });\n\n    return true;\n}\n","import { getElementById } from '../../ui';\nimport { IComponent } from '../IComponent';\nimport { ITabInfo } from '../../TabControl';\nimport { IVaultComponent } from '../vaultComponent';\nimport { TreeNode, TreeNodeCreationController, DEEP_MODE_DOWN } from './TreeNode';\nimport * as plainObject from '../../PlainObject';\nimport * as ui from '../../ui';\nimport { aggresiveSearchMatchFunction, containsSearchMatchFunction, SearchMatchFunction } from '../../searchMatchFunctions';\nimport * as serviceManager from '../../services/serviceManger';\nimport { PasswordService } from '../../services/passwordService';\nimport { CipherService } from 'services/cipherService';\n\nconst btnTabVaultTabTreeView = getElementById('btnTabVaultTabTreeView') as HTMLButtonElement;\nconst divTabVaultTabTreeView = getElementById('divTabVaultTabTreeView');\n\nconst trvVaultTreeView = getElementById('trvVaultTreeView');\nconst txtVaultTreeViewSearch = getElementById('txtVaultTreeViewSearch') as HTMLInputElement;\nconst cboVaultTreeViewSearchType = getElementById('cboVaultTreeViewSearchType') as HTMLSelectElement;\n\nlet rootTreeNode: TreeNode;\n\ninterface SearchMatchFunctionDescription {\n    text: string,\n    function: SearchMatchFunction\n}\n\nconst searchMatchFunctionDescriptions: SearchMatchFunctionDescription[] = [\n    { text: 'Aggresive', function: aggresiveSearchMatchFunction },\n    { text: 'Regular', function: containsSearchMatchFunction },\n];\n\nfunction onSearchVaultInputChanged(): void {\n    if (!rootTreeNode) {\n        return;\n    }\n\n    const index: number = cboVaultTreeViewSearchType.selectedIndex;\n    const searchMatchFunction: SearchMatchFunction = searchMatchFunctionDescriptions[index].function;\n\n    rootTreeNode.hide(DEEP_MODE_DOWN);\n    rootTreeNode.filter(txtVaultTreeViewSearch.value.toLocaleLowerCase(), searchMatchFunction);\n}\n\nfunction populateSearchFunctions(): void {\n    cboVaultTreeViewSearchType.innerHTML = '';\n\n    for (let description of searchMatchFunctionDescriptions) {\n        const option = document.createElement('option');\n        option.text = description.text;\n        cboVaultTreeViewSearchType.appendChild(option);\n    }\n}\n\nclass VaultTreeNodeCreationController implements TreeNodeCreationController {\n    private readonly passwordService: PasswordService;\n\n    public constructor() {\n        this.passwordService = serviceManager.getService('password');\n    }\n\n    private async runPassword(value: any): Promise<void> {\n        await this.passwordService.generateAndCopyPasswordToClipboard(value.public, value.alphabet, value.length);\n    }\n\n    private async runCipher(path: string, key: string, value: any): Promise<boolean> {\n        const cipherService: CipherService | null = serviceManager.getService('cipher');\n\n        if (cipherService === null) {\n            return false;\n        }\n\n        return await cipherService.activate(path, key, value);\n    }\n\n    private static isPasswordObject(key: string, obj: plainObject.PlainObject): boolean {\n        if (key !== 'password') {\n            return false;\n        }\n\n        if (!obj || !plainObject.isPlainObject(obj) || typeof obj.public !== 'string' || obj.public.length < 4) {\n            return false;\n        }\n\n        return true;\n    }\n\n    private static isCipherObject(obj: plainObject.PlainObject): boolean {\n        if (!obj || !plainObject.isPlainObject(obj)) {\n            return false;\n        }\n\n        if (typeof obj.value !== 'string' || obj.value.length <= 0) {\n            return false;\n        }\n\n        if (typeof obj.version !== 'number' || obj.version < 0) {\n            return false;\n        }\n\n        return true;\n    }\n\n    private static isCiphersObject(key: string, obj: plainObject.PlainObject): boolean {\n        if (key !== 'ciphers') {\n            return false;\n        }\n\n        if (!obj || !plainObject.isPlainObject(obj)) {\n            return false;\n        }\n\n        for (const sub of Object.values(obj)) {\n            if (!VaultTreeNodeCreationController.isCipherObject(sub)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    private static isHint(key: string, value: any) {\n        if (VaultTreeNodeCreationController.isCiphersObject(key, value) ||\n            VaultTreeNodeCreationController.isCipherObject(value) ||\n            VaultTreeNodeCreationController.isPasswordObject(key, value) ||\n            plainObject.isPlainObject(value)) {\n            return false;\n        }\n\n        return true;\n    }\n\n    public isLeaf(path: string, key: string, value: any): boolean {\n        if (VaultTreeNodeCreationController.isCipherObject(value) ||\n            VaultTreeNodeCreationController.isPasswordObject(key, value)) {\n            return true;\n        }\n\n        return plainObject.isPlainObject(value) === false;\n    }\n\n    createTreeNodeContentElement(path: string, key: string, value: any): HTMLElement {\n        if (VaultTreeNodeCreationController.isPasswordObject(key, value)) {\n            const button = document.createElement('button');\n            button.style.justifySelf = 'start';\n            button.style.minWidth = '80px';\n            button.innerText = 'Password';\n\n            ui.setupFeedbackButton(button, async () => await this.runPassword(value));\n\n            return button;\n        } else if (VaultTreeNodeCreationController.isCipherObject(value)) {\n            const button = document.createElement('button');\n            button.style.justifySelf = 'start';\n            button.innerText = key;\n            button.title = 'Open in ciphers';\n\n            ui.setupFeedbackButton(button, async () => await this.runCipher(path, key, value));\n\n            return button;\n        } else if (VaultTreeNodeCreationController.isHint(key, value)) {\n            const label = document.createElement('span');\n            label.style.justifySelf = 'start';\n            label.innerText = `${key}: ${value}`;\n\n            return label;\n        }\n\n        const div = document.createElement('div');\n        div.innerText = key;\n        return div;\n    }\n}\n\nexport class VaultTreeViewComponent implements IComponent, ITabInfo, IVaultComponent {\n    public readonly name: string = 'VaultTreeView';\n\n    public onVaultLoaded(vault: plainObject.PlainObject): void {\n        rootTreeNode = new TreeNode(null, '<root>', '', vault, new VaultTreeNodeCreationController());\n\n        trvVaultTreeView.innerHTML = '';\n        trvVaultTreeView.appendChild(rootTreeNode.element);\n\n        onSearchVaultInputChanged();\n    }\n\n    public getTabButton(): HTMLButtonElement {\n        return btnTabVaultTabTreeView;\n    }\n\n    public getTabContent(): HTMLElement {\n        return divTabVaultTabTreeView;\n    }\n\n    public onTabSelected(): void {\n        txtVaultTreeViewSearch.focus();\n    }\n\n    public getVaultHint(): string {\n        throw new Error('Not supported.');\n    }\n\n    public init(): void {\n        populateSearchFunctions();\n\n        txtVaultTreeViewSearch.addEventListener('input', onSearchVaultInputChanged);\n        cboVaultTreeViewSearchType.addEventListener('change', onSearchVaultInputChanged);\n    }\n}\n","import { getElementById } from '../../ui';\nimport { IComponent } from '../IComponent';\nimport { ITabInfo } from '../../TabControl';\nimport { IVaultComponent } from '../vaultComponent';\nimport * as plainObject from '../../PlainObject';\n\nconst btnTabVaultTabTextView = getElementById('btnTabVaultTabTextView') as HTMLButtonElement;\nconst divTabVaultTabTextView = getElementById('divTabVaultTabTextView');\n\nconst txtVault = getElementById('txtVault') as HTMLInputElement;\n\nexport class VaultTextViewComponent implements IComponent, ITabInfo, IVaultComponent {\n    public readonly name: string = 'VaultTextView';\n\n    public onVaultLoaded(vault: plainObject.PlainObject): void {\n        txtVault.value = JSON.stringify(vault, undefined, 4);\n    }\n\n    public getTabButton(): HTMLButtonElement {\n        return btnTabVaultTabTextView;\n    }\n\n    public getTabContent(): HTMLElement {\n        return divTabVaultTabTextView;\n    }\n\n    public onTabSelected(): void {\n    }\n\n    public getVaultHint(): string {\n        throw new Error('Not supported.');\n    }\n\n    public init(): void {\n    }\n}\n","import { VaultComponent } from '../components/vaultComponent';\n\nexport class VaultService {\n    private readonly vaultComponent: VaultComponent;\n\n    public constructor(vaultComponent: VaultComponent) {\n        this.vaultComponent = vaultComponent;\n    }\n\n    public computeUserPathMatchDepth(path: string): number {\n        return this.vaultComponent.computeUserPathMatchDepth(path);\n    }\n}\n","import { getElementById, setupFeedbackButton } from '../ui';\n\nimport { IComponent } from './IComponent';\nimport { ITabInfo, TabControl } from '../TabControl';\n\nimport * as storageOutputComponent from './storageOutputComponent';\n\nimport { SecureLocalStorage } from '../storages/SecureLocalStorage';\nimport { IVaultStorage } from '../storages/IVaultStorage';\nimport { GitHubPersonalAccessTokenVaultStorage } from '../storages/GitHubVaultStorage';\nimport { hasPrivatePart, protectAndLockPrivatePart } from './privatePartComponent';\nimport * as plainObject from '../PlainObject';\nimport { VaultTreeViewComponent } from './vaultComponents/treeViewComponent';\nimport { VaultTextViewComponent } from './vaultComponents/textViewComponent';\n\nimport * as serviceManager from '../services/serviceManger';\nimport { VaultService } from '../services/vaultService';\n\nexport interface IVaultComponent {\n    onVaultLoaded(vault: plainObject.PlainObject): void;\n}\n\nconst divTabVault = getElementById('divTabVault');\nconst btnTabVault = getElementById('btnTabVault') as HTMLButtonElement;\n\nconst btnRefreshVault = getElementById('btnRefreshVault') as HTMLButtonElement;\nconst btnClearVaultSettings = getElementById('btnClearVaultSettings') as HTMLButtonElement;\n\nconst elements: any[] = [\n    new VaultTreeViewComponent(),\n    new VaultTextViewComponent(),\n];\n\nconst tabs: ITabInfo[] = elements.filter(e => (e as ITabInfo).getTabButton !== undefined);\nconst components: (IComponent & IVaultComponent)[] = elements.filter(e => (e as IComponent).init !== undefined);\n\nconst subTabs = new TabControl(tabs);\n\nlet vaultStorage: IVaultStorage = new GitHubPersonalAccessTokenVaultStorage(new SecureLocalStorage());\n\nlet vaultObject: plainObject.PlainObject | null = null;\n\nfunction computeUserPathMatchDepth(path: string): number {\n    if (vaultObject === null) {\n        return 0;\n    }\n\n    let obj = vaultObject;\n\n    const pathArray = path.split('/');\n\n    for (let i = 0; i < pathArray.length; i += 1) {\n        if (!obj[pathArray[i]]) {\n            return i;\n        }\n\n        // TODO: Filter here to not go further down ItchyObjects.\n\n        obj = obj[pathArray[i]];\n    }\n\n    return pathArray.length;\n}\n\nasync function reloadVault(): Promise<boolean> {\n    let content: string | null = await vaultStorage.getVaultContent();\n\n    if (content === null) {\n        return false;\n    }\n\n    try {\n        let obj = JSON.parse(content) as plainObject.PlainObject;\n        obj = plainObject.objectDeepSort(obj);\n\n        vaultObject = obj;\n\n        let component: IVaultComponent;\n        for (component of components) {\n            component.onVaultLoaded(obj);\n        }\n\n        return true;\n    } catch (error) {\n        vaultObject = null;\n        alert('Failed to parse vault content, needs to be fixed.');\n        console.error((error as Error).message);\n        return false;\n    }\n}\n\nasync function onRefreshVaultButtonClick(): Promise<boolean> {\n    if (hasPrivatePart() === false) {\n        alert('You must enter a master key first.');\n        return false;\n    }\n\n    const result: boolean = await reloadVault();\n\n    if (result) {\n        protectAndLockPrivatePart();\n    }\n\n    return result;\n}\n\nfunction onClearVaultSettingsButtonClick(): void {\n    if (prompt('Are you sure you want to clear the vault settings ?\\nType \\'y\\' to accept', '') !== 'y') {\n        return;\n    }\n\n    vaultStorage.clear();\n}\n\nexport class VaultComponent implements IComponent, ITabInfo {\n    public readonly name: string = 'Vault';\n\n    public computeUserPathMatchDepth(path: string) {\n        return computeUserPathMatchDepth(path);\n    }\n\n    public getTabButton(): HTMLButtonElement {\n        return btnTabVault;\n    }\n\n    public getTabContent(): HTMLElement {\n        return divTabVault;\n    }\n\n    public onTabSelected(): void {\n        storageOutputComponent.hide();\n        tabs[subTabs.activeTabIndex].onTabSelected();\n    }\n\n    public getVaultHint(): string {\n        throw new Error('Not supported.');\n    }\n\n    public init(): void {\n        setupFeedbackButton(btnRefreshVault, onRefreshVaultButtonClick);\n        btnClearVaultSettings.addEventListener('click', onClearVaultSettingsButtonClick);\n\n        const vaultService = new VaultService(this);\n        serviceManager.registerService('vault', vaultService);\n\n        let component: IComponent;\n        for (component of components) {\n            component.init();\n        }\n    }\n}\n","import { getElementById } from '../ui';\nimport { TabControl, ITabInfo } from '../TabControl';\n\nimport { IComponent } from './IComponent';\nimport { PrivatePartComponent } from './privatePartComponent';\nimport { PasswordComponent } from './passwordComponent';\nimport { CipherComponent } from './cipherComponent';\nimport { ReEncryptComponent } from './reEncryptComponent';\nimport { VaultComponent } from './vaultComponent';\n\nimport * as storageOutputComponent from './storageOutputComponent';\n\nconst nothingTabInfo: ITabInfo = {\n    getTabButton(): HTMLButtonElement {\n        return getElementById('btnTabNothing') as HTMLButtonElement;\n    },\n    getTabContent(): HTMLElement {\n        return getElementById('divTabNothing');\n    },\n    onTabSelected(): void {\n        storageOutputComponent.hide();\n    }\n}\n\nconst elements: any[] = [\n    nothingTabInfo,\n    new PrivatePartComponent(),\n    new PasswordComponent(),\n    new CipherComponent(),\n    new ReEncryptComponent(),\n    new storageOutputComponent.StorageOutputComponent(),\n    new VaultComponent(),\n];\n\nconst tabs: ITabInfo[] = elements.filter(e => (e as ITabInfo).getTabButton !== undefined);\nconst components: IComponent[] = elements.filter(e => (e as IComponent).init !== undefined);\n\nconst tabControl = new TabControl(tabs);\n\nexport class RootComponent implements IComponent {\n    public readonly name: string = 'Root';\n\n    public constructor() {\n    }\n\n    public getVaultHint(): string {\n        throw new Error('Not supported.');\n    }\n\n    public init(): void {\n        let component: IComponent;\n        for (component of components) {\n            component.init();\n        }\n    }\n\n    public getActiveComponent(): IComponent | null {\n        const component = tabs[tabControl.activeTabIndex] as any;\n\n        if (component.init !== undefined) {\n            return component as IComponent;\n        }\n\n        return null;\n    }\n}\n\nexport const rootComponent = new RootComponent();\n","import { getElementById } from './ui';\nimport { rootComponent } from './components/rootComponent';\n\ndeclare const COMMITHASH: string;\n\nconst version = COMMITHASH.substring(0, 11);\nconst githubLink = '<a href=\"https://github.com/TanukiSharp/ItchyPassword\" target=\"_blank\">github</a>';\n\ngetElementById('divInfo').innerHTML = `${version}<br/>${githubLink}`;\n\nrootComponent.init();\n"],"names":["ERROR_COLOR","getElementById","elementName","element","document","Error","async","writeToClipboard","text","navigator","clipboard","writeText","error","typedError","console","stack","clearText","txt","refocus","value","focus","setupFeedbackButton","button","action","throttleTimeout","clearFunc","duration","timeout","start","undefined","clearTimeout","end","setTimeout","createThrottleTimeout","classList","remove","clickFunction","disabled","actionResult","result","Promise","add","addEventListener","setupCopyButton","showHide","isVisible","style","removeProperty","setProperty","showHideMany","elements","TabControl","tabs","_activeTabIndex","activeTabIndex","this","index","length","setActiveTab","i","getTabButton","tabInfo","getTabContent","onTabSelected","btnProtectTitleForProtect","txtPrivatePart","txtPrivatePartConfirmation","btnProtect","spnProtectedConfirmation","spnPrivatePartSize","spnPrivatePartSizeConfirmation","privatePart","onChangedHandlers","getPrivatePart","protectAndLockPrivatePart","innerHTML","title","updatePrivatePartsMatching","onProtectButtonClick","protectPrivatePartAction","delay","reset","overrideDelay","window","onPrivatePartTextInput","onChangedHandler","toString","onPrivatePartConfirmationTextInput","toCustomBaseOneWay","bytes","alphabet","alphabetLength","BigInt","number","arrayBuffer","byteLength","arrayView","DataView","multiplier","getUint8","arrayBufferToUnsignedBigIntWithoutHeader","remainder","asUintN","TaskCancelledError","_name","name","constructor","message","super","ERROR_NAME","Object","setPrototypeOf","prototype","static","CancellationTokenSource","_isCancelled","_token","CancellationToken","isCancelled","token","cancel","source","none","_none","ensureNotCancelled","cancellationToken","BASE62_ALPHABET","getDerivedBytes","password","salt","baseKey","crypto","subtle","importKey","algorithm","hash","iterations","deriveKey","key","exportKey","truncate","input","substring","stringToArray","str","TextEncoder","encode","buffer","isPlainObject","hasOwnProperty","objectDeepSort","object","output","entries","sort","a","b","localeCompare","services","getService","serviceName","TypeError","service","registerService","instance","GitHubVaultStorageBase","secureLocalStorage","oneTimePassword","currentVaultContentHash","username","repositoryName","vaultFilename","getUsername","getRepositoryName","getVaultFilename","clear","removeItem","GitHubApiVaultStorage","LOCAL_STORAGE_KEY_USERNAME","LOCAL_STORAGE_KEY_REPO","LOCAL_STORAGE_KEY_FILENAME","AUTH_TOKEN_KEY_NAME","constructTokenAuthString","constructFetchRequest","method","authHeader","body","headers","JSON","stringify","constructUrl","relativeUrl","BASE_URL","retryOnUnauthorized","url","requestInfo","response","fetch","status","prompt","request","getSetVaultParameter","promptText","defaultValue","localStorage","getItem","setItem","ensureVaultParameters","URL","location","defaultAccountUsername","defaultRepo","hostname","pathElements","pathname","split","resolve","getToken","constructVaultFileUrl","ensureToken","warn","ok","getVaultContent","setVaultContent","responseContent","json","sha","decodedContent","atob","content","trim","newContent","updateMessage","btoa","GitHubPersonalAccessTokenVaultStorage","authToken","basicAuthHeader","authorizationName","LOCAL_STORAGE_KEY_PASSWORD_PUBLIC","LOCAL_STORAGE_KEY_PASSWORD_LENGTH","LOCAL_STORAGE_KEY_BROWSER_NAME","constructBasicAuthString","log","authorization","id","scopes","note","findAuthorization","authorizations","app","passwordPublicPart","passwordLengthString","passwordLength","parseInt","Number","isSafeInteger","browserName","AUTHORIZATION_NAME","listAuthorizations","deleteAuthorization","createAuthorization","CipherV2","version","description","ArrayBuffer","nonce","getRandomValues","Uint8Array","passwordSalt","aesGcmParams","iv","passwordKey","encrypt","set","payload","derivedKey","decrypt","CipherService","cipherComponent","storageFullPath","cipherName","parameterKeys","setParameters","click","btnTabCiphers","divTabCiphers","cipher","btnClearAllCipherInfo","txtCipherName","txtCipherSource","txtCipherTarget","btnEncrypt","btnDecrypt","btnCopyCipherSource","btnClearCipherSource","btnCopyCipherTarget","btnClearCipherTarget","cipherTargetLastChange","clearSourceVisualCue","setSourceVisualCueError","clearAllVisualCues","clearCipherTargetLastUpdate","setCipherTargetValue","isEncrypt","needDateTimeUpdate","Date","toISOString","updateCipherParameters","datetime","encryptString","encrypted","headeredBuffer","createHeaderedBuffer","arrayBufferToUnsignedBigInt","decryptString","indexOf","byteValue","push","totalLength","diff","slice","unsignedBigIntToArrayBuffer","decrypted","array","TextDecoder","decode","isMatching","rethrowCancelled","onEncryptButtonClick","encryptedString","onDecryptButtonClick","decryptedString","CipherComponent","fullPath","prefix","suffix","startsWith","endsWith","alert","storagePath","fullPathToStoragePath","customKeys","getVaultHint","toLowerCase","init","lblMatchingPath","innerText","txtPath","txtParameters","txtCustomKeys","_parameterKeys","_parameterPath","updateCustomKeysDisplay","SecureLocalStorage","encryptedItem","divStorageOutput","btnPushToVault","vaultStorage","pathToObjectChain","path","chainInfo","separatorIndex","tail","firstPath","remainingPath","node","head","tailParent","onPathTextInput","depth","computeUserPathMatchDepth","matchingPath","position","createMatchingPath","updateMatchingPath","update","onCustomKeysTextInput","isValid","leaf","obj","parse","parseCustomKeys","keys","deepMerge","target","sourceKey","targetValue","sourceValue","pushToVault","vaultContentData","newData","vaultContent","activeComponent","rootComponent","hint","chars","includes","findNonCharFromStart","findNonCharFromEnd","generateUpdateMessage","newVaultContentData","clearOutputs","parameterPath","setPathUI","setCustomKeysUI","show","hide","PasswordService","publicPart","keyString","Math","max","btnTabPasswords","divTabPasswords","passwordGenerator","hkdfPurpose","_description","hkdfKey","sign","txtPublicPart","spnPublicPartSize","btnGeneratePublicPart","btnClearPublicPart","btnCopyPublicPart","btnShowHidePasswordOptionalFeatures","lblAlphabetLength","numOutputSizeRange","numOutputSizeNum","lblAlphabet","txtAlphabet","spnAlphabetSize","divPasswordAlphabetActions","btnResetAlphabet","txtResultPassword","spnResultPasswordLength","btnViewResultPassword","btnCopyResultPassword","lblGeneratingPassword","DEFAULT_LENGTH","DEFAULT_ALPHABET","passwordPublicPartLastChange","copyPasswordFunction","onClearPublicPartButtonClick","updatePublicPartSize","updatePasswordPublicPartLastUpdate","updatePasswordGenerationParameters","onGeneratePublicPartButtonClick","randomString","byteCount","generateRandomBytes","run","updateResultPasswordLength","isAlphabetValid","sortedAlphabet","canRun","public","updateOutputSizeRangeToNum","onOutputSizeRangeInput","onOutputSizeNumInput","min","val","isNaN","updateOutputSizeNumToRange","updateAlphabetSize","updateAlphabetValidityDisplay","onAlphabetTextInput","isAlphabetValidResult","onResetAlphabetButtonClick","resetAlphabet","generatePasswordString","privatePrivateBytes","publicPartBytes","generatePassword","passwordTaskRunner","currentTokenSource","currentTask","microThreadId","isRunning","throwTaskCanceledError","MAX_SAFE_INTEGER","localMicroThreadId","cancelInternal","taskFactory","localToken","cancelAndExecute","runCore","onPublicPartTextInput","encryptionKeyDerivationSalt","ciphers","btnTabReEncrypt","divTabReEncrypt","txtReEncryptSource","txtReEncryptTarget","cboReEncryptFrom","cboReEncryptTo","btnReEncrypt","btnClearReEncryptSource","btnCopyReEncryptTarget","btnClearReEncryptTarget","fillCipherComboBox","cbo","initialValue","item","createElement","childNodes","onReEncryptButtonClick","sourceCipherIndex","targetCipherIndex","reEncrypted","Array","map","call","x","join","HORIZONTAL_LINE_VERTICAL_OFFSET","floor","TREE_ELEMENT_HEIGHT","TreeNode","parent","children","rootElement","titleElement","childrenContainerElement","treeNodeCreationController","display","getVisibleChildCount","visibleChildCount","child","getVisibleLeafCount","visibleLeafCount","addChild","appendChild","createChildNodes","childKey","childValue","setRootElementStyle","setTitleElementStyle","createTreeNodeContentElement","setChildrenContainerElementStyle","isLeaf","setupLinesElements","height","childrenOffset","gridTemplateRows","gridTemplateColumns","verticalLineElement","color","gridColumn","gridRow","width","borderRight","horizontalLineElement","borderBottom","updateLines","totalVisibleLeafCount","bottomPosition","marginLeft","alignSelf","resetTitle","deepMode","backgroundColor","borderRadius","markers","root","pos","marker","createSpan","len","findLeafElement","filter","searchText","matchFunction","createColoredSpan","indexedAggresiveSearchMatchFunction","lhs","lhsIndex","rhs","subWord","foundPos","btnTabVaultTabTreeView","divTabVaultTabTreeView","trvVaultTreeView","txtVaultTreeViewSearch","cboVaultTreeViewSearchType","rootTreeNode","searchMatchFunctionDescriptions","function","onSearchVaultInputChanged","selectedIndex","searchMatchFunction","toLocaleLowerCase","VaultTreeNodeCreationController","passwordService","generateAndCopyPasswordToClipboard","cipherService","activate","sub","values","isCipherObject","isCiphersObject","isPasswordObject","justifySelf","minWidth","runPassword","runCipher","isHint","label","div","btnTabVaultTabTextView","divTabVaultTabTextView","txtVault","VaultService","vaultComponent","divTabVault","btnTabVault","btnRefreshVault","btnClearVaultSettings","onVaultLoaded","vault","option","populateSearchFunctions","e","components","subTabs","vaultObject","onRefreshVaultButtonClick","component","reloadVault","onClearVaultSettingsButtonClick","onChanged","type","startVisible","pathArray","vaultService","tabControl","getActiveComponent"],"sourceRoot":""}